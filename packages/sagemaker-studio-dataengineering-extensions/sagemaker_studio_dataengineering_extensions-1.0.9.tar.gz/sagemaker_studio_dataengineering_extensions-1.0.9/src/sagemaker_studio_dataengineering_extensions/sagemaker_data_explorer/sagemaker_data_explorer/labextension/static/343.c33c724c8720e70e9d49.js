"use strict";(self.webpackChunk_amzn_sagemaker_data_explorer_jl_plugin=self.webpackChunk_amzn_sagemaker_data_explorer_jl_plugin||[]).push([[343],{343:(e,a,t)=>{t.r(a),t.d(a,{default:()=>f,logoIcon:()=>w}),t(908);var r,o=t(569),n=t(989),s=t(256),i=t(345),d=t.n(i);!function(e){e.AWS="aws"}(r||(r={}));const l={[r.AWS]:"public.lotus.awt.aws.a2z.com"};class c extends Error{constructor({name:e,message:a,cause:t,status:r}){super(a,t),this.status=r,this.name=e}}var m;!function(e){e.NetworkError="NetworkError",e.InvalidParametersError="InvalidParametersError",e.InvalidResponseError="InvalidResponseError",e.AbortError="AbortError"}(m||(m={}));const u=[400,401,403,404,413,415],h=async(e,a)=>{const t=Math.random()*2**e*a;await new Promise((e=>setTimeout(e,t)))},p=e=>{var a,t;const[o,n]=(0,i.useState)();let s=e.stage,p="";return(null===(t=null===(a=e.dataExplorerProps)||void 0===a?void 0:a.enabledFeatures)||void 0===t?void 0:t.has("feature-data-explorer-widget-wave0"))&&(p="Wave0"),(0,i.useEffect)((()=>{let a;return(async(e="prod",a="")=>{var t;const o={packageName:"@amzn/maxdome-data-explorer-widget"+("prod"===e?"":`-${e}`),majorVersion:1..toString(),aliasName:a},n=await(async({packageName:e,majorVersion:a,host:t,aliasName:o})=>{if(!e||!a)throw new c({name:m.InvalidParametersError,message:"Missing package name or majorVersion."});var n;const s=function(e,a,t,r){const o=new URL(`https://${e}/metadata`);return o.searchParams.append("packageName",a),o.searchParams.append("majorVersion",t),r&&o.searchParams.append("aliasName",r),o}(null!=t?t:(n=r.AWS,l[n]),e,a,o),i=await async function(e){let a,t,r=new Error("Error");for(let o=0;o<3;o++){let n;try{t||(t=new AbortController),n=setTimeout((()=>{null==t||t.abort()}),5e3);const r={signal:t.signal};if(a=await fetch(e.toString(),r),a.status>=200&&a.status<300)break;if(u.includes(a.status))break}catch(e){r=e,r.name===m.AbortError?(r=new Error("Timed out"),r.name=m.NetworkError):(r=new Error(`Fetch error: ${r.message}`),r.name=m.NetworkError)}await h(o,100),n&&clearTimeout(n)}if(void 0!==a)return a;throw r}(s),d=i.status,p=await i.text();let g;try{g=JSON.parse(p)}catch(e){throw new c({name:m.InvalidResponseError,message:"Response body is not a valid JSON",cause:e,status:d})}if(d>=200&&d<300){const e=g;if(!(e=>{var a,t,r,o;return!!((null==e?void 0:e.basePath)&&(null==e?void 0:e.versionId)&&(null!==(t=null===(a=null==e?void 0:e.metadata)||void 0===a?void 0:a.module)&&void 0!==t?t:null===(o=null===(r=null==e?void 0:e.metadata)||void 0===r?void 0:r.assets)||void 0===o?void 0:o.length))})(e))throw new c({name:m.InvalidResponseError,message:"Invalid metadata structure in response body"});return e}const v=`HTTP get request failed with status: '${d}', error: '${g.code}' and message: '${g.message}'`;throw new c({name:m.InvalidResponseError,message:v,status:d})})(o);return await import(n.basePath+(null===(t=n.metadata.module)||void 0===t?void 0:t.path))})(s,p).then((t=>{a=t.renderToDom({...e})})).catch((e=>{console.error("Failed to import widget",e),n(e)})),()=>null==a?void 0:a()}),[]),o?d().createElement("div",null,"Unable to load data explorer."):d().createElement("div",{id:e.domId,style:{display:"contents"}})},g=["localhost","127.0.0.1"].some((e=>document.location.href.includes(e)))?"http://localhost:3000":"";class v extends o.ReactWidget{constructor({theme:e}){super(),this.metadata={projectId:"",domainId:"",region:"",envId:"",userId:"",dzEndpoint:"",dzRegion:"",dzStage:"",enabledFeatures:[]},this.addClass("md-de-container"),this.fetchEnv(),this.theme=e,this.theme.themeChanged.connect(((e,a)=>{this.render()}))}fetchEnv(){fetch(`${g}/jupyterlab/default/api/env`).then((e=>e.json())).then((e=>{if(this.metadata={domainId:e.domain_id,projectId:e.project_id,region:e.aws_region,envId:e.environment_id,userId:e.user_id,dzEndpoint:e.dz_endpoint||`https://datazone.${e.dz_region}.api.aws`,dzStage:e.dz_stage,dzRegion:e.dz_region,enabledFeatures:e.enabled_features||[]},Object.values(this.metadata).some((e=>!e)))throw new Error("Missing required metadata from the response")})).catch((e=>console.error("[DataSourceExplorerWidget] an error occurred: ",e)))}render(){const e=this.theme.theme&&this.theme.isLight(this.theme.theme)?"light":"dark";return d().createElement(p,{domId:"data-explorer-widget-in-jl",consumerType:"jupyter-lab",credentialProvider:async()=>{const e=await fetch(`${g}/jupyterlab/default/api/creds`),a=await e.json(),t={accessKeyId:a.access_key,secretAccessKey:a.secret_key,sessionToken:a.session_token,expiration:new Date(Date.now()+3e5)};return t?Promise.resolve(t):Promise.reject("Credentials not found or expired")},envMetaData:this.metadata,stage:this.metadata.dzStage,themeConfig:{defaultMode:e}})}}const w=new n.LabIcon({name:"barpkg:foo",svgstr:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 9C16.4182 9 20 7.65674 20 6C20 4.34326 16.4182 3 12 3C7.58179 3 4 4.34326 4 6C4 7.65674 7.58179 9 12 9Z" fill="#FBFAFD"/> <path d="M4 8.5V12C4 13.6567 7.58179 15 12 15C16.4182 15 20 13.6567 20 12V8.5C20 10.1567 16.4182 11.5 12 11.5C7.58179 11.5 4 10.1567 4 8.5Z" fill="#FBFAFD" /><path d="M4 14.5V18C4 19.6567 7.58179 21 12 21C16.4182 21 20 19.6567 20 18V14.5C20 16.1567 16.4182 17.5 12 17.5C7.58179 17.5 4 16.1567 4 14.5Z" fill="#FBFAFD" /></svg>'}),f={id:"@amzn/sagemaker-data-explorer-jl-plugin:plugin",autoStart:!0,optional:[o.IThemeManager],activate:(e,a)=>{console.log("sagemaker-data-explorer-jl-plugin is activated!");const t=new s.Panel;t.id="sagemaker-data-explorer",t.title.icon=w,t.addWidget(new v({theme:a})),e.shell.add(t,"left",{rank:101})}}}}]);