"use strict";(self.webpackChunk_jlab_enhanced_launcher=self.webpackChunk_jlab_enhanced_launcher||[]).push([[912],{912:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var s=a(908),n=a(569),c=a(928),r=a(650),o=a(507),i=a(135),l=a(579),d=a(989),h=a(53),m=a(808),u=a(12),p=a(197),g=a(256),w=a(345);const v=new d.LabIcon({name:"enhLauncher:most-used",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>'}),_=new d.LabIcon({name:"enhLauncher:list",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M4 14h4v-4H4v4zm0 5h4v-4H4v4zM4 9h4V5H4v4zm5 5h12v-4H9v4zm0 5h12v-4H9v4zM9 5v4h12V5H9z"/></svg>'}),N=new d.LabIcon({name:"enhLauncher:module",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="#616161" d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z"/></svg>'}),f="@jlab-enhanced/launcher:plugin",L=["Notebook","Console"];class b extends n.VDomModel{constructor(e,t){super(),this._items=[],this._settings=null,this._state=null,this._usageData={},this._viewMode="cards",this._settings=e||null,this._state=t||null,this.dispose()}static getItemUID(e){return`${e.command}${JSON.stringify(e.args||{})}`}get categories(){return this._settings?this._settings.composite.categories:["Kernels","Other"]}get nRecentCards(){return this._settings?this._settings.composite.nRecentCards:4}get maxUsageAge(){let e=30;return this._settings&&(e=this._settings.composite.maxUsageAge),24*e*3600*1e3}get usage(){return this._usageData}get viewMode(){return this._viewMode}set viewMode(e){const t=this._viewMode!==e;this._viewMode=e,this._state&&t&&this._state.save(`${f}:viewMode`,e).catch((e=>{console.error("Fail to save view mode",e)}))}add(e){const t=y.createItem(e);return this._items.push(t),this.stateChanged.emit(void 0),new u.DisposableDelegate((()=>{h.ArrayExt.removeFirstOf(this._items,t),this.stateChanged.emit(void 0)}))}items(){return this._items.map((e=>{const t=b.getItemUID(e),a=this._usageData[t]||{count:0,mostRecent:0};return{...e,...a}}))[Symbol.iterator]()}useCard(e){const t=b.getItemUID(e),a=this._usageData[t],s=Date.now();let n=0;a&&s-a.mostRecent<this.maxUsageAge&&(n=a.count),this._usageData[t]={count:n+1,mostRecent:s},this._state&&this._state.save(`${f}:usageData`,this._usageData).catch((e=>{console.error(`Failed to save ${f}:usageData - ${e.message}`,e)}))}}class E extends n.VDomRenderer{constructor(e){super(e.model),this._cwd="",this._pending=!1,this._searchInput="",this._cwd=e.cwd,this.translator=e.translator||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._callback=e.callback,this._commands=e.commands,this.addClass("jp-NewLauncher")}get cwd(){return this._cwd}set cwd(e){this._cwd=e,this.update()}get pending(){return this._pending}set pending(e){this._pending=e}render(){if(!this.model)return null;const e="cards"===this.model.viewMode?"":"-Table",t=Object.create(null);[...this.model.items()].forEach((e=>{const a=e.category||"Other";a in t||(t[a]=[]),t[a].push([e])}));const a=t.Notebook;a&&delete t.Notebook;const s=t.Console;s&&delete t.Console;const n=a;s.forEach((e=>{const t=e[0].args.kernelPreference&&e[0].args.kernelPreference.name||"",a=this._commands.label(e[0].command,e[0].args),s=n.find((e=>{const s=e[0].args.kernelName||"";return this._commands.label(e[0].command,e[0].args)===a&&s===t}));s?s.push(e[0]):n.push(e)})),t.Kernels=n;for(const e in t)t[e]=t[e].sort(((e,t)=>y.sortCmp(e[0],t[0],this._cwd,this._commands)));const c=[],r=[];this.model.categories.forEach((e=>{e in t&&r.push(e)}));for(const e in t)-1===this.model.categories.indexOf(e)&&r.push(e);const o=Array.from(this.model.items()).sort(((e,t)=>y.sortByUsage(e,t,this.model.maxUsageAge,this._cwd,this._commands)));if(""===this._searchInput){const t=w.createElement("div",{className:"jp-NewLauncher-section",key:"most-used"},w.createElement("div",{className:"jp-NewLauncher-sectionHeader"},w.createElement(v.react,{stylesheet:"launcherSection"}),w.createElement("h2",{className:"jp-NewLauncher-sectionTitle"},this._trans.__("Most Used"))),w.createElement("div",{className:`jp-NewLauncher${e}-cardContainer`},Array.from((0,h.map)(o.slice(0,this.model.nRecentCards),(e=>C(L.indexOf(e.category||"Other")>-1,[e],this,this._commands,this._trans,this._callback))))));c.push(t)}return r.forEach((a=>{if(0===t[a].length)return;const s=t[a][0][0],n={...s.args,cwd:this.cwd},r="Kernels"===a,o=this._commands.iconClass(s.command,n),i=this._commands.icon(s.command,n),l=w.createElement("div",{className:"jp-NewLauncher-section",key:a},w.createElement("div",{className:"jp-NewLauncher-sectionHeader"},w.createElement(d.LabIcon.resolveReact,{icon:i,iconClass:(0,d.classes)(o,"jp-Icon-cover"),stylesheet:"launcherSection"}),w.createElement("h2",{className:"jp-NewLauncher-sectionTitle"},this._trans.__(a))),w.createElement("div",{className:`jp-NewLauncher${e}-cardContainer`},Array.from((0,h.map)(t[a],(e=>{const t=e[0],a=t.command,s={...t.args,cwd:this.cwd};return-1===this._commands.label(a,s).toLocaleLowerCase().indexOf(this._searchInput.toLocaleLowerCase())?null:C(r,e,this,this._commands,this._trans,this._callback)})))));c.push(l)})),w.createElement("div",{className:"jp-NewLauncher-body"},w.createElement("div",{className:"jp-NewLauncher-content"},w.createElement("div",{className:"jp-NewLauncher-toolbar"},w.createElement("div",{className:"jp-NewLauncher-search"},w.createElement("div",{className:"jp-NewLauncher-search-wrapper"},w.createElement("input",{className:"jp-NewLauncher-search-input",spellCheck:!1,placeholder:"SEARCH",onChange:e=>{this._searchInput=e.target.value||"",this.update()}}))),w.createElement("div",{className:"jp-NewLauncher-cwd"},w.createElement(d.folderIcon.react,{className:"jp-NewLauncher-home",tag:"span",title:m.PageConfig.getOption("serverRoot")||"Jupyter Server Root",margin:"0px 2px"}),w.createElement("h3",{title:this.cwd},`${this.cwd}/`)),w.createElement("div",{className:"jp-NewLauncher-view"},w.createElement("button",{disabled:"cards"===this.model.viewMode,onClick:()=>{this.model.viewMode="cards",this.update()}},w.createElement(N.react,{tag:"span",title:"Card view",elementPosition:"center"})),w.createElement("button",{disabled:"table"===this.model.viewMode,onClick:()=>{this.model.viewMode="table",this.update()}},w.createElement(_.react,{tag:"span",title:"Table view",elementPosition:"center"})))),w.createElement("div",{className:"jp-NewLauncher-content-main"},c)))}}function C(e,t,a,s,c,r){const o="cards"===a.model.viewMode?"":"-Table",i=t[0],l=i.command,h={...i.args,cwd:a.cwd},m=s.caption(l,h),u=s.label(l,h),p=e?u:m||u,v=e=>t=>{t.stopPropagation(),!0!==a.pending&&(a.pending=!0,s.execute(e.command,{...e.args,cwd:a.cwd}).then((t=>{a.model.useCard(e),a.pending=!1,t instanceof g.Widget&&(r(t),a.dispose())})).catch((e=>{a.pending=!1,(0,n.showErrorMessage)(c._p("Error","Launcher Error"),e)})))},_=v(i),N=s.iconClass(l,h),f=s.icon(l,h);return w.createElement("div",{className:`jp-NewLauncher-item${o}`,title:p,onClick:_,onKeyPress:e=>{"Enter"===e.key&&_(e)},tabIndex:100,"data-category":i.category||"Other",key:y.keyProperty.get(i)},w.createElement("div",{className:`jp-NewLauncherCard-icon jp-NewLauncher${o}-Cell`},e?i.kernelIconUrl?w.createElement("img",{src:i.kernelIconUrl,className:"jp-NewLauncher-kernelIcon"}):w.createElement("div",{className:"jp-NewLauncherCard-noKernelIcon"},u[0].toUpperCase()):w.createElement(d.LabIcon.resolveReact,{icon:f,iconClass:(0,d.classes)(N,"jp-Icon-cover"),stylesheet:"launcherCard"})),w.createElement("div",{className:`jp-NewLauncher-label jp-NewLauncher${o}-Cell`,title:u},u),w.createElement("div",{className:`jp-NewLauncher-options-wrapper jp-NewLauncher${o}-Cell`},w.createElement("div",{className:"jp-NewLauncher-options"},(e=>e.map((t=>{let a="Open";return t.category&&(e.length>1||L.indexOf(t.category)>-1)&&(a=t.category),w.createElement("div",{className:"jp-NewLauncher-option-button",key:a.toLowerCase(),onClick:v(t)},w.createElement("span",{className:"jp-NewLauncher-option-button-text"},a.toUpperCase()))})))(t))))}var y,j;!function(e){let t=0;function a(e,t,a,s){const n=e.rank,c=t.rank;if(n!==c&&void 0!==n&&void 0!==c)return n<c?-1:1;const r=s.label(e.command,{...e.args,cwd:a}),o=s.label(t.command,{...t.args,cwd:a});return r.localeCompare(o)}e.keyProperty=new p.AttachedProperty({name:"key",create:()=>t++}),e.createItem=function(e){return{...e,category:e.category||"",rank:void 0!==e.rank?e.rank:1/0}},e.sortCmp=a,e.sortByUsage=function(e,t,s,n,c){const r=Date.now(),o=r-e.mostRecent<s?e.count:0,i=r-t.mostRecent<s?t.count:0;if(o===i){const s=t.mostRecent-e.mostRecent;return 0===s?a(e,t,n,c):s}return i-o}}(y||(y={})),function(e){e.create="launcher:create"}(j||(j={}));const k={activate:async function(e,t,a,s,c,r,o){const{commands:i,shell:l}=e,m=t.load("jupyterlab");let u=null;if(r)try{u=await r.load(f)}catch(e){console.log(`Failed to load settings for ${f}.`,e)}const p=new b(u,o);return o&&Promise.all([o.fetch(`${f}:usageData`),o.fetch(`${f}:viewMode`),e.restored]).then((([e,t])=>{p.viewMode=t||"cards";for(const t in e)p.usage[t]=e[t]})).catch((e=>{console.error("Fail to restore launcher usage data",e)})),i.addCommand(j.create,{label:m.__("New Launcher"),icon:e=>e.toolbar?d.addIcon:void 0,execute:e=>{var s,r;const o=null!==(r=null!==(s=e.cwd)&&void 0!==s?s:null==c?void 0:c.model.path)&&void 0!==r?r:"",u="launcher-"+I.id++,g=new E({model:p,cwd:o,callback:e=>{(0,h.find)(l.widgets("main"),(t=>t===e))&&(l.add(e,"main",{ref:u}),g.dispose())},commands:i,translator:t});g.model=p,g.title.icon=d.launcherIcon,g.title.label=m.__("Launcher");const w=new n.MainAreaWidget({content:g});if(w.title.closable=!!Array.from(l.widgets("main")).length,w.id=u,l.add(w,"main",{activate:e.activate,ref:e.ref}),a&&a.layoutModified.connect((()=>{w.title.closable=Array.from(a.widgets("main")).length>1}),w),c){const e=e=>{g.cwd=e.path};c.model.pathChanged.connect(e),g.disposed.connect((()=>{c.model.pathChanged.disconnect(e)}))}return w}}),a&&Promise.all([e.restored,null==c?void 0:c.model.restored]).then((()=>{a.layoutModified.connect((()=>{a.isEmpty("main")&&i.execute(j.create)}))})),s&&s.addItem({command:j.create,category:m.__("Launcher")}),a&&(a.addButtonEnabled=!0,a.addRequested.connect(((e,t)=>{var a;const s=(null===(a=t.currentTitle)||void 0===a?void 0:a.owner.id)||t.titles[t.titles.length-1].owner.id;return i.execute(j.create,{ref:s})}))),p},id:f,requires:[l.ITranslator],optional:[s.ILabShell,n.ICommandPalette,c.IDefaultFileBrowser,o.ISettingRegistry,i.IStateDB],provides:r.ILauncher,autoStart:!0};var I;!function(e){e.id=0}(I||(I={}))}}]);