<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="report_aged_partner_balance_lines_header" inherit_id="account_financial_report.report_aged_partner_balance_lines_header">
    <xpath expr="//div/div/div[1]" position="attributes">
      <attribute name="style">width: 27.73%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[2]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[3]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[4]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[5]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[6]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[7]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[8]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/div[1]" position="after">
      <div class="act_as_cell" style="width: 8.03%;">VAT</div>
    </xpath>
    <xpath expr="//div/div/div[4]" position="after">
      <!--## due-->
      <div class="act_as_cell" style="width: 8.03%;">Due</div>
    </xpath>
  </template>
  <template id="report_aged_partner_balance_lines" inherit_id="account_financial_report.report_aged_partner_balance_lines">
    <xpath expr="//span[@t-field = 'line.partner']/.." position="after">
      <div class="act_as_cell left">
        <span t-field="line.vat" />
      </div>
    </xpath>
    <xpath expr="//span[@t-field = 'line.current']/.." position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount">
        <span t-field="line.amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
    </xpath>
  </template>
  <template id="report_aged_partner_balance_move_lines" inherit_id="account_financial_report.report_aged_partner_balance_move_lines">
    <xpath expr="//div/div/div/div[9]" position="after">
      <!--## amount_due-->
      <div class="act_as_cell" style="width: 6.00%;">Amount due</div>
    </xpath>
    <xpath expr="//div/div/div/div[5]" position="after">
      <!--## vat-->
      <div class="act_as_cell" style="width: 6.00%;">VAT</div>
    </xpath>
    <xpath expr="//t[@t-raw='line.partner']/../../.." position="after">
      <!--## partner-->
        <div class="act_as_cell left">
            <span>
                <a t-att-data-active-id="line.move_line_id.partner_id.id"
                   t-att-data-res-model="'res.partner'"
                   class="o_account_financial_reports_web_action"
                   style="color: black;">
                   <t t-raw="line.vat"/>
                </a>
            </span>
        </div>
    </xpath>
    <xpath expr="//t[@t-if='line.current != 0']/.." position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount">
        <t t-if="line.amount_due != 0">
          <span>
            <a t-att-data-domain="[('id', 'in', (line.move_line_id | line.move_line_id.matched_debit_ids.mapped('debit_move_id') | line.move_line_id.matched_credit_ids.mapped('credit_move_id')).ids)]"
              t-att-data-res-model="'account.move.line'"
              class="o_account_financial_reports_web_action_multi"
              style="color: black;">
            <t t-raw="line.amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
          </span>
        </t>
        <t t-if="line.amount_due == 0">
            <span t-field="line.amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
        </t>
      </div>
    </xpath>
    <xpath expr="//div/div/div/div[1]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[2]" position="attributes">
      <attribute name="style">width: 7.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[3]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[4]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[5]" position="attributes">
      <attribute name="style">width: 10.5%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[6]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[7]" position="attributes">
      <attribute name="style">width: 17.50%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[8]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[9]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[10]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[11]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[12]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[13]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[14]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[15]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/div/div[16]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
  </template>
  <template id="report_aged_partner_balance_account_ending_cumul" inherit_id="account_financial_report.report_aged_partner_balance_account_ending_cumul">
    <xpath expr="//div/div/t[2]/div[1]" position="attributes">
      <attribute name="style">width: 55%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[2]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[3]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[4]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[5]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[6]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[7]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[8]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[2]/div[9]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[1]" position="attributes">
      <attribute name="style">width: 55%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[2]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[3]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[4]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[5]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[6]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[7]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[8]" position="attributes">
      <attribute name="style">width: 5.00%;</attribute>
    </xpath>
    <xpath expr="//div/div[1]/t[2]/div[4]" position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount" style="width: 5.00%;">
        <span t-field="account.cumul_amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
    </xpath>
    <xpath expr="//div/div[2]/t[2]/div[4]" position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount" style="width: 5.00%;">
        <span t-field="account.percent_amount_due"/>%
      </div>
    </xpath>
    <xpath expr="//div/div/t[1]/div[1]" position="attributes">
      <attribute name="style">width: 35.76%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[2]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[3]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[4]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[5]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[6]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[7]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div/t[1]/div[8]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[1]" position="attributes">
      <attribute name="style">width: 35.76%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[2]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[3]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[4]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[5]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[6]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[7]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[8]" position="attributes">
      <attribute name="style">width: 8.03%;</attribute>
    </xpath>
    <xpath expr="//div/div[1]/t[1]/div[3]" position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount" style="width: 8.03%;">
        <span t-field="account.cumul_amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
    </xpath>
    <xpath expr="//div/div[2]/t[1]/div[3]" position="after">
      <!--## amount_due-->
      <div class="act_as_cell amount" style="width: 8.03%;">
        <span t-field="account.percent_amount_due"/>%
      </div>
    </xpath>
  </template>
  <template id="report_aged_partner_balance_partner_cummul_lines">
    <!-- # lines -->
    <div class="act_as_row lines">
      <!--## partner-->
      <div class="act_as_cell left">
        <span t-field="line.name"/>
      </div>
      <div class="act_as_cell left">
        <span t-field="line.vat" />
      </div>
      <!--## amount_residual-->
      <div class="act_as_cell amount">
        <span t-field="line.amount_residual" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## current-->
      <div class="act_as_cell amount">
        <span t-field="line.current" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## amount_due-->
      <div class="act_as_cell amount">
        <span t-field="line.amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## age_30_days-->
      <div class="act_as_cell amount">
        <span t-field="line.age_30_days" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## age_60_days-->
      <div class="act_as_cell amount">
        <span t-field="line.age_60_days" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## age_90_days-->
      <div class="act_as_cell amount">
        <span t-field="line.age_90_days" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## age_120_days-->
      <div class="act_as_cell amount">
        <span t-field="line.age_120_days" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
      <!--## older-->
      <div class="act_as_cell amount">
        <span t-field="line.older" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
      </div>
    </div>
   </template>
   <template id="report_aged_partner_balance_base" inherit_id="account_financial_report.report_aged_partner_balance_base">
     <xpath expr="//t[@t-foreach='o.account_ids']" position="replace">
      <t t-if="o.group_by_select=='partner'">
	      <div class="page_break">
	        <!-- Display account header -->
	        <div class="act_as_table list_table" style="margin-top: 10px;"/>

	        <!-- Display account lines -->
	        <t t-if="not show_move_line_details">
	            <div class="act_as_table data_table" style="width: 100%;">
	                <!-- Display account header -->
	                <t t-call="account_financial_report.report_aged_partner_balance_lines_header"/>

	                <t t-foreach="o.partner_cummuls_ids" t-as="line">

	                    <!-- Display one line per partner -->
	                    <t t-call="somconnexio.report_aged_partner_balance_partner_cummul_lines"/>
	                </t>
	            </div>
	        </t>
	        <t t-if="show_move_line_details">
              <!-- Display account partners -->
              <t t-foreach="o.partner_cummuls_ids" t-as="partner">
                  <div class="page_break">
                      <!-- Display partner header -->
                      <div class="act_as_caption account_title">
                          <span t-field="partner.name"/>
                      </div>

                      <!-- Display partner move lines -->
                      <t t-call="account_financial_report.report_aged_partner_balance_move_lines"/>

                      <!-- Display partner footer -->
                      <t t-call="account_financial_report.report_aged_partner_balance_partner_ending_cumul">
                          <t t-set="partner_cumul_line" t-value="partner"/>
                      </t>
                  </div>
              </t>
	        </t>
	       </div>
      </t>
      <t t-if="o.group_by_select=='account'">
          <t t-foreach="o.account_ids" t-as="account">
              <div class="page_break">
                  <!-- Display account header -->
                  <div class="act_as_table list_table" style="margin-top: 10px;"/>
                  <div class="act_as_caption account_title"
                       style="width: 100%;">
                      <span t-field="account.code"/>
                      -
                      <span t-field="account.name"/>
                  </div>

                  <!-- Display account lines -->
                  <t t-if="not show_move_line_details">
                      <div class="act_as_table data_table"
                           style="width: 100%;">
                          <!-- Display account header -->
                          <t t-call="account_financial_report.report_aged_partner_balance_lines_header"/>

                          <t t-foreach="account.partner_ids" t-as="partner">

                              <!-- Display one line per partner -->
                              <t t-call="account_financial_report.report_aged_partner_balance_lines"/>
                          </t>
                      </div>

                      <!-- Display account footer -->
                      <t t-call="account_financial_report.report_aged_partner_balance_account_ending_cumul"/>
                  </t>

                  <!-- Display account move lines -->
                  <t t-if="show_move_line_details">

                      <!-- Display account partners -->
                      <t t-foreach="account.partner_ids" t-as="partner">
                          <div class="page_break">
                              <!-- Display partner header -->
                              <div class="act_as_caption account_title">
                                  <span t-field="partner.name"/>
                                  -
                                  <span t-field="partner.vat"/>
                              </div>

                              <!-- Display partner move lines -->
                              <t t-call="account_financial_report.report_aged_partner_balance_move_lines"/>

                              <!-- Display partner footer -->
                              <t t-call="account_financial_report.report_aged_partner_balance_partner_ending_cumul">
                                  <t t-set="partner_cumul_line" t-value="partner.line_ids"/>
                              </t>
                          </div>
                      </t>

                      <!-- Display account footer -->
                      <t t-call="account_financial_report.report_aged_partner_balance_account_ending_cumul"/>
                  </t>
              </div>
          </t>
      </t>
     </xpath>
   </template>
   <template id="report_aged_partner_balance_partner_ending_cumul" inherit_id="account_financial_report.report_aged_partner_balance_partner_ending_cumul">
     <xpath expr="//div/div/div[4]" position="after">
          <!--## current-->
          <div class="act_as_cell amount" style="width: 5.00%;">
              <span t-field="partner_cumul_line.amount_due" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
          </div>
     </xpath>
     <xpath expr="//div/div/div[1]" position="attributes">
          <attribute name="style">width: 55.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[2]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[3]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[4]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[5]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[6]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[7]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[8]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[9]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
     <xpath expr="//div/div/div[10]" position="attributes">
       <attribute name="style">width: 5.00%;</attribute>
     </xpath>
   </template>
</odoo>