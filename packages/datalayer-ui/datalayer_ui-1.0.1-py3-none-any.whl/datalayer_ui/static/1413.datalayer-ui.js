"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[1413],{19326:(e,t,n)=>{n.d(t,{Ui:()=>a,vw:()=>o});var r=n(97283),s=n(7282);const o=(0,r.y)(((e,t)=>({cells:new Map,source:"",outputsCount:0,adapter:void 0,areAllKernelSessionsReady:!1,isAnyCellExecuting:!1,setCells:t=>e((e=>({cells:t}))),setSource:(n,r)=>{const s=t().cells,o=s.get(n);o?o.source=r:s.set(n,{source:r}),e((e=>({cells:s})))},setOutputsCount:(n,r)=>{const s=t().cells,o=s.get(n);o?o.outputsCount=r:s.set(n,{outputsCount:r}),e((e=>({cells:s})))},setKernelSessionAvailable:(n,r)=>{const s=t().cells,o=s.get(n);o?o.isKernelSessionAvailable=r:s.set(n,{isKernelSessionAvailable:r});const a=(e=>{for(const t of e.values())if(!t.isKernelSessionAvailable)return!1;return!0})(s);e((e=>({cells:s,areAllKernelSessionsReady:a})))},setAdapter:(n,r)=>{const s=t().cells,o=s.get(n);o?o.adapter=r:s.set(n,{adapter:r}),e((e=>({cells:s})))},getAdapter:e=>t().cells.get(e)?.adapter,getSource:e=>t().cells.get(e)?.source,getOutputsCount:e=>t().cells.get(e)?.outputsCount,isKernelSessionAvailable:e=>t().cells.get(e)?.isKernelSessionAvailable,execute:e=>{const n=t().cells.get(e);n?n.adapter?.execute():t().cells.forEach((e=>e.adapter?.execute()))},setIsExecuting:(n,r)=>{const s=t().cells,o=s.get(n);o?o.isExecuting=r:(t().cells.forEach((e=>e.adapter?.execute())),s.set(n,{isExecuting:r}));const a=(e=>{for(const t of e.values())if(t.isExecuting)return!0;return!1})(s);e((e=>({cells:s,isAnyCellExecuting:a})))}})));function a(e){return(0,s.Pj)(o,e)}},55388:(e,t,n)=>{n.d(t,{A4:()=>o,LC:()=>a});var r=n(97283),s=n(7282);const o=(0,r.y)(((e,t)=>({outputs:new Map,getAdapter:e=>t().outputs.get(e)?.adapter,getInput:e=>t().outputs.get(e)?.input,getModel:e=>t().outputs.get(e)?.model,getDataset:e=>t().outputs.get(e)?.dataset,getExecuteRequest:e=>t().outputs.get(e)?.code,getGradeSuccess:e=>t().outputs.get(e)?.gradeSuccess,setOutputs:(t,n)=>e((e=>({outputs:n}))),setAdapter:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.adapter=r:s.set(n,{adapter:r}),e((e=>({outputs:s})))},setDataset:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.dataset=r:s.set(n,{dataset:r}),e((e=>({outputs:s})))},setExecuteRequest:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.code=r:s.set(n,{code:r}),e((e=>({outputs:s})))},setModel:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.model=r:s.set(n,{model:r}),e((e=>({outputs:s})))},setInput:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.input=r:s.set(n,{input:r}),e((e=>({outputs:s})))},setGradeSuccess:(n,r)=>{const s=t().outputs,o=s.get(n);o?o.gradeSuccess=r:s.set(n,{gradeSuccess:r}),e((e=>({outputs:s})))}})));function a(e){return(0,s.Pj)(o,e)}},42968:(e,t,n)=>{n.d(t,{V9:()=>p,kA:()=>g,PD:()=>u}),n(18683);var r=n(9387),s=n(97789),o=n(74354),a=n(63711);class i extends Error{}const l=i,c=(0,r.createContext)(void 0),u=(c.Consumer,c.Provider,e=>{const t=(0,r.useContext)(c);if(t)return t;const{jupyterConfig:n,kernel:s,kernelIsLoading:a,serviceManager:i}=(0,o.zV)(e??{});return{defaultKernel:s,jupyterServerUrl:n.jupyterServerUrl,kernel:s,kernelIsLoading:a,kernelManager:i?.kernels,lite:e?.lite,serverless:e?.serverless??!1,serverSettings:i?.serverSettings,serviceManager:i}}),g=async e=>{try{return await async function(e,t="api",n="",r={}){const o=a.URLExt.join(e.baseUrl,t,n);let i;try{if(i=await s.ServerConnection.makeRequest(o,r,e),403===i.status)throw new l}catch(e){throw new s.ServerConnection.NetworkError(e)}let c=await i.text();if(c.length>0)try{c=JSON.parse(c)}catch(e){console.warn("Not a JSON response body.",i)}if(!i.ok)throw new s.ServerConnection.ResponseError(i,c.message||c);return c}(e,"api",""),!0}catch(e){return console.log("The Jupyter Server API has failed with reason",e),!1}},p=(e,t)=>s.ServerConnection.makeSettings({baseUrl:e,wsUrl:e.replace(/^http/,"ws"),token:t,appendToken:!0,init:{mode:"cors",credentials:"include",cache:"no-store"}})},74354:(e,t,n)=>{n.d(t,{uJ:()=>P,zV:()=>A});var r=n(9387),s=n(97283),o=n(7282),a=n(97789);const i="python";var l=n(25170),c=n(63711);const u=(e=!0)=>async function(){const e=[],t=await Promise.all([n.e(2252),n.e(4883),n.e(1570)]).then(n.bind(n,61570));for(const n of function*(e){let t;t=e.hasOwnProperty("__esModule")?e.default:e;const n=Array.isArray(t)?t:[t];for(const e of n)c.PageConfig.Extension.isDisabled(e.id)?console.info(`JupyterLite plugin '${e.id}' has been disabled.`):yield e}(t))e.push(n);const r=new l.Z({});return r.registerPluginModules(e),await r.start(),r}().then((async t=>{const r="boolean"==typeof e?await Promise.all([n.e(2252),n.e(7952)]).then(n.bind(n,10382)):await e;let s=r.default;Object.prototype.hasOwnProperty.call(r,"__esModule")||(s=r),Array.isArray(s)||(s=[s]);const o=s.map((e=>{try{return t.registerPlugin(e),e.id}catch(e){return console.error(e),null}}));await Promise.all(o.filter((e=>e)).map((e=>t.activatePlugin(e))));const a=t.serviceManager;return a.__NAME__="LiteServiceManager",console.log("Lite Service Manager is created",a),a}));var g=n(42968);let p,d=!1;const h=e=>{if(!p)throw new Error("Jupyter React Config must be loaded first.");c.PageConfig.setOption("baseUrl",e),c.PageConfig.setOption("wsUrl",e.replace(/^http/,"ws")),p.jupyterServerUrl=e},f=()=>{if(!p)throw new Error("Jupyter React Config must be loaded first.");return p.jupyterServerUrl},y=e=>{if(!p)throw new Error("Jupyter React Config must be loaded first.");c.PageConfig.setOption("token",e),p.jupyterServerToken=e},k=(e={})=>{const{collaborative:t,jupyterServerToken:n,jupyterServerUrl:r,lite:s,terminals:o}=e;if(p)return console.log("Returning existing Jupyter React config",p),p;if(p={jupyterServerUrl:r??"https://oss.datalayer.run/api/jupyter-server",jupyterServerToken:n??"60c1661cc408f978c309d04157af55c9588ff9557c9380e4fb50785750703da6",insideJupyterLab:!1,insideJupyterHub:!1},function(){if(!d){const e=document.getElementById("datalayer-config-data");if(e?.textContent){console.log("Found Datalayer config data in page",e);try{p={...p,...JSON.parse(e.textContent)},d=!0}catch(e){console.error("Failed to parse the Datalayer configuration.",e)}}else console.log("No Datalayer config data found in page")}}(),d)h(r||p.jupyterServerUrl),y(n||p.jupyterServerToken);else{const e=document.getElementById("jupyter-config-data");if(e){const t=JSON.parse(e.textContent||"");h(r??t.jupyterServerUrl??location.protocol+"//"+location.host+t.baseUrl),y(n??t.token??""),p.insideJupyterLab="JupyterLab"===t.appName,p.insideJupyterHub=""!==c.PageConfig.getOption("hubHost")}else h(r??p.jupyterServerUrl??location.protocol+"//"+location.host+"/api/jupyter-server"),y(n??p.jupyterServerToken??"")}return s&&h(location.protocol+"//"+location.host),p.insideJupyterLab||(c.PageConfig.setOption("baseUrl",f()),c.PageConfig.setOption("wsUrl",f().replace(/^http/,"ws")),c.PageConfig.setOption("token",(()=>{if(!p)throw new Error("Jupyter React Config must be loaded first.");return p.jupyterServerToken})()),c.PageConfig.setOption("collaborative",String(t)),c.PageConfig.setOption("disableRTC",String(!t)),c.PageConfig.setOption("terminalsAvailable",String(o)),c.PageConfig.setOption("mathjaxUrl","https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"),c.PageConfig.setOption("mathjaxConfig","TeX-AMS_CHTML-full,Safe")),console.log("Created config for Jupyter React",p),p};var S=n(42389),v=n(38921),_=n(98238),m=n(34417),C=n(36848);class w{_clientId;_connectionStatus;_id;_info;_kernelConnection;_kernelManager;_kernelName;_kernelSpecManager;_kernelSpecName;_kernelType;_path;_ready;_session;_sessionId;_sessionManager;constructor(e){const{kernelManager:t,kernelName:n,kernelType:r,kernelspecsManager:s,kernelSpecName:o,kernelModel:a,path:i,sessionManager:l}=e;this._kernelSpecManager=s,this._kernelManager=t,this._kernelName=n,this._kernelType=r??"notebook",this._kernelSpecName=o,this._sessionManager=l,this._ready=new _.PromiseDelegate,this.requestKernel(a,i)}async requestKernel(e,t){if(await this._kernelManager.ready,await this._sessionManager.ready,e){await this._kernelManager.refreshRunning();const t=Array.from(this.kernelManager.running()),n=(0,v.I6)(t,(t=>e.id===t.id));if(!n)return void console.log("Something is wrong... can not find an existing model for",e);{console.log("Creating a session to an existing Jupyter Kernel model.",n);const t="kernel-"+e.id;this._path=t,this._session=await this._sessionManager.startNew({name:n.name,path:t,type:"notebook",kernel:n},{kernelConnectionOptions:{handleComms:!0}})}}else{let e=t??(0,m.Ri)(this.cookieName);e||(e="path-"+(0,m.YG)(),document.cookie=this.cookieName+"="+e),this._path=e,this._session=await this._sessionManager.startNew({name:this._kernelName,path:this._path,type:this._kernelType,kernel:{name:this._kernelSpecName}},{kernelConnectionOptions:{handleComms:!0}})}this._kernelConnection=this._session.kernel;const n=()=>{"connected"===this._connectionStatus&&(this._clientId=this._session.kernel.clientId,this._id=this._session.kernel.id,this._ready.resolve())};this._kernelConnection&&(this._sessionId=this._session.id,this._connectionStatus=this._kernelConnection.connectionStatus,n(),this._kernelConnection.connectionStatusChanged.connect(((e,t)=>{this._connectionStatus=t,n()})),this._kernelConnection.info.then((e=>{this._info=e,console.log("Kernel Information.",e),console.log("Kernel Session.",this._session),console.log("Kernel Details.",this.toJSON())})))}get clientId(){return this._clientId}get connection(){return this._kernelConnection}get cookieName(){return"jupyter-react-kernel-path_"+this._kernelSpecName}get id(){return this._id}get info(){return this._info}get kernelManager(){return this._kernelManager}get kernelSpecManager(){return this._kernelSpecManager}get path(){return this._path}get ready(){return this._ready.promise}get sessionId(){return this._sessionId}get session(){return this._session}get sessionManager(){return this._sessionManager}execute(e,{model:t,iopubMessageHooks:n=[],shellMessageHooks:r=[],silent:s,stopOnError:o,storeHistory:a,allowStdin:i,suppressCodeExecutionErrors:l=!1,onExecutionPhaseChanged:c}={}){if(this._kernelConnection){const u=new C.A({connection:this._kernelConnection,model:t,onExecutionPhaseChanged:c});return u.execute(e,{iopubMessageHooks:n,shellMessageHooks:r,silent:s,stopOnError:o,storeHistory:a,allowStdin:i,suppressCodeExecutionErrors:l}),u}}interrupt(){return this._kernelConnection?.interrupt()??Promise.resolve()}restart(){return this._kernelConnection?.restart()??Promise.resolve()}async shutdown(){await(this._session.kernel?.shutdown()),this.connection?.dispose()}toJSON(){return{path:this._path,id:this.id,clientId:this.clientId,sessionId:this.sessionId,kernelInfo:this.info}}toString(){return`id:${this.id} - client_id:${this.clientId} - session_id:${this.sessionId} - path:${this._path}`}}var M=n(19326);const x=(0,s.y)(((e,t)=>({outputs:0,adapter:void 0,execute:()=>{},setOutputs:t=>e((e=>({outputs:t}))),setAdapter:t=>e((e=>({adapter:t})))})));var b=n(16476),j=n(55388);const I=(0,s.y)(((e,t)=>({dark:!1,adapter:void 0,setDark:t=>e((e=>({dark:t}))),setAdapter:t=>e((e=>({adapter:t})))})));let E;try{const e=document.getElementById("datalayer-config-data");e?.innerText&&(E=JSON.parse(e?.innerText))}catch(e){console.debug("Issue with page configuration.",e)}const P=(0,s.y)(((e,t)=>({collaborative:!1,datalayerConfig:E,version:"",jupyterConfig:void 0,kernelIsLoading:!0,kernel:void 0,serviceManager:void 0,serverSettings:void 0,cellsStore:M.vw.getState(),consoleStore:x.getState(),notebookStore:b.Fg.getState(),outputStore:j.A4.getState(),terminalStore:I.getState(),setDatalayerConfig:t=>{e((e=>({datalayerConfig:t})))},setJupyterConfig:t=>{e((e=>({jupyterConfig:t})))},setServiceManager:t=>{e((e=>({serviceManager:t})))},setVersion:n=>{n&&!t().version&&e((e=>({version:n})))}})));function A(e){const{defaultKernelName:t=i,initCode:n="",jupyterServerToken:s=e.serviceManager?.serverSettings.token??"",jupyterServerUrl:l=e.serviceManager?.serverSettings.baseUrl??"",lite:c=!1,serverless:p,serviceManager:d,startDefaultKernel:h=!1,terminals:y=!1,useRunningKernelId:v=e.useRunningKernelId,useRunningKernelIndex:_=e.useRunningKernelIndex||-1}=e,m=(0,r.useMemo)((()=>{const e=k({lite:c,jupyterServerUrl:l,jupyterServerToken:s,terminals:y});return P.getState().setJupyterConfig(e),e}),[]),[C,M]=(0,r.useState)(d),[x,b]=(0,r.useState)(),[j,I]=(0,r.useState)(h||_>-1);return(0,r.useEffect)((()=>{d&&(console.log("Setting Service Manager from props",d),M(d),P.getState().setServiceManager(d))}),[d]),(0,r.useEffect)((()=>{if(p){const e=new S.Od;return M(e),void P.getState().setServiceManager(e)}if(!C){if(c)return void u(c).then((e=>{M(e),P.getState().setServiceManager(e)}));const e=(0,g.V9)(m.jupyterServerUrl,m.jupyterServerToken);(0,g.kA)(e).then((t=>{if(!t){const e=f()+"/login?next="+window.location;console.warn("You need to authenticate on the Jupyter Server URL",e)}if(v&&_>-1)throw new Error("You can not ask for useRunningKernelId and useRunningKernelIndex at the same time.");if(h&&(v||_>-1))throw new Error("You can not ask for startDefaultKernel and (useRunningKernelId or useRunningKernelIndex) at the same time.");const n=new a.ServiceManager({serverSettings:e});M(n),P.getState().setServiceManager(n)}))}}),[c,p,l]),(0,r.useEffect)((()=>{console.log("Checking kernels for the new Service Manager:",C),C?.kernels.ready.then((async()=>{const e=C.kernels;if(console.log("Jupyter Kernel Manager is ready",e),_>-1){await C.sessions.refreshRunning();const t=Array.from(e.running())[_],r=new w({kernelManager:e,kernelName:t.name,kernelSpecName:t.name,kernelModel:t,kernelspecsManager:C.kernelspecs,sessionManager:C.sessions});if(n)try{await(r.execute(n)?.done)}catch(e){console.error("Failed to execute the initial code",e)}b(r),P.getState().kernel=r,I(!1),P.getState().kernelIsLoading=!1}else if(h){console.log("Starting a Jupyter Kernel:",t);const r=new w({kernelManager:e,kernelName:t,kernelSpecName:t,kernelspecsManager:C.kernelspecs,sessionManager:C.sessions});r.ready.then((async()=>{if(n)try{await(r.execute(n)?.done)}catch(e){console.error("Failed to execute the initial code",e)}console.log("Jupyter Kernel is ready",r),b(r),P.getState().kernel=r,I(!1),P.getState().kernelIsLoading=!1}))}}))}),[C]),(0,o.Pj)(P)}}}]);