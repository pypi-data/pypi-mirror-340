"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["16224"],{50875:function(t,e,i){i.d(e,{Eu:()=>r,hZ:()=>a,o9:()=>d});var s=i(27486),n=i(11259);const o=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function r(t){return o[t%o.length]}function a(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||r(t);return(0,n.Rq)(i)}const d=(0,s.Z)((t=>o.map(((e,i)=>a(i,t)))),((t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")))},31428:function(t,e,i){i.d(e,{U:()=>_});i(71695),i(47021);var s=i(50875),n=i(11259),o=i(4643),r=i(73850),a=i(42818),d=i(96194),c=i(76190);const h={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};let u=0;const l=new Map;function _(t,e,i){return function(t,e,i){var s;if(!i||t===d.nZ)return(0,c.g)("--history-unavailable-color",e);if(t===d.lz)return(0,c.g)("--history-unknown-color",e);const u=(0,a.tD)(i,t);if(!u)return;const l=(0,c.g)(u,e);if(!l)return;const _=(0,r.M)(i.entity_id),f=null===(s=h[_])||void 0===s?void 0:s[t];return f?(0,n.uO)((0,o.C)((0,n.Rw)((0,n.wK)(l)),f)):l}(t,e,i)||function(t,e){if(l.has(t))return l.get(t);const i=(0,s.hZ)(u,e);return u++,l.set(t,i),i}(t,e)}},17705:function(t,e,i){i.d(e,{Cj:()=>l,F7:()=>n,Hs:()=>S,Kd:()=>k,Kj:()=>f,Nw:()=>v,PA:()=>o,Py:()=>d,Qm:()=>x,Z0:()=>p,_Y:()=>h,_m:()=>r,dL:()=>c,dO:()=>w,hN:()=>_,h_:()=>u,j2:()=>b,q6:()=>y,uR:()=>a});i(19083),i(71695),i(9359),i(52924),i(61006),i(47021);var s=i(47194);let n=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const o=99387==i.j?["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"]:null,r=t=>t.sendMessagePromise({type:"recorder/info"}),a=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),d=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),c=(t,e,i,s,n="hour",o,r)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:s,period:n,units:o,types:r}),h=(t,e,i,s)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:s,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar,rolling_window:i.rolling_window}),u=t=>t.callWS({type:"recorder/validate_statistics"}),l=(t,e,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i}),_=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),f=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},y=(t,e)=>{let i=null;for(const s of e){if(!(s in t))continue;const e=f(t[s]);null!==e&&(null===i?i=e:i+=e)}return i},v=(t,e)=>t.some((t=>void 0!==t[e]&&null!==t[e])),g=["mean","min","max"],m=["sum","state","change"],p=(t,e)=>!(!g.includes(e)||t.mean_type===n.NONE)||!(!m.includes(e)||!t.has_sum),b=(t,e,i,s,n)=>{const o=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:o,adjustment:s,adjustment_unit_of_measurement:n})},k=(t,e,i)=>{const n=t.states[e];return n?(0,s.C)(n):(null==i?void 0:i.name)||e},w=(t,e,i)=>{let s;var n;e&&(s=null===(n=t.states[e])||void 0===n?void 0:n.attributes.unit_of_measurement);return void 0===s?null==i?void 0:i.statistics_unit_of_measurement:s},S=t=>t.includes(":"),x=t=>t.callWS({type:"recorder/update_statistics_issues"})},26799:function(t,e,i){i.a(t,(async function(t,s){try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:()=>x,HuiHistoryGraphCard:()=>H});var n=i(61701),o=i(72621),r=(i(52247),i(71695),i(92745),i(9359),i(31526),i(19423),i(40251),i(47021),i(57243)),a=i(50778),d=i(35359),c=i(72344),h=i(71489),u=(i(99426),i(54977),i(13928),i(6280)),l=i(96309),_=i(93331),f=i(29401),y=i(58776),v=i(17705),g=t([h,u]);[h,u]=g.then?(await g)():g;let m,p,b,k,w,S=t=>t;const x=24;let H=(0,n.Z)([(0,a.Mo)("hui-history-graph-card")],(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await Promise.all([i.e("46379"),i.e("24199"),i.e("78943"),i.e("27090"),i.e("3049"),i.e("47744")]).then(i.bind(i,96312)),document.createElement("hui-history-graph-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(){return{type:"history-graph",entities:["sun.sun"]}}},{kind:"field",decorators:[(0,a.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,a.SB)()],key:"_history",value:void 0},{kind:"field",decorators:[(0,a.SB)()],key:"_statisticsHistory",value:void 0},{kind:"field",decorators:[(0,a.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,a.SB)()],key:"_error",value:void 0},{kind:"field",key:"_names",value(){return{}}},{kind:"field",key:"_entityIds",value(){return[]}},{kind:"field",key:"_hoursToShow",value(){return x}},{kind:"field",key:"_interval",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"field",key:"_stateHistory",value:void 0},{kind:"method",key:"getCardSize",value:function(){var t,e;return null!==(t=this._config)&&void 0!==t&&t.title?2:0+2*((null===(e=this._entityIds)||void 0===e?void 0:e.length)||1)}},{kind:"method",key:"getGridOptions",value:function(){return{columns:12,min_columns:6,min_rows:2}}},{kind:"method",key:"setConfig",value:function(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const e=t.entities?(0,f.A)(t.entities):[];this._entityIds=[],e.forEach((t=>{this._entityIds.push(t.entity),t.name&&(this._names[t.entity]=t.name)})),this._hoursToShow=t.hours_to_show||x,this._config=t}},{kind:"method",key:"connectedCallback",value:function(){(0,o.Z)(s,"connectedCallback",this,3)([]),this.hasUpdated&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,o.Z)(s,"disconnectedCallback",this,3)([]),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:async function(){if(!(0,c.p)(this.hass,"history")||this._subscribed)return;const{numeric_device_classes:t}=await(0,l.ib)(this.hass);this._subscribed=(0,u.xS)(this.hass,(e=>{var i;this._subscribed&&(this._stateHistory=(0,u.Nu)(this.hass,e,this._entityIds,this.hass.localize,t,null===(i=this._config)||void 0===i?void 0:i.split_device_classes),this._mergeHistory())}),this._hoursToShow,this._entityIds).catch((t=>{this._subscribed=void 0,this._error=t})),await this._fetchStatistics(t),this._setRedrawTimer()}},{kind:"method",key:"_mergeHistory",value:function(){var t;this._stateHistory&&(this._history=(0,u.V3)(this._stateHistory,this._statisticsHistory,null===(t=this._config)||void 0===t?void 0:t.split_device_classes))}},{kind:"method",key:"_fetchStatistics",value:async function(t){var e;const i=new Date,s=new Date;s.setHours(s.getHours()-this._hoursToShow);const n=await(0,v.dL)(this.hass,s,i,this._entityIds,"hour",void 0,["mean","state"]);this._statisticsHistory=(0,u.YA)(this.hass,n,this._entityIds,t,null===(e=this._config)||void 0===e?void 0:e.split_device_classes),this._mergeHistory()}},{kind:"method",key:"_redrawGraph",value:function(){this._history&&(this._history=Object.assign({},this._history))}},{kind:"method",key:"_setRedrawTimer",value:function(){clearInterval(this._interval),this._interval=window.setInterval((()=>this._redrawGraph()),6e4)}},{kind:"method",key:"_unsubscribeHistory",value:function(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then((t=>null==t?void 0:t())),this._subscribed=void 0)}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,_.Wh)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"updated",value:function(t){if((0,o.Z)(s,"updated",this,3)([t]),!(this._config&&this.hass&&this._hoursToShow&&this._entityIds.length))return;if(!t.has("_config")&&!t.has("hass"))return;const e=t.get("_config");!t.has("_config")||(null==e?void 0:e.entities)===this._config.entities&&(null==e?void 0:e.hours_to_show)===this._config.hours_to_show||(this._unsubscribeHistory(),this._subscribeHistory())}},{kind:"method",key:"render",value:function(){var t,e,i,s;if(!this.hass||!this._config)return r.Ld;const n=new Date;n.setHours(n.getHours()-this._hoursToShow);const o=`/history?${(0,y.ou)({entity_id:this._entityIds.join(","),start_date:n.toISOString()})}`,a=null!==(t=null===(e=this._config.grid_options)||void 0===e?void 0:e.columns)&&void 0!==t?t:12,c="number"==typeof a&&a<=12,h="number"==typeof(null===(i=this._config.grid_options)||void 0===i?void 0:i.rows);return(0,r.dy)(m||(m=S` <ha-card> ${0} <div class="content ${0}"> ${0} </div> </ha-card> `),this._config.title?(0,r.dy)(p||(p=S` <h1 class="card-header"> ${0} <a href="${0}"><ha-icon-next></ha-icon-next></a> </h1> `),this._config.title,o):r.Ld,(0,d.$)({"has-header":!!this._config.title,"has-rows":!(null===(s=this._config.grid_options)||void 0===s||!s.rows),"has-height":h}),this._error?(0,r.dy)(b||(b=S` <ha-alert alert-type="error"> ${0}: ${0} </ha-alert> `),this.hass.localize("ui.components.history_charts.error"),this._error.message||this._error.code):(0,r.dy)(k||(k=S` <state-history-charts .hass="${0}" .isLoadingData="${0}" .historyData="${0}" .names="${0}" up-to-now .hoursToShow="${0}" .showNames="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .height="${0}" .narrow="${0}" .expandLegend="${0}"></state-history-charts> `),this.hass,!this._history,this._history,this._names,this._hoursToShow,void 0===this._config.show_names||this._config.show_names,this._config.logarithmic_scale||!1,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,h?"100%":void 0,c,this._config.expand_legend))}},{kind:"field",static:!0,key:"styles",value(){return(0,r.iv)(w||(w=S`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:0 16px 8px;flex:1;overflow:hidden}.has-header{padding-top:0}state-history-charts{--timeline-top-margin:16px}.has-height state-history-charts{height:100%}.has-rows{--chart-max-height:100%}`))}}]}}),r.oi);s()}catch(m){s(m)}}))}}]);
//# sourceMappingURL=16224.e6753a1a07c9829a.js.map