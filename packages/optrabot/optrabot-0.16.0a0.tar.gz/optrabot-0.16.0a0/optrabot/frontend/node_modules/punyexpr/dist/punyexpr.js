!function(e){"use strict";const c="literal",H="identifier",K="regex",L="symbol",M="function";class Q extends Error{constructor(e,r,t){super(r),this.name=e,this.offset=t}}Q.throw=(e,r,t)=>{throw new Q(e,r,t)};const n=(()=>{const t="abstract,arguments,await,boolean,break,byte,case,catch,char,class,const,continue,debugger,default,delete,do,double,else,enum,eval,export,extends,final,finally,float,for,function,goto,if,implements,import,in,instanceof,int,interface,let,long,native,new,package,private,protected,public,return,short,static,super,switch,synchronized,this,throw,throws,transient,try,var,void,volatile,while,with,yield".split(",");const r=new RegExp([/'((?:[^'\\]|\\.)*)'/,/"((?:[^"\\]|\\.)*)"/,/((?:\d+(?:\.\d*)?|\.\d+))/,/([a-zA-Z_][a-zA-Z_0-9]*)/,/(\/(?:[^/\\]|\\.)+\/[gmiysd]*)/,/(\+|-|\*|\/|\[|\]|\.|\?|:|%|<|=|>|!|&|\||\(|\)|,)/,/(\s)/,/(.)/].map(e=>{e=e.toString();return e.substring(1,e.length-1)}).join("|"),"g"),i=e=>Q.throw("InvalidTokenError","Invalid token @"+e,e),n={true:!0,false:!1,undefined:void 0,null:null},l=[e=>[c,e.replace(/\\'/g,"'")],e=>[c,e.replace(/\\"/g,'"')],e=>[c,parseFloat(e)],(e,r)=>Object.prototype.hasOwnProperty.call(n,e)?[c,n[e]]:(t.includes(e)&&i(r),[H,e]),e=>{var r=e.lastIndexOf("/"),t=e.substring(1,r),e=e.substring(r+1);return[K,[t,e]]},e=>[L,e],e=>[],(e,r)=>i(r)];return e=>{const n=[];let o=0,s;const a=[c,H];return e.replace(r,({length:e},...r)=>{var t=r.findIndex(e=>void 0!==e),r=r[t],[t,r]=(0,l[t])(r,o);a.includes(t)&&a.includes(s)&&i(o),void 0!==(s=t)&&n.push([t,r,o,e]),o+=e}),n}})(),V=Symbol("punyexpr"),o=(()=>{var e=(t,n)=>(e,...r)=>Object.assign(n.bind(null,...r),{[V]:[t,r,e]});const i=e("constant",e=>e),a=e("array",(...e)=>{const r=e[e.length-1];return e.slice(0,-1).map(e=>e(r))}),l=e("regex",(e,r,t)=>t(e,r)),c=(e,r)=>new RegExp(e,r),u=e("context",(e,r)=>r[e(r)]),p=e("property",(e,r,t)=>{e=e(t),r=e[r(t)];return typeof r===M?r.bind(e):r}),d=e("call",(e,r,t)=>e(t).apply(null,r.map(e=>e(t))));var r=e("pos",(e,r)=>+e(r)),t=e("neg",(e,r)=>-e(r)),n=e("not",(e,r)=>!e(r)),o=e("getTypeof",(e,r)=>typeof e(r)),s=e("exp",(e,r,t)=>e(t)**r(t)),f=e("mul",(e,r,t)=>e(t)*r(t)),g=e("div",(e,r,t)=>e(t)/r(t)),v=e("remainder",(e,r,t)=>e(t)%r(t)),h=e("add",(e,r,t)=>e(t)+r(t)),y=e("sub",(e,r,t)=>e(t)-r(t)),b=e("lt",(e,r,t)=>e(t)<r(t)),x=e("gt",(e,r,t)=>e(t)>r(t)),w=e("lte",(e,r,t)=>e(t)<=r(t)),m=e("gte",(e,r,t)=>e(t)>=r(t)),E=e("eq",(e,r,t)=>e(t)==r(t)),_=e("neq",(e,r,t)=>e(t)!=r(t)),D=e("eqq",(e,r,t)=>e(t)===r(t)),F=e("neqq",(e,r,t)=>e(t)!==r(t)),J=e("and",(e,r,t)=>e(t)&&r(t)),N=e("or",(e,r,t)=>e(t)||r(t));const W=e("ternary",(e,r,t,n)=>(e(n)?r:t)(n));let k,O;const j=()=>{0===k.length&&Q.throw("EndOfExpressionError","Unexpected end of expression")},q=()=>(j(),k[0]),R=()=>q()[2],U=(e,r)=>{let t;var[r,n]=t=r?r[V][2]:q().splice(2);return[e,r+n-e]},z=(e=1)=>k.splice(0,e),A=(e=void 0)=>{var r,t;return 0!==k.length&&([r,t]=k[0],r===L)&&(!e||e.includes(t))},I=e=>{var r=[];for(const s of k){var[t,n]=s;if(t!==L)break;r.push(n)}const o=r.join("");e=e.filter(e=>o.startsWith(e)).sort((e,r)=>r.length-e.length)[0];return!!e&&(z(e.length),e)},S=()=>Q.throw("UnexpectedTokenError","Unexpected token @"+R(k),R(k)),B=()=>{if(j(),A("("))return z(),e=Z(),A(")")||S(),z(),e;if(A("[")){for(var e=R(),r=(z(),[]);!A("]");){var t=Z();r.push(t),A(",")&&z()}return e=U(e),z(),a(e,...r)}A()&&S();var[[n,o,...s]]=z();if(n===H)return u(s,i(s,o));if(n!==K)return i(s,o);{O.regex||([n]=s,Q.throw("RegExpDisabledError","Regular expressions are disabled @"+n,n));var[n,o]=o;let e=O.regex;return typeof e!==M&&(e=c),l(s,n,o,e)}},C={"+":r,"-":t,"!":n,typeof:o},T=()=>{var[e,r,t]=q();if(A("+-!")||e===H&&"typeof"===r)return e=U(t),z(),(0,C[r])(e,T());{const a=R();let n=B();for(var o={"(":()=>{for(var e=[];!A(")");)0<e.length&&(A(",")||S(),z()),e.push(Z());var r=U(a);z(),n=d(r,n,e)},"[":()=>{var e=Z(),r=(A("]")||S(),U(a));z(),n=p(r,n,e)},".":()=>{var[e,r,...t]=q(),e=(e!==H&&S(),U(a));z(),n=p(e,n,i(t,r))}};A("([.");){var[[,s]]=z();o[s]()}return n}};e=(s,a)=>{const i=Object.keys(a);return()=>{var e=R();let r=s(),t=I(i);for(;t;){var n=s(),o=U(e,n);r=a[t](o,r,n),t=I(i)}return r}};const G=e(e(e(e(e(e(e(T,{"**":s}),{"*":f,"/":g,"%":v}),{"+":h,"-":y}),{"<":b,">":x,"<=":w,">=":m}),{"==":E,"!=":_,"===":D,"!==":F}),{"&&":J}),{"||":N}),P=()=>{var e,r,t=R(),n=G();return I(["?"])?(e=P(),j(),A(":")||S(),z(),r=P(),t=U(t,r),W(t,n,e,r)):n},Z=P;return(...e)=>{[k,O]=e;e=Z();return 0!==k.length&&Q.throw("UnexpectedRemainderError","Unexpected left over tokens @"+R(),R()),e}})(),s=e=>({value:e,writable:!1}),a=(e,t)=>{Object.defineProperties(e,Object.keys(t).reduce((e,r)=>(e[r]=s(t[r]),e),{}))},i=e=>{var[e,r,[t,n]]=e[V];const o={};return{op:e,at:t,length:n,args:r.map(e=>typeof e===M?e[V]?i(e):o:Array.isArray(e)?e.map(i):e).filter(e=>e!==o)}};var r=(e,r={})=>{const t=o(n(e),{regex:!1,...r});r=(e={})=>t(e);return a(r,{toJSON:i.bind(null,t),toString:()=>e}),r};a(r,{tokenize:n,Error:Q,version:"1.0.4"}),e.punyexpr=r}(this);