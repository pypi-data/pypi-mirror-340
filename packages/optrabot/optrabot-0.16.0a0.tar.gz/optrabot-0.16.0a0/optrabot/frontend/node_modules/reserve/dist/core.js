module.exports=function(t,e,n,r,o,s,i,a,c,d,u,l,h,p,f,m,g,y,w){e=y(e),n=y(n),r=y(r);const b=Object.assign,v=Object.keys,x=t=>new Promise(t),S=()=>Symbol(),[E,_,B,I,C,R,$]=",object,string,number,function,boolean,error".split(","),O=function(t={}){const e=Number.POSITIVE_INFINITY,n=n=>{const r=t[n];if(void 0===r)return e;if(!Number.isInteger(r)||r<=0)throw new Error(`Invalid ${n}`);return r},r=n("ttl"),o=n("max"),s=t.policy||"lru",i=Object.create(null),a=()=>Date.now(),c=()=>v(i),d=t=>()=>{let n,r=e;for(const e in i){const{[t]:o}=i[e];o<r&&(r=o,n=e)}delete i[n]},u={lru:d("t"),lfu:d("f")}[s];if(void 0===u)throw new Error("Invalid policy");const l=()=>{const t=a();let e=!1;for(const n in i){const{e:r}=i[n];r<=t&&(delete i[n],e=!0)}return e},h=t=>{const e=i[t],n=a();if(e&&e.e>n)return e.t=n,e};return{set(t,e){const n=a();let s=h(t);s||(c().length===o&&!l()&&u(),s={f:0},i[t]=s),b(s,{e:n+r,t:n,f:s.f+1,v:e})},get(t){const e=h(t);if(e)return++e.f,e.v},del(t){delete i[t]},keys:()=>(l(),c())}},j=(()=>{const t={string:(t,e)=>e.replace(/\$(\d+)|\$(\w+)|\$\$/g,((e,n,r)=>n?t[n]||E:r?t.groups&&t.groups[r]||E:"$")),object:(t,n)=>{const r={};return v(n).forEach((o=>{r[o]=e(t,n[o])})),r}};function e(e,n){const r=t[typeof n];return r?r(e,n):n}return e})(),N=[S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S(),S()],k=async t=>{if(t.endsWith(".mjs"))return(await import(`file://${t}`)).default;try{return require(t)}catch(e){if("ERR_REQUIRE_ESM"===e.code)return(await import(`file://${t}`)).default;throw e}},P=(()=>{const t=j,e='Unknown event name|Invalid callback|Configured port $port already in use|Invalid mapping match|Invalid mapping invert-match|Invalid mapping if-match|Invalid mapping exclude-from-holding-list|Unknown handler for $mapping|Invalid method specification|No method specified (or left)|Invalid "$type" handler: redirect is not a function|Invalid listeners member, must be an array of functions|Invalid http2 setting|Configuration must be an object|iconfiguration.setMappings appears to be blocked|Missing property $name|Invalid type of property $name|Invalid custom handler, expected a function|index.html not a file|Invalid custom-file-system specification ($invalids}|Invalid caching-strategy name|Internal redirection impossible because the body is already consumed|Unexpected middleware signature|Unsupported encoding: $encoding|Invalid status'.split("|");function n(n=-1,r){let o=e[n]||"An error occurred";r&&(o=t({groups:r},o));const s=new Error(o);return s.name="REserveError",s.code=n,s}return[function(t,e){throw n(t,e)},n]})(),q=(()=>{const[t]=P;return(e,n,r)=>{let o=e.method;void 0!==o?(typeof o===B&&(o=o.split(",")),Array.isArray(o)||t(8),o=o.map((t=>t.toUpperCase())),r&&(o=o.filter((t=>r.includes(t)))),o.length||t(9),e[n]=o):e[n]=r}})(),A=(()=>{const[t]=P;return[function(t){return v(t).map((e=>function(t,e){let n;const{defaultValue:r}=e;return n=typeof e===B?[e]:Array.isArray(e)?e:e.types||[e.type||B],{name:t,types:n,defaultValue:r}}(e,t[e])))},function(e,n){e.forEach((e=>function(e,n,r=e.defaultValue){const{name:o,types:s}=e;void 0===r&&t(15,{name:o});const i=typeof r;s.includes(i)||t(16,{name:o}),n[e.name]=r}(e,n,n[e.name])))},function(t){return!0!==t&&void 0!==t}]})(),H=(()=>{const[,,,,t,e,n]=N,r=k,[o]=P;function s(t,e,n,[,...r]){return t.call(this,e,n,...r)}return{[n]:"custom",schema:{custom:[C,B]},validate:async(n,i)=>{typeof n.custom===B?n[t]=await r(h(n.cwd,n.custom)):n[t]=n.custom,typeof n[t]!==C&&o(17);const{length:a}=n[t];n[e]=0===a||a>2?s.bind(n,n[t]):n[t],n.configuration=i},redirect:({mapping:t,match:n,request:r,response:o})=>t[e](r,o,n)}})(),U=(()=>{const{6:t,14:e}=N,n=k,[r]=P;return{[t]:"use",schema:{use:[B,C],options:{type:_,defaultValue:{}}},validate:async t=>{let o;o=typeof t.use===C?t.use:await n(t.use);const s=o(t.options);3!==s.length&&r(22),t[e]=s},redirect:({mapping:t,request:n,response:r})=>x(((o,s)=>{const i=()=>{o(),r.end()},a=new Proxy(r,{get:(t,e)=>"end"===e?i:r[e]}),c=t=>{t?s(t):o()};try{t[e](n,a,c)}catch(t){s(t)}}))}})(),V=(()=>{const t=t=>typeof t===B?t.toLowerCase():t;return(e={})=>{const n=new Proxy({},{get:(e,n)=>e[t(n)],set:(e,n,r)=>(Array.isArray(r)?e[t(n)]=r.map((t=>t.toString())):e[t(n)]=r.toString(),!0)});return Reflect.ownKeys(e).forEach((t=>{n[t]=e[t]})),n}})(),D=(()=>{const t=V,e="http://localhost";return class extends g{_read(){this.push(this._body),this.push(null)}_fromObject({method:n,url:r,headers:o={},body:s=E,properties:i}){this._method=n,this._url=function(t){const n=new URL(t,e).toString();return n.startsWith(e)?n.substring(16):n}(r),this._headers=t(o),this._body=s,i&&b(this,i)}_fromParams(t,e,n,r,o){return typeof r===_&&(o=r,r=E),typeof n===B&&(r=n,n={}),this._fromObject({method:t,url:e,headers:n,body:r,properties:o})}constructor(t){super(),typeof t===_?this._fromObject(t):this._fromParams(...arguments)}get method(){return this._method}get url(){return this._url}setForgedUrl(t){this._url=t}get headers(){return this._headers}abort(){this.aborted=!0,this.emit("aborted")}}})(),F=()=>{let t,e;return[x(((n,r)=>{t=n,e=r})),t,e]},L=(()=>{const t=V,e=F;return class extends m{_read(){this.push(this.toString()),this.push(null)}_write(t,e,n){this._headersSent=!0,this._buffer.push(t.toString()),this._asynchronous?setTimeout(n,0):n()}getHeader(t){return this._headers[t]||E}setHeader(t,e){this._headers[t]=e}writeHead(t,e={}){this._statusCode=t,v(e).forEach((t=>{this._headers[t]=e[t]}))}flushHeaders(){this._headersSent=!0}end(){return this._headersSent=!0,this._ended=!0,super.end.apply(this,arguments)}constructor(n){super(n),this._buffer=[],this._headers=t(),this._headersSent=!1;const[r,o]=e();this._waitForFinish=r,this.on("finish",(()=>o(this))),this._statusCode=200,this._ended=!1}get headers(){return this._headers}get statusCode(){return this._statusCode}set statusCode(t){this._statusCode=t}get headersSent(){return this._headersSent}get writableEnded(){return this._ended}toString(){return this._buffer.join(E)}waitForFinish(){return this._waitForFinish}isInitial(){return 0===this._buffer.length&&!this._headersSent&&0===v(this._headers).length}setAsynchronous(){this._asynchronous=!0}}})(),z=(()=>{const t=F,[e,n]=P,r={gzip:w.createGunzip,deflate:w.createInflate,br:w.createBrotliDecompress,default:t=>{e(23,{encoding:t})}};function o(t,e){let[n,r,o=()=>{}]=e;return t&&typeof n===C?(o=n,n=void 0,r=void 0):typeof r===C&&(o=r,r=void 0),{data:n,encoding:r,callback:o}}const s=o.bind(null,!1),i=o.bind(null,!0);function a(e,n,o){const[a,c,d]=t(),{emit:u,end:l,write:h}=e;function p(t){d(t),e.write=h,e.end=l}try{const t=function(t){const e=t["content-encoding"];if(e&&"identity"!==e)return(r[e]||r.default)(e)}(n)||o;t.on($,p),t!==o&&(o.on($,p),f(t,o,(()=>{o.end()}))),e.on($,p),o.on("finish",(()=>c()));let a=!0;e.write=function(){const{data:n,encoding:r,callback:o}=s(arguments);let i=0;function c(){0==--i&&(e.emit=u,e.emit("drain"))}return a&&(t.write(n,r)||(++i,t.once("drain",c))),h.call(e,n,r,o)||++i,!i||(e.emit=function(t){if("drain"!==t)return u.apply(e,arguments);c()},!1)},e.end=function(){const{data:n,encoding:r,callback:s}=i(arguments);return t!==o?t.end(n,r):o.end(n,r),a=!1,l.call(e,n,r,(function(){s.apply(this,arguments)})),this}}catch(t){d(t)}return a}return(e,r)=>{const[o,s,i]=t(),{writeHead:c}=e;return e.writeHead=function(t,o={}){200===t?s(a(e,o,r)):i(n(24)),c.apply(e,arguments)},o}})(),Q=(()=>{const t=V,e=F,{6:n}=N,r=k,[,s]=P,a=["transfer-encoding","connection","keep-alive"];function c(){}async function d(t,e){typeof t[e]===B&&(t[e]=await r(t[e]))}return{[n]:"url",schema:{"unsecure-cookies":{type:R,defaultValue:!1},"forward-request":{types:[C,B],defaultValue:c},"forward-response":{types:[C,B],defaultValue:c},"ignore-unverifiable-certificate":{type:R,defaultValue:!1},"absolute-location":{type:R,defaultValue:!1}},validate:async t=>{await d(t,"forward-request"),await d(t,"forward-response")},redirect:async({configuration:n,mapping:r,match:c,redirect:d,request:u,response:l})=>{const[h,p,f]=e(),{method:m,headers:g}=u,y={method:m,url:d,headers:t(g)};delete y.headers.host,r["ignore-unverifiable-certificate"]&&(y.rejectUnauthorized=!1);const w={configuration:n,context:{},mapping:r,match:c,request:y,incoming:u};await r["forward-request"](w),v(y.headers).filter((t=>t.startsWith(":"))).forEach((t=>delete y.headers[t]));const b=function(t){return t.startsWith("https")?i:o}(y.url).request(y.url,y,(async t=>{r["unsecure-cookies"]&&function(t){const e=t["set-cookie"];e&&(t["set-cookie"]=e.map((t=>{const e=t.replace(/\s*secure;?/i,E);return e!==t?e.replace(/\s*samesite=none;?/i," SameSite=Lax;"):t})))}(t.headers);const{headers:e}=t,{location:o}=e;o&&r["absolute-location"]&&!o.match(/^https?:\/\//)&&(e.location=y.url.match(/^http?s:\/\/[^/]+/)[0]+o);const i=await r["forward-response"]({...w,statusCode:t.statusCode,headers:e});return void 0!==i?["GET","HEAD"].includes(u.method)?p(i):f(s(21)):(n.http2&&a.forEach((t=>delete e[t])),l.writeHead(t.statusCode,e),u.aborted?(l.end(),p()):(l.on("finish",(()=>p(i))),void t.on($,f).pipe(l)))}));return b.on($,f),u.on($,f).pipe(b),h}}})(),T=(()=>{const t={},e="openxmlformats,application/,octet-stream,presentation,document,office,image/,audio/,video/,text/,font/,oasis,woff,vnd.,xml,zip,x-".split(",");let n,r="aac=Haac,abw=BQabiword,arc=BC,avi=IQmsvideo,azw=BNamazon.ebook,bin=BC,bmp=Gbmp,bz=BQbP,bz2=BQbP2,csh=BQcsh,css=Jcss,csv=Jcsv,doc=Bmsword,docx=BNA-FE.wordprocessingml.E,eot=BNms-fontobject,epub=Bepub+P,gif=Ggif,htm=Jhtml,html,ico=GQicon,ics=Jcalendar,jar=Bjava-archive,jpeg=Gjpeg,jpg,js=Bjavascript,json=Bjson,mid=Hmidi,midi,mpeg=Impeg,mpkg=BNapple.installer+O,odp=BNL.openE.D,ods=BNL.openE.spreadsheet,odt=BNL.openE.text,oga=Hogg,ogv=Iogg,ogx=Bogg,otf=Kotf,png=Gpng,pdf=Bpdf,ppt=BNms-powerpoint,pptx=BNA-FE.Dml.D,rar=BQrar-compressed,rtf=Brtf,sh=BQsh,svg=Gsvg+O,swf=BQshockwave-flash,tar=BQtar,text=Jplain,tif=Gtiff,tiff,ts=Btypescript,ttf=Kttf,txt=Jplain,vsd=BNvisio,wasm=Bwasm,wav=HQwav,weba=Hwebm,webm=Iwebm,webp=Gwebp,woff=KM,woff2=KM2,xhtml=Bxhtml+O,xls=BNms-excel,xlsx=BNA-FE.spreadsheetml.sheet,xml=BO,xul=BNmozilla.xul+O,zip=BP,7z=BQ7z-compressed";return e.forEach(((t,e)=>{r=r.replace(new RegExp(String.fromCharCode(65+e),"g"),t)})),r.split(",").forEach((e=>{const[r,o]=e.split("=");o&&(n=o),t[r]=n})),t})(),G=(()=>{const{text:t,json:e}=T,n=F;return function(r,o={}){let s;const[i,a,c]=n();r.on($,c);const{ignoreContentLength:d=!1}=o,u=!d&&r.headers&&r.headers["content-length"],l=r.headers&&r.headers["content-type"];if(l&&(l.startsWith(t)?s=t:l.startsWith(e)&&(s=e)),u){const t=parseInt(u,10),e=Buffer.alloc(t);let n=0;r.on("data",(t=>{t.copy(e,n),n+=t.length})).on("end",(()=>a(e)))}else{const t=[];r.on("data",(e=>t.push(e))).on("end",(()=>a(Buffer.concat(t))))}const h=t=>t.toString(),p=t=>JSON.parse(t.toString());let f;return f=s===t?i.then(h):s===e?i.then(p):i,f.buffer=()=>i,f.text=()=>i.then(h),f.json=()=>i.then(p),f}})(),M=(()=>{const{bin:t,text:e,json:n}=T,r="content-type",o="content-length";return(s,i,a={})=>{let{statusCode:c=200,noBody:d}=a;const u={...a.headers};let l,h=!1;if(void 0===i?d=!0:typeof i===B?l=e:typeof i.on===C?(l=t,h=!0):(l=n,i=JSON.stringify(i)),!u[r]&&l&&(u[r]=l),!i||h||u[o]||(u[o]=(new TextEncoder).encode(i).length),s.writeHead(c,u),d)s.end();else{if(h)return x(((t,e)=>{s.on("finish",t),i.on($,e),f(i,s,(n=>{n?(s.end(),e(n)):t()}))}));s.end(i)}}})(),J=(()=>{const{6:n,15:o}=N,s=M,i=T,a=k,c=O,[l]=P,p="custom-file-system",f="caching-strategy",m="mime-types",g="static",y={},w={stat:r,readdir:e,createReadStream:t};async function b({cachingStrategy:t,mapping:e,request:n,response:r,fs:o,filePath:a},c){const{header:d,status:u}=function(t,e,{mtime:n}){if("modified"===e){const e=n.toUTCString(),r=t.headers["if-modified-since"];let o;return r&&e===r&&(o=304),{header:{"cache-control":"no-cache","last-modified":e},status:o}}return e>0?{header:{"cache-control":`public, max-age=${e}, immutable`}}:{header:{"cache-control":"no-store"}}}(n,t,c),{start:l,end:h,header:p,status:f,contentLength:g}=function(t,{mtime:e,size:n}){const r=/bytes=(\d+)-(\d+)?(,)?/.exec(t.headers.range),o=t.headers["if-range"];if((!o||o===e.toUTCString())&&r&&!r[3]){const t=parseInt(r[1],10);let e;return e=r[2]?parseInt(r[2],10):n-1,t>e||t>=n?{status:416,contentLength:0}:{start:t,end:e,header:{"content-range":`bytes ${t}-${e}/${n}`},status:206,contentLength:e-t+1}}return{status:200,contentLength:n}}(n,c);let{statusCode:y}=r;200===y&&(y=u||f);const w=(/\.([^.]*)$/.exec(a)||[])[1],b=e[m][w]||i[w]||i.bin,v="HEAD"===n.method||0===g||n.aborted||304===y;let x;if(v||(x=await o.createReadStream(a,{start:l,end:h}),!n.aborted))return s(r,x,{statusCode:y,headers:{"content-type":b,"content-length":g,"accept-ranges":"bytes",...p,...d},noBody:v});r.end()}return{[n]:"file",schema:{[p]:{types:[B,_],defaultValue:w},[f]:{types:[B,I],defaultValue:0},[m]:{type:_,defaultValue:{}},[g]:{types:[R,_],defaultValue:y}},method:"GET,HEAD",validate:async t=>{typeof t[p]===B&&(t[p]=await a(h(t.cwd,t[p])));const e=["stat","createReadStream","readdir"].filter((e=>typeof t[p][e]!==C));e.length&&l(19,{invalids:e.join(", ")});const n=t[f];typeof n===B&&"modified"!==n&&l(20),t[g]===y&&(t[g]=t[p]===w),!0===t[g]&&(t[g]={}),t[g]&&(t=>{const e=c(t[g]),{stat:n,readdir:r,createReadStream:s}=t[p];t[o]=e;const i=(t,n)=>async r=>{const o=`${t}:${r}`,s=e.get(o);if(s)return s;const i=n(r);return e.set(o,i),i};t[p]={stat:i("stat",n),readdir:i("dir",r),createReadStream:s}})(t)},redirect:({request:t,mapping:e,redirect:n,response:r})=>{let o=/([^?#]*)/.exec(n)[1];if(o=h(e.cwd,o),!o.startsWith(e.cwd))return Promise.resolve();const s=!o.match(/(\\|\/)$/),i={cachingStrategy:e[f],fs:e[p],filePath:o,mapping:e,request:t,response:r};return i.fs.stat(o).then((async t=>{await async function(t,e,n){let r=n;for(;r!==e;){const e=u(r),n=d(r);(await t.readdir(e)).includes(n)||l(),r=e}}(i.fs,e.cwd,o);const n=t.isDirectory();if(n||s)return n?async function(t){const e=h(t.filePath,"index.html"),n=await t.fs.stat(e);return n.isDirectory()&&l(18),b({...t,filePath:e},n)}(i):b(i,t)})).catch((()=>{}))}}})(),W=(()=>{const t=j,{6:e}=N,n=M,r={403:"Forbidden",404:"Not found",405:"Method Not Allowed",500:"Internal Server Error",501:"Not Implemented",508:"Loop Detected"};return{[e]:"status",schema:{status:I,headers:{type:_,defaultValue:{}}},redirect:function({mapping:e,match:o,response:s,redirect:i}){return n(s,r[i]||E,{statusCode:i,headers:{...t(o,e?e.headers:void 0)}})}}})(),K=(()=>{const{log:t,error:e}=console;return[t,e]})(),Y=(()=>{const[t,e]=K;return function(n,r,...o){let s;const i=[];if("ERROR"===n?(s=e,i.push(n)):(s=t,i.push(n)),r){const t=this.id.toString(16).toUpperCase();i.push(t.padStart(Math.max(4,t.length),"0")),this.internal&&i.push("(i)")}else i.push(this.method,this.url);i.push(o.join(" ")),s(...i)}})(),X=(()=>{const t=Y;return(e,n=!1)=>{const r=e.reason;if(e.method&&e.url){const o=[];n?o.push(r.toString()):o.push("\n\\____",r.toString()),t.call(e,"ERROR",n,...o)}else t.call({...e,method:E,url:E},"ERROR",!1,r.toString())}})(),Z=(()=>{const[t]=K,e=Y,n=X,r=(t,n)=>{const r=n.statusCode;let o;o=r?r.toString():"N/A",e.call(n,"SERVE",t,o,`${n.timeSpent} ms`)},o=t=>e.call(t,"INCMG",!0,t.method,t.url),s=(t,n)=>e.call(n,t,!0),i=t=>{const n=t.redirect;let r;r=typeof n===C?n.name||"anonymous":n.toString(),e.call(t,"RDRCT",!0,t.type,r)};return(e,a)=>(e.on("ready",(({url:e})=>{t(`Server running at ${e}`)})).on("redirected",r.bind(null,a)),a?e.on($,(t=>{n(t,!0)})).on("incoming",o).on("aborted",s.bind(null,"ABORT")).on("closed",s.bind(null,"CLOSE")).on("redirecting",i):e.on($,n),e)})(),tt=(()=>{const[t]=P,e="created,ready,incoming,error,redirecting,redirected,aborted,closed".split(",");return[function(){const n=[],r=(r,o)=>{const s=e.indexOf(r);-1===s&&t(0),typeof o!==C&&t(1),void 0===n[s]&&(n[s]=[]),n[s].push(o)};return{on:function(t,n){return"*"===t?e.forEach((t=>r(t,n))):r(t,n),this},emit:(t,...r)=>{const o=n[t];if(void 0!==o){const n=b({eventName:e[t]},...r);try{for(const t of o)t(n)}catch(e){if(0===t)throw e}return o.length}return 0}}}]})(),et=()=>{let t="127.0.0.1";const e=c();for(const n of v(e))for(const r of e[n])if(!r.internal&&("IPv4"===r.family||4===r.family)){t=r.address;break}return t},nt=(t,{timeout:e=400,host:n="127.0.0.1"}={})=>x((r=>{const o=new a;let s=!1;o.setTimeout(e),o.on("connect",(()=>{s=!0,o.destroy()})).on("timeout",(()=>{o.destroy()})).on($,(()=>{})).on("close",(()=>{r(s)})),o.connect(t,n)})),rt=t=>{if(-1!==t.indexOf("./")||-1!==t.indexOf("%")||-1===t.indexOf("/"))try{const{pathname:e,search:n,hash:r}=new URL(t,"p:/");t=decodeURIComponent(e.replace(/%(0|1)(\d|[a-f])/gi,E))+n+r}catch(e){t=400}return t},ot=(()=>{const t=X,e=j,n=rt,[,r,o,s,,,,,,,i,,a,c]=N,d=F;function u(t){const{emit:e,emitParameters:n,response:{statusCode:r},redirected:s,configuration:{[o]:{contexts:i}},id:a}=t,c=p.now();n.end=new Date,n.perfEnd=c,n.timeSpent=Math.ceil(c-n.perfStart),n.statusCode=r,e(5,n),delete i[a],s()}function l(e,n){let r;r=typeof n===I?n:500,function({emit:e,emitParameters:n},r){e(3,n,{reason:r})||t({...n,reason:r})}(e,n),e.request.aborted?u(e):e.failed?(e.response.end(),u(e)):(e.failed=!0,m(e,r))}function h(t,{url:e,index:n},r){void 0!==r?function(t,e){++t.redirectCount>t.configuration["max-redirect"]?l(t,508):m(t,e)}(t,r):t.response.writableEnded?u(t):m(t,e,n+1)}function f(t,{mapping:e={},match:n,handler:o,type:s,redirect:i,url:a,index:c=0}){try{const{configuration:d,request:u,response:p,emit:f,emitParameters:m}=t;f(4,m,{type:s,redirect:i}),e["exclude-from-holding-list"]&&(t.nonHolding=!0,t.holding=Promise.resolve());const g=o.redirect({configuration:d[r],mapping:e,match:n,redirect:i,request:u,response:p});g&&g.then?g.then(h.bind(null,t,{url:a,index:c}),(e=>l(t,e))):h(t,{url:a,index:c},g)}catch(e){l(t,e)}}function m(t,e,n=0){const{configuration:r}=t;return typeof e===I?f(t,{type:"status",handler:r.handlers.status,redirect:e}):g(t,e,n)}function g(t,n,r){try{const{mappings:o}=t.configuration,{length:s}=o;for(;r<s;){const s=o[r],c=s[i](n,t.request);if(c){if(c.then)return void c.then((o=>{if(o){const{handler:i,redirect:c,type:d}=s[a];f(t,{mapping:s,match:o,handler:i,type:d,redirect:e(o,c),url:n,index:r})}else g(t,n,r+1)})).catch((e=>l(t,e)));const{handler:o,redirect:i,type:d}=s[a];return f(t,{mapping:s,match:c,handler:o,type:d,redirect:e(c,i),url:n,index:r})}++r}l(t,501)}catch(e){l(t,e)}}return function(t,e,r){const i=n(e.url),{[o]:a,[s]:u}=t,{contexts:l}=a,h=++a.lastId,f={id:h,internal:!!e[c],method:e.method.toUpperCase(),incomingUrl:e.url,url:i,headers:{...e.headers},start:new Date,perfStart:p.now()},[g,y]=d(),w={id:h,configuration:t,emit:u,emitParameters:f,holding:g,redirectCount:0,redirected:y,request:e,response:r};return e.on("aborted",(()=>u(6,f))),e.on("close",(()=>u(7,f))),u(2,f),l[h]=w,a.holding?a.holding.then((()=>m(w,i))):m(w,i),g}})(),st=(()=>{const[t]=P,e="()^$[]|\\?+*{}".split(E);return n=>n instanceof RegExp?n:n&&n.re?new RegExp(n.re,n.flags):(typeof n!==B&&t(3),e.some((t=>n.includes(t)))?new RegExp(n):new RegExp(`^${n.replace(/\./g,"\\.").replace(/:(\w+)/g,((t,e)=>`(?<${e}>[^/]*)`))}\\b(.*)`))})(),it=(()=>{const t=st,[,,e]=A,[n]=P,{10:r,11:o}=N,s=[t=>e=>t.exec(e),(t,e)=>(n,{method:r})=>e.includes(r)&&t.exec(n),t=>e=>!t.exec(e)&&[],(t,e)=>(n,{method:r})=>(!e.includes(r)||!t.exec(n))&&[]];return i=>{let{match:a}=i;a=void 0===a?/(.*)/:t(a);const c=i["invert-match"];e(c)&&n(4);const d=i["if-match"];["undefined",C].includes(typeof d)||n(5);let u=0;const l=i[o];l&&(u+=1),c&&(u+=2);const h=s[u](a,l);i[r]=d?function(t,e){const n=h(t,e),r=t=>t?n:null;return n?(a=d(e,n),a&&a.then?a.then(r):r(a)):null}:h}})(),at=(()=>{const[,t,e]=A,n=q,r=it,[,o,,,,,,s,i,a,,c,d]=N,[u]=P;return async(l,h)=>{!function(t,e){e.cwd||(e.cwd=t.cwd)}(l,h),function(t){e(t["exclude-from-holding-list"])&&u(6)}(h),h[d]=function(t,e){const{handlers:n}=t,r=v(n);for(const t of r){const r=e[t];if(void 0!==r)return{handler:n[t],redirect:r,type:t}}u(7,{mapping:JSON.stringify(e)})}(l,h);const{handler:p}=h[d];n(h,c,p[s]),p[i]&&t(p[i],h),p.validate&&await p.validate(h,l[o]),r(h),h[a]=!0}})(),ct=(()=>{const t=at,e=ot,[n,,r,,,,,,,o,,,,s]=N,i=F,[,a]=P;return class{constructor(t){this[n]=t}get handlers(){const{handlers:t}=this[n];return v(t).reduce(((e,n)=>(e[n]=b({},t[n]),e)),{})}get mappings(){return[].concat(this[n].mappings)}get http2(){return this[n].http2}get protocol(){return this[n].protocol}async setMappings(e,s,c=5e3){const d=this[n];await async function(e,n){for(const r of n)r[o]||await t(e,r)}(d,e);const u=d[r],l=Object.values(u.contexts),h=l.filter((({request:t})=>t===s))[0],p=l.filter((t=>t!==h)).map((({holding:t})=>t)),[f,,m]=i(),g=setTimeout((()=>m(a(14))),c),y=Promise.race([Promise.all(p),f]).then((()=>{clearTimeout(g),d.mappings=e}));return u.holding=y.then(void 0,(()=>{})),y.then(void 0,(()=>{console.log("REserve blocked during configuration.setMappings"),console.table(l.map((t=>{const{emitParameters:e,request:n,nonHolding:r,id:o}=t;let s;return s=e.statusCode?{statusCode:e.statusCode}:r?"exclude-from-holding-list":t===h?"configure.setMappings":{ms:new Date-e.start},{id:o,method:n.method,url:n.url,info:s}})))})),y}dispatch(t,r){const o=this[n];return t[s]=!0,e(o,t,r)}}})(),dt=(()=>{const t=ct,e=at,o=q,[s]=A,[,i,a,,,,c,d,p]=N,f=k,[m]=P,g=[H,J,W,Q,U].reduce(((t,e)=>(w(e),t[e[c]]=e,t)),{}),y={cwd:process.cwd(),hostname:void 0,port:5e3,"max-redirect":10,listeners:[],mappings:[{match:"(.*)",file:"./$1"},{status:404}]};function w(t,e){t.schema&&!t[p]&&(t[p]=s(t.schema)),t.method&&!t[d]&&o(t,d),typeof t.redirect!==C&&m(10,{type:e})}async function x({cwd:t,handlers:e},n){let r=e[n];typeof r===B&&(l(r)||(r=h(t,r)),r=await f(r),e[n]=r),w(r,n)}function S(){m(11)}async function E(t,e){return l(e)?(await n(e)).toString():(await n(h(t.ssl.cwd,e))).toString()}function I(t,e){const r=u(t);if(function(t,e){e.handlers&&v(e.handlers).forEach((n=>{const r=e.handlers[n];typeof r===B&&r.match(/^\.\.?\//)&&(e.handlers[n]=h(t,r))})),e.mappings&&e.mappings.forEach((e=>{e.cwd||(e.cwd=t)})),e.ssl&&!e.ssl.cwd&&(e.ssl.cwd=t),e.cwd=t}(r,e),e.extend){const t=h(r,e.extend);return delete e.extend,n(t).then((t=>JSON.parse(t.toString()))).then((n=>{const r=n.mappings,o=b(n,e);return r&&r!==o.mappings&&(o.mappings=[...e.mappings,...r]),I(t,o)}))}return e}return[w,async function(n,r){typeof n===_&&null!==n||m(13);const o=b({},n);return function(t){v(y).forEach((e=>{Object.prototype.hasOwnProperty.call(t,e)||(t[e]=y[e])}))}(o),await async function(t,e={}){const n=v(g).reduce(((t,e)=>(t[e]=b({},g[e]),t)),{});t.handlers=b({},t.handlers||{},n),v(e).forEach((n=>b(t.handlers[n],e[n])));for(const e of v(t.handlers))await x(t,e)}(o,r),await async function({cwd:t,listeners:e}){Array.isArray(e)||S();let n=0;for(let r of e){let o=typeof r;o===B&&(r=await f(h(t,r)),e[n]=r,o=typeof r),o!==C&&S(),++n}}(o),await async function(t){t.ssl?(t.ssl.cert=await E(t,t.ssl.cert),t.ssl.key=await E(t,t.ssl.key),t.protocol="https"):t.protocol="http",[!0,!1,void 0].includes(t.http2)||m(12),t.http2||(t.http2=!1)}(o),await async function(n){const r=new t(n);n[i]=r;for(const t of n.mappings)await e(n,t)}(o),o[a]={lastId:0,holding:null,contexts:{}},o},async function(t){let e;return e=l(t)?t:h(process.cwd(),t),r(e).then((()=>n(e).then((t=>JSON.parse(t.toString()))))).then((t=>I(e,t)))}]})(),ut=(()=>{const[,t]=dt,e=ot,[n]=tt,r=D,o=L,[,s,,i]=N,a=et;return(c,d)=>{const{on:u,emit:l}=n(),h={on:u,close:()=>Promise.resolve()};return t(c,d).then((t=>{t[i]=l,t.listeners.forEach((t=>t(h))),l(0,{configuration:t[s],server:null});const n=e.bind(null,t);h.request=function(){const t=new r(...arguments),e=new o,s=e.waitForFinish();return n(t,e).then((()=>s))};const c=t.hostname||a(),{port:d,http2:u}=t;l(1,{url:`${t.protocol}://${c}:${d}/`,port:d,http2:u})})).catch((t=>{l(3,{error:t})})),h}})(),lt=(()=>{const[t]=tt,[,e]=dt,n=ot,[,r,,a]=N,c=et,d=nt,[u]=P;function l(t,e,n){return x(((a,c)=>{const d=function(t,e){const{httpOptions:n}=t;return t.ssl?t.http2?s.createSecureServer({key:t.ssl.key,cert:t.ssl.cert,...n},e):i.createServer({key:t.ssl.key,cert:t.ssl.cert,...n},e):t.http2?s.createServer(n,e):o.createServer(n,e)}(e,n.bind(null,e));t(0,{configuration:e[r],server:d});let{port:u}=e;"auto"===u&&(u=0),d.listen(u,e.hostname,(t=>t?c(t):a(d)))}))}return r=>{const{on:o,emit:s}=t(),i={on:o};let h;return e(r).then((async t=>{let e=t.port;0!==e&&await d(e)&&u(2,{port:e}),t[a]=s,t.listeners.forEach((t=>t(i))),h=await l(s,t,n);const r=t.hostname||c();e=h.address().port;const{http2:o}=t;s(1,{url:`${t.protocol}://${r}:${e}/`,port:e,http2:o})})).catch((t=>{s(3,{reason:t})})),i.close=()=>{if(h)return x((t=>h.close((()=>t()))))},i}})();return(()=>{const[,t,e]=dt;return{Request:D,Response:L,body:G,capture:z,check:t,interpolate:j,log:Z,mock:ut,punycache:O,read:e,send:M,serve:lt}})()};