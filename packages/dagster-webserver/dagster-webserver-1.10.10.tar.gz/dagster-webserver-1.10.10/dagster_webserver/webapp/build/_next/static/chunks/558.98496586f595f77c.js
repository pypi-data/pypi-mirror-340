"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{80558:function(e,n,r){r.d(n,{dP:function(){return et},Wi:function(){return G},rA:function(){return Y}});var t=r(73235),i=r(52322),s=r(48177),l=r(18984),o=r(76154),c=r(60206),d=r(94466),a=r(27100),u=r(97077),x=r(96832),p=r(3217),h=r(99564),j=r(39361),m=r(50683),g=r(74741),y=r(15997),f=r(1026),v=r(26834),b=r(58351),C=r(2784),I=r(7267),R=r(47933),S=r(4760),w=r(43863),_=r(29872),E=r(98933),$=r(96798),F=r(84991),O=r(93781),k=r(87933),P=r(20913),z=r(87642),K=r(86224),T=r(41349),D=r(69706),L=r(56065),N=r(68313),q=r(69752);function A(){let e=(0,t._)(["\n  query RunsRootQuery($limit: Int, $cursor: String, $filter: RunsFilter!) {\n    pipelineRunsOrError(limit: $limit, cursor: $cursor, filter: $filter) {\n      ... on Runs {\n        results {\n          id\n          ...RunTableRunFragment\n        }\n      }\n      ... on InvalidPipelineRunsFilterError {\n        message\n      }\n      ...PythonErrorFragment\n    }\n  }\n\n  ","\n  ","\n"]);return A=function(){return e},e}let Q=(0,S.Ps)(A(),L.Z,q.B);function U(){let e=(0,t._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return U=function(){return e},e}function B(){let e=(0,t._)(["\n  mutation DeleteConcurrencyLimit($concurrencyKey: String!) {\n    deleteConcurrencyLimit(concurrencyKey: $concurrencyKey)\n  }\n"]);return B=function(){return e},e}function J(){let e=(0,t._)(["\n  mutation FreeConcurrencySlots($runId: String!, $stepKey: String) {\n    freeConcurrencySlots(runId: $runId, stepKey: $stepKey)\n  }\n"]);return J=function(){return e},e}function V(){let e=(0,t._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          status\n        }\n      }\n    }\n  }\n"]);return V=function(){return e},e}let G=e=>{var n,r;let{concurrencyKey:t}=e;(0,$.Px)(),(0,O.j)("Pool: ".concat(t));let[j,m]=C.useState(),[g,y]=C.useState(!1),f=(0,S.aM)(w.l,{variables:{pool:t}}),{data:v,refetch:b}=f,F=null==v?void 0:v.instance.concurrencyLimit,k=null==v?void 0:v.instance.runQueuingSupported,z=(0,E.C4)(f,E.dT),K=(0,I.k6)(),T=null==v?void 0:null===(n=v.instance.poolConfig)||void 0===n?void 0:n.poolGranularity;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{overflowY:"auto"},children:F?(0,i.jsxs)(s.x,{children:[(0,i.jsxs)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},border:"bottom",children:[(0,i.jsx)(l.X6,{children:(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(R.rU,{to:"/deployment/concurrency",children:"Pools"})}),(0,i.jsx)("div",{children:"/"}),(0,i.jsx)("div",{children:t})]})}),(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)(E.xi,{refreshState:z}),(0,i.jsx)(o.J2,{position:"bottom-right",content:(0,i.jsx)(c.v2,{children:(0,i.jsx)(c.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>y(!0)})}),children:(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"expand_more"})})})]})]}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},children:(0,i.jsx)(l.pm,{children:"Pool info"})}),k||"op"===T?null:(0,i.jsx)(s.x,{margin:{horizontal:20,bottom:20},children:(0,i.jsx)(u.b,{intent:"warning",title:"Run granularity for pools not supported",description:(0,i.jsxs)(i.Fragment,{children:["The pool granularity is set to ",(0,i.jsx)(l.fv,{children:"run"}),", but run-level concurrency is not supported with this run coordinator. To enable run granularity for pools, configure your instance to use the default ",(0,i.jsx)(l.fv,{children:"QueuedRunCoordinator"})," ","in your ",(0,i.jsx)(l.fv,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})})}),(0,i.jsx)(s.x,{padding:{bottom:24},children:(0,i.jsx)(x.fJ,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Granularity"}),(0,i.jsx)("td",{children:"run"===T?"Run":"Op"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Limit"}),(0,i.jsx)("td",{children:(0,i.jsxs)(s.x,{flex:{justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(s.x,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:F.slotCount?F.slotCount:null===F.limit?(0,i.jsx)(i.Fragment,{children:"—"}):F.limit}),F.usingDefaultLimit?(0,i.jsx)(l.YS,{color:p.Aw(),children:"(default)"}):null]}),(0,i.jsx)(d.zx,{icon:(0,i.jsx)(a.JO,{name:"edit"}),onClick:()=>m(!0),children:"Edit limit"})]})})]})]})})}),(null==v?void 0:null===(r=v.instance.poolConfig)||void 0===r?void 0:r.poolGranularity)!=="run"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress steps"})}),(0,i.jsx)(s.x,{style:{marginLeft:-1},children:(0,i.jsx)(Z,{keyInfo:F,refresh:b})}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued runs"})}),(0,i.jsx)(X,{pool:t,runStatuses:P.sy})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"In progress"})}),(0,i.jsx)(X,{pool:t,runStatuses:P.Ys}),(0,i.jsx)(s.x,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.pm,{children:"Queued"})}),(0,i.jsx)(X,{pool:t,runStatuses:P.sy})]})]}):(0,i.jsx)(s.x,{flex:{direction:"column",alignItems:"center"},padding:{vertical:64},children:(0,i.jsx)(h.f,{label:"Loading…"})})}),(0,i.jsx)(H,{concurrencyKey:t,open:!!j,onClose:()=>m(!1),onComplete:b,minValue:(null==v?void 0:v.instance.minConcurrencyLimitValue)||0,maxValue:(null==v?void 0:v.instance.maxConcurrencyLimitValue)||1e3}),(0,i.jsx)(M,{concurrencyKey:t,open:!!g,onClose:()=>y(!1),onComplete:()=>{K.push("/deployment/concurrency"),(0,_.B)({icon:"trash",intent:"success",message:"Deleted pool limit"})}})]})},Y=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!e)return!1;let t=parseInt(e);return!isNaN(t)&&String(t)===e.trim()&&t>=n&&t<=r},H=e=>{let{concurrencyKey:n,open:r,onClose:t,onComplete:o,minValue:c,maxValue:a}=e,[u,x]=C.useState(!1),[p,h]=C.useState("");C.useEffect(()=>{h("")},[r]);let[g]=(0,S.Db)(en),y=async()=>{x(!0),await g({variables:{concurrencyKey:n,limit:parseInt(p.trim())}}),x(!1),o(),t()};return(0,i.jsxs)(j.Vq,{isOpen:r,title:(0,i.jsxs)("span",{children:["Edit ",(0,i.jsx)(l.fv,{children:n})]}),onClose:t,children:[(0,i.jsxs)(j.a7,{children:[(0,i.jsx)(s.x,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(s.x,{margin:{bottom:16},children:(0,i.jsx)("strong",{children:n})}),(0,i.jsxs)(s.x,{margin:{bottom:4},children:["Pool limit (",c,"-",a,"):"]}),(0,i.jsx)(s.x,{children:(0,i.jsx)(m.oi,{value:p||"",onChange:e=>h(e.target.value),placeholder:"".concat(c," - ").concat(a)})})]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{intent:"none",onClick:t,children:"Close"}),u?(0,i.jsx)(d.zx,{intent:"primary",disabled:!0,children:"Updating…"}):(0,i.jsx)(d.zx,{intent:"primary",onClick:y,disabled:!Y(p.trim(),c,a),children:"Update limit"})]})]})},M=e=>{let{concurrencyKey:n,open:r,onClose:t,onComplete:s}=e,[o,c]=C.useState(!1),[a]=(0,S.Db)(er),u=async()=>{c(!0),await a({variables:{concurrencyKey:n}}),c(!1),s(),t()},x=(0,i.jsxs)(i.Fragment,{children:["Delete ",(0,i.jsx)(l.fv,{children:n})]});return(0,i.jsxs)(j.Vq,{isOpen:r,title:x,onClose:t,children:[(0,i.jsxs)(j.a7,{children:["Delete concurrency limit\xa0",(0,i.jsx)("strong",{children:n}),"?"]}),(0,i.jsxs)(j.cN,{children:[(0,i.jsx)(d.zx,{onClick:t,children:"Close"}),(0,i.jsx)(d.zx,{intent:"danger",disabled:o,onClick:u,children:o?"Deleting…":"Delete limit"})]})]})},W=e=>{let{pendingStep:n,onUpdate:r}=e,[t]=(0,S.Db)(et);return(0,i.jsx)(o.J2,{content:(0,i.jsxs)(c.v2,{children:[(0,i.jsx)(c.sN,{icon:"status",text:"Free concurrency slot for step",onClick:async()=>{var e;(null===(e=(await t({variables:{runId:n.runId,stepKey:n.stepKey}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(r(),await (0,_.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slot"}))}},"free-concurrency-slots-step"),(0,i.jsx)(c.sN,{icon:"status",text:"Free all concurrency slots for run",onClick:async()=>{var e;await (0,_.B)({intent:"primary",message:"Freeing concurrency slots..."}),(null===(e=(await t({variables:{runId:n.runId}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&(r(),await (0,_.B)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"}))}},"free-concurrency-slots-run")]}),position:"bottom-right",children:(0,i.jsx)(d.zx,{rightIcon:(0,i.jsx)(a.JO,{name:"expand_more"}),children:"Actions"})})},X=e=>{var n,r;let{pool:t,runStatuses:l}=e,{queryResult:o,paginationProps:c}=function(e,n){let{queryResult:r,paginationProps:t}=(0,N.l)({nextCursorForResult:e=>{var n;if("Runs"===e.pipelineRunsOrError.__typename)return null===(n=e.pipelineRunsOrError.results[9])||void 0===n?void 0:n.id},getResultArray:e=>e&&"Runs"===e.pipelineRunsOrError.__typename?e.pipelineRunsOrError.results:[],variables:{filter:e},query:Q,pageSize:10});return{queryResult:r,paginationProps:t}}({statuses:Array.from(l),tags:[{key:"".concat(K.H.PoolTagPrefix,"/").concat(t),value:"true"}]},0),d=(null===(n=o.data)||void 0===n?void 0:n.pipelineRunsOrError)||(null===(r=o.previousData)||void 0===r?void 0:r.pipelineRunsOrError),a=(0,E.C4)(o,15e3);return d?"Runs"!==d.__typename?(0,i.jsx)(s.x,{padding:{vertical:64},children:(0,i.jsx)(y.t,{icon:"error",title:"Query error",description:d.message})}):d.results.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{position:"absolute",right:16,top:-32},children:(0,i.jsx)(E.xi,{refreshState:a})}),(0,i.jsx)(z.A,{runs:d.results,loading:o.loading}),d.results.length>0?(0,i.jsx)(s.x,{margin:{vertical:16},children:(0,i.jsx)(f.pI,{...c})}):null]}):(0,i.jsx)(s.x,{padding:{vertical:24},border:"top-and-bottom",flex:{direction:"column",alignItems:"center"},children:l.has(F.VOA.STARTED)?"No matching runs in progress.":"No matching runs in queue."}):(0,i.jsx)(s.x,{padding:{vertical:48},children:(0,i.jsx)(g.$,{purpose:"page"})})},Z=e=>{var n;let{keyInfo:r,refresh:t}=e,l=[...new Set(r.pendingSteps.map(e=>e.runId))],o=(0,S.aM)(ei,{variables:{filter:{runIds:l}},skip:!r.pendingSteps.length}),c={};((null===(n=o.data)||void 0===n?void 0:n.pipelineRunsOrError.__typename)==="Runs"?o.data.pipelineRunsOrError.results:[]).forEach(e=>{c[e.id]=e.status});let d=[...r.pendingSteps];d.sort((e,n)=>e.priority&&n.priority&&e.priority!==n.priority?e.priority-n.priority:e.enqueuedTimestamp-n.enqueuedTimestamp);let u=d.filter(e=>!!e.assignedTimestamp),x=d.filter(e=>!e.assignedTimestamp),h=(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Run ID"}),(0,i.jsx)("th",{children:"Step key"}),(0,i.jsx)("th",{children:"Assigned"}),(0,i.jsx)("th",{children:"Queued"}),(0,i.jsx)("th",{children:(0,i.jsxs)(s.x,{flex:{alignItems:"center",direction:"row",gap:4},children:["Priority",(0,i.jsx)(v.u,{placement:"top",content:"Priority can be set on each op/asset using the 'dagster/priority' tag. Higher priority steps will be assigned slots first.",children:(0,i.jsx)(a.JO,{name:"info",color:p.md()})})]})}),(0,i.jsx)("th",{})]})});return d.length?(0,i.jsxs)(b.i,{children:[h,(0,i.jsx)("tbody",{style:{backgroundColor:p.B5()},children:u.map(e=>(0,i.jsx)(ee,{step:e,statusByRunId:c,onUpdate:t},e.runId+e.stepKey))}),(0,i.jsx)("tbody",{children:x.map(e=>(0,i.jsx)(ee,{step:e,statusByRunId:c,onUpdate:t},e.runId+e.stepKey))})]}):(0,i.jsx)(y.t,{icon:"no-results",title:"No active steps",description:"There are no active or pending steps for this pool."})},ee=e=>{let{step:n,statusByRunId:r,onUpdate:t}=e,o=r[n.runId];return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o?(0,i.jsx)(R.rU,{to:"/runs/".concat(n.runId),children:(0,i.jsxs)(s.x,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,i.jsx)(k.O_,{status:o,size:10}),(0,i.jsx)(l.fv,{children:(0,T.EI)({id:n.runId})}),P.hd.has(o)?(0,i.jsx)(v.u,{placement:"top",content:"Slots for canceled / failed runs can automatically be freed by configuring a run monitoring setting.",children:(0,i.jsx)(a.JO,{name:"info",color:p.md()})}):null]})}):(0,i.jsx)(l.fv,{children:(0,T.EI)({id:n.runId})})}),(0,i.jsx)("td",{children:(0,i.jsx)(l.fv,{children:n.stepKey})}),(0,i.jsx)("td",{children:n.assignedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.assignedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.enqueuedTimestamp?(0,i.jsx)(D.Q,{startUnix:n.enqueuedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.priority}),(0,i.jsx)("td",{children:(0,i.jsx)(W,{pendingStep:n,onUpdate:t})})]})},en=(0,S.Ps)(U()),er=(0,S.Ps)(B()),et=(0,S.Ps)(J()),ei=(0,S.Ps)(V())}}]);
//# sourceMappingURL=558.98496586f595f77c.js.map