"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2737],{75853:function(e,n,r){r.r(n),r.d(n,{default:function(){return G}});var t=r(90228),o=r.n(t),a=r(87999),l=r.n(a),s=r(48305),c=r.n(s),i=r(49280),u=r(82344),d=r(57989),p=r(67581),f=r(38551),m=r(54235),g=r(85885),h=r(82187),v=r.n(h),x=r(32699),b=r.n(x),C=r(50959),y=r(94299),k=r(91082),j=r(15558),N=r.n(j),S=r(26068),w=r.n(S),$=r(58573),P=r(90343),O=r(38780),Z=r(59995),_=r(77353),z=r(34155),I=r(19019),M=r(51076),T=r(76808),E=r(68476),R=r(8267),B=r(23333),A=r(83603),q=r(54876),H=(r(99951),r(26174)),L=r(24662),F=(r(29031),r(32314),r(76223),r(39616)),U=r(58849),K=r(63057),Y=r(91860),D=r(11527),V=[{type:"InputNumber",name:"top_n",label:{text:"Top N",isLocalized:!1},attrs:{min:1},rules:[{required:!0,message:"Top N is required"}]}],W=(0,C.forwardRef)((function(e,n){var r=e.modelList,t=(0,C.useRef)(0),a=(0,f.useIntl)(),s=(0,Z.Z)(),i=(0,C.useState)(!1),u=c()(i,2),d=u[0],p=u[1],m=(0,C.useState)(!1),h=c()(m,2),x=h[0],y=h[1],j=(0,C.useState)(null),S=c()(j,2),W=S[0],X=S[1],G=(0,C.useState)(!1),J=c()(G,2),Q=J[0],ee=J[1],ne=(0,C.useRef)(null),re=(0,C.useRef)(null),te=(0,C.useRef)(0),oe=(0,C.useRef)(null),ae=(0,C.useRef)(!0),le=(0,C.useState)(!1),se=c()(le,2),ce=se[0],ie=se[1],ue=(0,C.useState)([]),de=c()(ue,2),pe=de[0],fe=de[1],me=(0,C.useState)([{text:"",uid:-1,name:""},{text:"",uid:-2,name:""}]),ge=c()(me,2),he=ge[0],ve=ge[1],xe=(0,C.useState)([]),be=c()(xe,2),Ce=be[0],ye=be[1],ke=(0,C.useState)(""),je=c()(ke,2),Ne=je[0],Se=je[1],we=(0,C.useRef)(null),$e=(0,O.Z)(),Pe=$e.initialize,Oe=$e.updateScrollerPosition,Ze=(0,L.X)({modelList:r,isChat:!0},{defaultValues:{top_n:3},defaultParamsConfig:V,metaKeys:H.m4}),_e=Ze.handleOnValuesChange,ze=Ze.formRef,Ie=Ze.paramsConfig,Me=Ze.initialValues,Te=Ze.parameters,Ee=Ze.paramsRef,Re=Ze.modelMeta,Be=Ze.formFields;(0,C.useImperativeHandle)(n,(function(){return{viewCode:function(){p(!0)},setCollapse:function(){ee(!Q)}}}));var Ae=(0,C.useMemo)((function(){return function(e){var n=e.api,r=e.parameters,t=window.location.origin;return{curlCode:"\ncurl ".concat(t).concat(n,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,F.Yy)(r,!1)).trim(),pythonCode:'\nimport requests\n\nurl="'.concat(t).concat(n,'"\nheaders = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n}\ndata = ').concat(JSON.stringify(r,null,2),"\n\nresponse = requests.post(url, headers=headers, json=data)\nprint(response.json())").trim(),nodeJsCode:"\nconst axios = require('axios');\n\nconst url = \"".concat(t).concat(n,'";\nconst headers = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n};\nconst data = ').concat(JSON.stringify(r,null,2),";\n\naxios.post(url, data, { headers }).then((response) => {\n  console.log(response.data);\n});").trim()}}({api:"/v1/rerank",parameters:w()(w()({},b().pick(Te,["model"].concat(N()(b().split(Be,","))))),{},{query:Ne,documents:[].concat(N()(he),N()(pe)).map((function(e){return e.text})).filter((function(e){return e}))})})}),[Te,Be,Ne,he,pe]),qe=(0,C.useCallback)((function(e){if(!e.showExtra||!e.percent)return null;var n=e.percent;return(0,D.jsxs)("div",{className:"rank-wrapper",children:[(0,D.jsx)("div",{className:"percent-wrapper",children:(0,D.jsx)("div",{className:"pregress-bar",style:{backgroundImage:"linear-gradient(90deg, #388bff 0%, #cce1ff 100%)",width:"".concat(n,"%"),height:"4px",borderRadius:"2px"}})}),(0,D.jsxs)("span",{className:"flex-center hover-hidden rank-tag",children:[(0,D.jsxs)(T.Z,{color:"geekblue",bordered:!1,children:[a.formatMessage({id:"playground.rerank.rank"}),": ",e.rank]}),(0,D.jsxs)(T.Z,{color:"gold",bordered:!1,children:[a.formatMessage({id:"playground.rerank.score"}),":"," ",b().round(e.score,2)]})]})]})}),[]),He=function(){return t.current=t.current+1,t.current},Le=function(){var e=l()(o()().mark((function e(){var n,r,t,a,l,c,i,u,d,p,f,m;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=ze.current)||void 0===n?void 0:n.form.validateFields();case 3:if(Te.model){e.next=5;break}return e.abrupt("return");case 5:if(l=[].concat(N()(he),N()(pe)),l.filter((function(e){return e.text})).length){e.next=10;break}return ie(!0),e.abrupt("return");case 10:return ie(!1),y(!0),He(),X(null),ye([]),null===(r=oe.current)||void 0===r||null===(t=r.cancel)||void 0===t||t.call(r),oe.current=s(),e.next=19,(0,k.AA)({model:Te.model,top_n:Te.top_n,query:Ne,documents:[].concat(N()(he.map((function(e){return e.text}))),N()(pe.map((function(e){return e.text}))))},{token:oe.current.token});case 19:c=e.sent,He(),X(c.usage),i=b().sortBy(c.results||[],(function(e){return e.relevance_score})),u=i[i.length-1].relevance_score,d=i[0].relevance_score,p=he.map((function(e){return e.percent=void 0,e.score=void 0,e.rank=void 0,e})),f=[],null===(a=c.results)||void 0===a||a.forEach((function(e,n){var r,t,o,a,l,s,c;f.push(e.index),p[e.index]=w()(w()({},p[e.index]),{},{uid:He(),rank:n+1,score:e.relevance_score,showExtra:!0,percent:(r={min:d,max:u,value:e.relevance_score},t=[.5,1],o=t[0],a=t[1],l=r.min,s=r.max,c=r.value,isNaN(c)||isNaN(l)||isNaN(s)||l>s?0:l===s?100:100*(o+(c-l)*(a-o)/(s-l)))})})),p=b().sortBy(p,"rank"),ye(f),ve(p),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(0),X({error:!0,errorMessage:null===(m=e.t0.response)||void 0===m||null===(m=m.data)||void 0===m||null===(m=m.error)||void 0===m?void 0:m.message});case 36:return e.prev=36,y(!1),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[0,33,36,39]])})));return function(){return e.apply(this,arguments)}}(),Fe=(0,C.useCallback)((function(e){var n=null==e?void 0:e.map((function(e){return e.percent=void 0,e.score=void 0,e.rank=void 0,e}));ve(n)}),[]),Ue=(0,C.useCallback)((function(e){we.current=e}),[]),Ke=(0,C.useCallback)((function(e,n){if(ae.current){var r=e.clipboardData.getData("text");if(r){var t,o,a=r.split("\n").map((function(e){return{text:null==e?void 0:e.trim(),uid:He(),name:""}}));a[0].text="".concat((null===(t=we.current)||void 0===t?void 0:t.beforeText)||"").concat(a[0].text).concat((null===(o=we.current)||void 0===o?void 0:o.afterText)||"");var l=[].concat(N()(he.slice(0,n)),N()(a),N()(he.slice(n+1))).filter((function(e){return e.text})).map((function(e,n){return e.percent=void 0,e.score=void 0,e.rank=void 0,w()(w()({},e),{},{uid:He()})}));ve(l)}}}),[he]),Ye=(0,C.useCallback)((function(e){var n=null==e?void 0:e.map((function(e){return w()(w()({},e),{},{uid:He()})}));ve(n)}),[]),De=(0,C.useMemo)((function(){return null!=Re&&Re.n_ctx&&null!=Re&&Re.n_slot?(0,D.jsx)(E.Z.Item,{children:(0,D.jsx)(P.Z,{disabled:!0,label:"Max Tokens",value:b().divide(null==Re?void 0:Re.n_ctx,null==Re?void 0:Re.n_slot)})}):null}),[Re]),Ve=(0,C.useCallback)((function(e,n){e.model&&X(null),_e(e,n)}),[]);return(0,C.useEffect)((function(){ne.current&&Pe(ne.current)}),[Pe]),(0,C.useEffect)((function(){he.length+pe.length>te.current&&Oe(),te.current=he.length+pe.length}),[he.length,pe.length]),(0,D.jsxs)("div",{className:"ground-left-wrapper rerank",children:[(0,D.jsxs)("div",{className:"ground-left",children:[(0,D.jsxs)("div",{className:"ground-left-footer",children:[(0,D.jsx)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-0",style:{padding:"0 32px",marginTop:16},children:(0,D.jsx)("span",{children:a.formatMessage({id:"playground.rerank.query"})})}),(0,D.jsx)("div",{style:{margin:"16px 32px 10px"},children:(0,D.jsx)(R.Z.Search,{allowClear:!0,onSearch:function(e){Le()},onChange:function(e){Se(e.target.value)},enterButton:(0,D.jsx)(B.Z,{title:(0,D.jsx)("span",{children:a.formatMessage({id:"common.button.submit"})}),children:(0,D.jsx)("span",{className:"full-wrap",children:(0,D.jsx)(_.Z,{rotate:0,className:"font-size-14"})})}),placeholder:a.formatMessage({id:"playground.rerank.query.holder"})})})]}),(0,D.jsxs)("div",{className:"center",ref:ne,children:[(0,D.jsxs)("div",{className:"documents",children:[(0,D.jsxs)("div",{className:"flex-between m-b-8 doc-header",children:[(0,D.jsx)("h3",{className:"m-l-10 flex-between flex-center font-size-14 line-24 m-b-0",children:(0,D.jsx)("span",{children:a.formatMessage({id:"playground.embedding.documents"})})}),(0,D.jsxs)("span",{className:"m-l-10 font-size-12",children:[" ",(null==W?void 0:W.total_tokens)&&(0,D.jsxs)("span",{style:{color:"var(--ant-orange)"},children:[a.formatMessage({id:"playground.tokenusage"}),":"," ",null==W?void 0:W.total_tokens]})]}),(0,D.jsxs)("div",{className:"flex-center gap-10",children:[(0,D.jsx)(B.Z,{title:a.formatMessage({id:"playground.input.multiplePaste.tips"}),children:(0,D.jsxs)(A.Z,{defaultChecked:ae.current,onChange:function(e){ae.current=e.target.checked},children:[a.formatMessage({id:"playground.input.multiplePaste"}),(0,D.jsx)(z.Z,{className:"m-l-4"})]})}),(0,D.jsxs)(g.ZP,{size:"middle",onClick:function(){var e;null===(e=re.current)||void 0===e||e.handleAdd()},children:[(0,D.jsx)(I.Z,{}),a.formatMessage({id:"playground.embedding.addtext"})]}),(0,D.jsx)(g.ZP,{icon:(0,D.jsx)(M.Z,{}),size:"middle",disabled:x,onClick:function(){ve([{text:"",uid:-1,name:""},{text:"",uid:-2,name:""}]),fe([]),X(null),ie(!1)},children:a.formatMessage({id:"common.button.clear"})})]})]}),(0,D.jsxs)("div",{className:"docs-wrapper",children:[(0,D.jsx)(K.Z,{sortIndex:Ce,ref:re,textList:he,showLabel:!1,sortable:!1,height:46,onChange:Fe,onSort:Ye,extra:qe,onSelect:Ue,onPaste:Ke},t.current),ce&&(0,D.jsx)("div",{className:"m-t-16",children:(0,D.jsx)($.Z,{type:"danger",message:a.formatMessage({id:"playground.documents.verify.rerank"})})})]})]}),(0,D.jsx)("div",{}),(0,D.jsx)("div",{className:"message-list-wrap",style:{paddingInline:0,paddingTop:0},children:(0,D.jsx)(D.Fragment,{children:(0,D.jsx)("div",{className:"content",children:x&&(0,D.jsx)(q.Z,{size:"small",children:(0,D.jsx)("div",{style:{height:"46px"}})})})})})]})]}),(0,D.jsx)("div",{className:v()("params-wrapper",{collapsed:Q}),ref:Ee,children:(0,D.jsx)("div",{className:"box",children:(0,D.jsx)(U.Z,{ref:ze,onValuesChange:Ve,paramsConfig:Ie,initialValues:Me,modelList:r,extra:De})})}),(0,D.jsx)(Y.Z,{open:d,viewCodeContent:Ae,onCancel:function(){p(!1)},title:a.formatMessage({id:"playground.viewcode"})})]})})),X=W,G=(r(64232),function(){var e=(0,f.useIntl)(),n=(0,C.useRef)(null),r=(0,C.useRef)(null),t=(0,C.useState)([]),a=c()(t,2),s=a[0],h=a[1],x=(0,C.useState)(!1),j=c()(x,2),N=j[0],S=j[1],w=(0,C.useCallback)((function(){var e,n;null===(e=r.current)||void 0===e||null===(n=e.viewCode)||void 0===n||n.call(e)}),[r]),$=(0,C.useCallback)((function(){var e,n;null===(e=r.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e)}),[r]);(0,C.useEffect)((function(){var e=function(){var e=l()(o()().mark((function e(){var n,r,t;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:d.Us.reranker,with_meta:!0},e.next=4,(0,k.nb)(n);case 4:return r=e.sent,t=b().map(r.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",t);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var n=l()(o()().mark((function n(){var r,t,a;return o()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Promise.all([e()]);case 3:r=n.sent,t=c()(r,1),a=t[0],h(a),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),S(!0);case 12:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();n()}),[]);return(0,y.y1)(u.ZP.RIGHT.join(","),(function(){var e,r;null===(e=n.current)||void 0===e||null===(r=e.setCollapse)||void 0===r||r.call(e)}),{preventDefault:!0}),(0,D.jsx)(p._z,{ghost:!0,header:{title:e.formatMessage({id:"menu.playground.rerank"}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}},extra:(0,D.jsxs)(m.Z,{children:[(0,D.jsx)(g.ZP,{size:"middle",onClick:w,icon:(0,D.jsx)(i.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,D.jsx)(g.ZP,{size:"middle",onClick:$,icon:(0,D.jsx)(i.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons"),className:v()("playground-container chat"),children:(0,D.jsx)("div",{className:"play-ground",children:(0,D.jsx)("div",{className:"chat",children:(0,D.jsx)(X,{ref:r,modelList:s,loaded:N})})})})})},76223:function(){},76808:function(e,n,r){r.d(n,{Z:function(){return Z}});var t=r(50959),o=r(82187),a=r.n(o),l=r(90123),s=r(7827),c=r(25802),i=r(64698),u=r(6456),d=r(29797),p=r(1947),f=r(99978),m=r(98231),g=r(38456),h=r(41380);const v=e=>{const{lineWidth:n,fontSizeIcon:r,calc:t}=e,o=e.fontSizeSM;return(0,g.IX)(e,{tagFontSize:o,tagLineHeight:(0,p.bf)(t(e.lineHeightSM).mul(o).equal()),tagIconSize:t(r).sub(t(n).mul(2)).equal(),tagPaddingHorizontal:8,tagBorderlessBg:e.defaultBg})},x=e=>({defaultBg:new f.C(e.colorFillQuaternary).onBackground(e.colorBgContainer).toHexString(),defaultColor:e.colorText});var b=(0,h.I$)("Tag",(e=>(e=>{const{paddingXXS:n,lineWidth:r,tagPaddingHorizontal:t,componentCls:o,calc:a}=e,l=a(t).sub(r).equal(),s=a(n).sub(r).equal();return{[o]:Object.assign(Object.assign({},(0,m.Wf)(e)),{display:"inline-block",height:"auto",marginInlineEnd:e.marginXS,paddingInline:l,fontSize:e.tagFontSize,lineHeight:e.tagLineHeight,whiteSpace:"nowrap",background:e.defaultBg,border:`${(0,p.bf)(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusSM,opacity:1,transition:`all ${e.motionDurationMid}`,textAlign:"start",position:"relative",[`&${o}-rtl`]:{direction:"rtl"},"&, a, a:hover":{color:e.defaultColor},[`${o}-close-icon`]:{marginInlineStart:s,fontSize:e.tagIconSize,color:e.colorTextDescription,cursor:"pointer",transition:`all ${e.motionDurationMid}`,"&:hover":{color:e.colorTextHeading}},[`&${o}-has-color`]:{borderColor:"transparent",[`&, a, a:hover, ${e.iconCls}-close, ${e.iconCls}-close:hover`]:{color:e.colorTextLightSolid}},"&-checkable":{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",[`&:not(${o}-checkable-checked):hover`]:{color:e.colorPrimary,backgroundColor:e.colorFillSecondary},"&:active, &-checked":{color:e.colorTextLightSolid},"&-checked":{backgroundColor:e.colorPrimary,"&:hover":{backgroundColor:e.colorPrimaryHover}},"&:active":{backgroundColor:e.colorPrimaryActive}},"&-hidden":{display:"none"},[`> ${e.iconCls} + span, > span + ${e.iconCls}`]:{marginInlineStart:l}}),[`${o}-borderless`]:{borderColor:"transparent",background:e.tagBorderlessBg}}})(v(e))),x),C=function(e,n){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(r[t[o]]=e[t[o]])}return r};const y=t.forwardRef(((e,n)=>{const{prefixCls:r,style:o,className:l,checked:s,onChange:c,onClick:i}=e,u=C(e,["prefixCls","style","className","checked","onChange","onClick"]),{getPrefixCls:p,tag:f}=t.useContext(d.E_),m=p("tag",r),[g,h,v]=b(m),x=a()(m,`${m}-checkable`,{[`${m}-checkable-checked`]:s},null==f?void 0:f.className,l,h,v);return g(t.createElement("span",Object.assign({},u,{ref:n,style:Object.assign(Object.assign({},o),null==f?void 0:f.style),className:x,onClick:e=>{null==c||c(!s),null==i||i(e)}})))}));var k=y,j=r(41136);var N=(0,h.bk)(["Tag","preset"],(e=>(e=>(0,j.Z)(e,((n,r)=>{let{textColor:t,lightBorderColor:o,lightColor:a,darkColor:l}=r;return{[`${e.componentCls}${e.componentCls}-${n}`]:{color:t,background:a,borderColor:o,"&-inverse":{color:e.colorTextLightSolid,background:l,borderColor:l},[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}})))(v(e))),x);const S=(e,n,r)=>{const t="string"!=typeof(o=r)?o:o.charAt(0).toUpperCase()+o.slice(1);var o;return{[`${e.componentCls}${e.componentCls}-${n}`]:{color:e[`color${r}`],background:e[`color${t}Bg`],borderColor:e[`color${t}Border`],[`&${e.componentCls}-borderless`]:{borderColor:"transparent"}}}};var w=(0,h.bk)(["Tag","status"],(e=>{const n=v(e);return[S(n,"success","Success"),S(n,"processing","Info"),S(n,"error","Error"),S(n,"warning","Warning")]}),x),$=function(e,n){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(r[t[o]]=e[t[o]])}return r};const P=t.forwardRef(((e,n)=>{const{prefixCls:r,className:o,rootClassName:p,style:f,children:m,icon:g,color:h,onClose:v,bordered:x=!0,visible:C}=e,y=$(e,["prefixCls","className","rootClassName","style","children","icon","color","onClose","bordered","visible"]),{getPrefixCls:k,direction:j,tag:S}=t.useContext(d.E_),[P,O]=t.useState(!0),Z=(0,l.Z)(y,["closeIcon","closable"]);t.useEffect((()=>{void 0!==C&&O(C)}),[C]);const _=(0,s.o2)(h),z=(0,s.yT)(h),I=_||z,M=Object.assign(Object.assign({backgroundColor:h&&!I?h:void 0},null==S?void 0:S.style),f),T=k("tag",r),[E,R,B]=b(T),A=a()(T,null==S?void 0:S.className,{[`${T}-${h}`]:I,[`${T}-has-color`]:h&&!I,[`${T}-hidden`]:!P,[`${T}-rtl`]:"rtl"===j,[`${T}-borderless`]:!x},o,p,R,B),q=e=>{e.stopPropagation(),null==v||v(e),e.defaultPrevented||O(!1)},[,H]=(0,c.Z)((0,c.w)(e),(0,c.w)(S),{closable:!1,closeIconRender:e=>{const n=t.createElement("span",{className:`${T}-close-icon`,onClick:q},e);return(0,i.wm)(e,n,(e=>({onClick:n=>{var r;null===(r=null==e?void 0:e.onClick)||void 0===r||r.call(e,n),q(n)},className:a()(null==e?void 0:e.className,`${T}-close-icon`)})))}}),L="function"==typeof y.onClick||m&&"a"===m.type,F=g||null,U=F?t.createElement(t.Fragment,null,F,m&&t.createElement("span",null,m)):m,K=t.createElement("span",Object.assign({},Z,{ref:n,className:A,style:M}),U,H,_&&t.createElement(N,{key:"preset",prefixCls:T}),z&&t.createElement(w,{key:"status",prefixCls:T}));return E(L?t.createElement(u.Z,{component:"Tag"},K):K)})),O=P;O.CheckableTag=k;var Z=O}}]);