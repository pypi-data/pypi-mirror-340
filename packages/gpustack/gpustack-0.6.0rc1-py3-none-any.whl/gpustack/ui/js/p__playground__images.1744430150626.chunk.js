"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3560,7348],{56581:function(e,n,t){t.d(n,{Yo:function(){return a},gn:function(){return i}});var r=t(9389),a=(0,r.cn)(new Map),i=function(e,n){var t=(0,r.K7)(),i=t.get(a);i.set(e,n),t.set(a,i)}},58573:function(e,n,t){var r=t(26068),a=t.n(r),i=t(78093),s=t(87497),o=t(50959),l=t(11527),c=function(e){var n=e.message,t=e.type,r=e.rows,o=void 0===r?1:r,c=e.ellipsis,u=e.style;return(0,l.jsx)(l.Fragment,{children:n?(0,l.jsxs)(s.Z.Paragraph,{type:t,ellipsis:void 0!==c?c:{rows:o,tooltip:n},style:a()({textAlign:"center",padding:"2px 5px",borderRadius:"var(--border-radius-base)",margin:0,backgroundColor:"var(--ant-color-error-bg)"},u),children:[(0,l.jsx)(i.Z,{className:"m-r-8"}),n]}):null})};n.Z=o.memo(c)},77470:function(e,n){n.Z={"/playground/text-to-image":"/playground/text-to-image","/playground/speech":"/playground/speech"}},91860:function(e,n,t){var r=t(48305),a=t.n(r),i=t(76932),s=t(43585),o=t(90515),l=t(38551),c=t(1956),u=t(85885),d=t(50959),f=t(11527),m="bash",h="python",p="javascript",g=[{label:"Curl",value:m},{label:"Python",value:h},{label:"Nodejs",value:p}],v=function(e){var n=e||{},t=n.title,r=n.open,v=n.onCancel,x=n.viewCodeContent,y=(0,l.useIntl)(),w=(0,d.useState)(m),k=a()(w,2),C=k[0],j=k[1],b=(0,d.useMemo)((function(){return C===m?null==x?void 0:x.curlCode:C===p?null==x?void 0:x.nodeJsCode:C===h?null==x?void 0:x.pythonCode:""}),[C,x]);return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(c.Z,{title:t,open:r,centered:!0,onCancel:function(){j(m),v()},destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,footer:null,children:[(0,f.jsx)("div",{style:{marginBottom:"10px"},children:y.formatMessage({id:"playground.viewcode.info"})}),(0,f.jsxs)("div",{children:[(0,f.jsx)(i.Z,{copyText:b,langOptions:g,defaultValue:m,showHeader:!0,onChangeLang:function(e){j(e)},styles:{wrapper:{backgroundColor:"var(--color-editor-dark)"}},children:(0,f.jsx)("div",{style:{paddingRight:2,paddingBottom:2},children:(0,f.jsx)(s.Z,{height:380,theme:"dark",code:b,lang:C,copyable:!1})})}),(0,f.jsxs)("div",{style:{marginTop:10,display:"flex",alignItems:"baseline"},children:[(0,f.jsx)(o.Z,{className:"m-r-8"}),(0,f.jsx)("span",{children:y.formatMessage({id:"playground.viewcode.tips"},{here:(0,f.jsx)(u.ZP,{type:"link",size:"small",href:"#/api-keys",target:"_blank",style:{paddingInline:2},children:(0,f.jsxs)("span",{children:[" ",y.formatMessage({id:"playground.viewcode.here"})]})})})})]})]})]})})};n.Z=d.memo(v)},77964:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ee}});var r=t(90228),a=t.n(r),i=t(87999),s=t.n(i),o=t(48305),l=t.n(o),c=t(49280),u=t(37963),d=t(82344),f=t(69997),m=t(57989),h=t(46824),p=t(84869),g=t(67581),v=t(38551),x=t(54235),y=t(85885),w=t(96938),k=t(47946),C=t(82187),j=t.n(C),b=t(32699),M=t.n(b),R=t(50959),S=t(94299),Z=t(91082),_=t(26068),I=t.n(_),N=t(56581),z=t(58573),U=t(77470),P=t(42326),O=t(58258),L=t(17485),T=t(67201),E=t(23333),A=(t(99951),t(24662)),Y=t(15558),D=t.n(Y),F=t(38780),H=t(1731),W=t(69510),B="AAAABJRU5ErkJgg===";function K(e){var n=e.scroller,t=e.paramsRef,r=e.chunkFields,i=e.API,o=(0,R.useState)(!1),c=l()(o,2),u=c[0],d=c[1],f=(0,R.useState)(null),m=l()(f,2),h=m[0],p=m[1],g=(0,R.useState)([]),v=l()(g,2),x=v[0],y=v[1],w=(0,R.useState)(""),k=l()(w,2),C=k[0],j=k[1],b=(0,R.useRef)(0),S=(0,R.useRef)(null),_=(0,F.Z)().initialize,N=(0,F.Z)().initialize;(0,R.useEffect)((function(){n.current&&_(n.current)}),[_]),(0,R.useEffect)((function(){t.current&&N(t.current)}),[N]);var z=function(e,n){return e.endsWith(n)?e.slice(0,-n.length):e},U=function(e){var n={span:12};return 1===e.n&&(n.span=24),2===e.n&&(n.span=12),3===e.n&&(n.span=12),4===e.n&&(n.span=12),n},P=function(){return b.current=b.current+1,b.current},O=function(){var e=s()(a()().mark((function e(n){var t,s,o,l,c,u,f,m,h,g,v;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.model){e.next=3;break}return e.abrupt("return");case 3:if(o=U(n),d(!0),P(),p(null),l=M().split(n.size,"x").map((function(e){return M().toNumber(e)})),c=Array(n.n).fill({}).map((function(e,n){return I()(I()({dataUrl:"data:image/png;base64,"},o),{},{progress:0,height:l[1],width:l[0],loading:!0,progressType:"dashboard",preview:!1,uid:P()})})),y(c),null===(t=S.current)||void 0===t||null===(s=t.abort)||void 0===s||s.call(t),S.current=new AbortController,u={},i!==Z.U$){e.next=17;break}return e.next=16,(0,W.U3)({data:n,url:"".concat(i,"?t=").concat(Date.now()),signal:S.current.signal});case 16:u=e.sent;case 17:if(i!==Z.d9){e.next=21;break}return e.next=20,(0,W.HH)({data:n,url:"".concat(i,"?t=").concat(Date.now()),signal:S.current.signal});case 20:u=e.sent;case 21:if(!u.error){e.next=25;break}return p({error:!0,errorMessage:(0,H.Yo)(u)}),y([]),e.abrupt("return");case 25:return m=(f=u).reader,h=f.decoder,e.next=28,(0,W.YT)(m,h,(function(e){var t,a;null!=e&&e.error?p({error:!0,errorMessage:(null==e||null===(a=e.error)||void 0===a?void 0:a.message)||(null==e?void 0:e.message)||""}):(null==e||null===(t=e.data)||void 0===t||t.forEach((function(e){var t=c[e.index];e.b64_json&&M().get(n,r)?t.dataUrl+=z(e.b64_json,B):e.b64_json&&(t.dataUrl="data:image/png;base64,".concat(z(e.b64_json,B)));var a=e.progress;c[e.index]={dataUrl:t.dataUrl,height:l[1],width:l[0],maxHeight:"".concat(l[1],"px"),maxWidth:"".concat(l[0],"px"),uid:t.uid,span:t.span,loading:!!M().get(n,r)&&a<100,preview:i===Z.U$&&a>=100,progress:a}})),y(D()(c)))}));case 28:e.next=35;break;case 30:e.prev=30,e.t0=e.catch(0),null===(g=S.current)||void 0===g||null===(v=g.abort)||void 0===v||v.call(g),y([]);case 35:return e.prev=35,d(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[0,30,35,38]])})));return function(n){return e.apply(this,arguments)}}();return(0,R.useEffect)((function(){return function(){var e,n;null===(e=S.current)||void 0===e||null===(n=e.abort)||void 0===n||n.call(e)}}),[]),{loading:u,tokenResult:h,imageList:x,promptList:H.ce,currentPrompt:C,setImageList:y,setTokenResult:p,setCurrentPrompt:j,handleStopConversation:function(){var e,n;null===(e=S.current)||void 0===e||null===(n=e.abort)||void 0===n||n.call(e),y([]),d(!1)},generateNumber:function(e,n){return Math.floor(Math.random()*(n-e+1)+e)},handleClear:function(){y([]),p(null),j("")},submitMessage:O}}t(29031),t(76223);var G=t(39616),V=function(e){var n=e.api,t=e.parameters,r=e.isFormdata,a=void 0!==r&&r,i=e.edit,s=void 0!==i&&i,o=window.location.origin,l=n.replace(Z.Mo,Z.ZG),c="\ncurl ".concat(o).concat(l,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,G.Yy)(t,a)).trim();return s&&(c="\ncurl ".concat(o).concat(l,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,G.Yy)(M().omit(t,["mask","image"]),a)).trim().replace(/\\$/,"")),{curlCode:c,pythonCode:'\nimport requests\n\nurl="'.concat(o).concat(l,'"\nheaders = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n}\ndata = ').concat(JSON.stringify(t,null,2).replace(/null/g,"None"),"\n\nresponse = requests.post(url, headers=headers, json=data)\nprint(response.json()['data'][0]['b64_json'])").trim(),nodeJsCode:"\nconst axios = require('axios');\n\nconst url = \"".concat(o,"/").concat(Z.ZG,'/images/generations";\nconst headers = {\n  "Content-type": "application/json",\n  "Authorization": "Bearer ${YOUR_GPUSTACK_API_KEY}"\n};\nconst data = ').concat((0,G.GT)(t),";\n\naxios.post(url, data, { headers }).then((response) => {\n  console.log(response.data.data[0].b64_json);\n});").trim()}},$=function(e){var n=e.api,t=e.parameters,r=e.isFormdata,a=void 0!==r&&r,i=e.edit,s=void 0!==i&&i,o=window.location.origin,l=n.replace(Z.Mo,Z.ZG),c="\ncurl ".concat(o).concat(l,' \\\n-H "Content-Type: multipart/form-data" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n').concat((0,G.Yy)(t,a)).trim();s&&(c="\ncurl ".concat(o).concat(l,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-F image="@image.png" \\\n-F mask="@mask.png" \\\n').concat((0,G.Yy)(M().omit(t,["mask","image"]),a)).trim().replace(/\\$/,""));var u='\nfrom openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(o,"/").concat(Z.ZG,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.images.generate(\n').concat((0,G.G4)(I()({},t)),")\n\nprint(response.data[0].b64_json)").trim(),d=(0,G.GT)(I()({},t));return{curlCode:c,pythonCode:u,nodeJsCode:'\nconst OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(o,"/").concat(Z.ZG,'"\n});\n\nasync function main() {\n  const params = ').concat(d,"; \n  const response = await openai.images.generate(params);\n  console.log(response.data[0].b64_json);\n}\nmain();").trim()}},J=t(58849),X=t(88479),q=t(91860),Q=t(11527),ee=(0,R.forwardRef)((function(e,n){var t=e.modelList,r=(0,v.useIntl)(),i=(0,R.useState)(!1),o=l()(i,2),u=o[0],d=o[1],f=(0,R.useState)(!1),m=l()(f,2),h=m[0],p=m[1],g=(0,R.useRef)(null),x=(0,R.useRef)(null),w=(0,R.useRef)(null),k=(0,A.M)(e,{type:"create"}),C=k.handleOnValuesChange,b=k.handleToggleParamsStyle,S=k.setParams,_=k.form,Y=k.watchFields,D=k.formFields,F=k.paramsConfig,H=k.initialValues,W=k.parameters,B=k.isOpenaiCompatible,G=K({scroller:g,paramsRef:x,chunkFields:["stream_options","chunk_results"],API:Z.U$}),ee=G.loading,ne=G.tokenResult,te=G.imageList,re=G.promptList,ae=G.currentPrompt,ie=G.setCurrentPrompt,se=G.handleClear,oe=G.handleStopConversation,le=G.submitMessage;(0,R.useImperativeHandle)(n,(function(){return{viewCode:function(){d(!0)},setCollapse:function(){p(!h)},collapse:h}}));var ce=(0,R.useCallback)((function(){var e,n,t,r=(n=0,t=re.length-1,Math.floor(Math.random()*(t-n+1)+n)),a=re[r];null===(e=w.current)||void 0===e||e.handleInputChange({target:{value:a}})}),[]),ue=(0,R.useMemo)((function(){return"custom"===W.size?I()(I()({},M().omit(W,["width","height","preview","random_seed"])),{},{size:W.width&&W.height?"".concat(W.width,"x").concat(W.height):""}):I()({},M().omit(W,["width","height","random_seed","preview"]))}),[W]),de=(0,R.useMemo)((function(){return B?$({api:Z.U$,parameters:I()(I()({},ue),{},{prompt:ae})}):V({api:Z.U$,parameters:I()(I()({},ue),{},{prompt:ae})})}),[ue,B,ae]),fe=function(){var e=s()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=_.current)||void 0===n||null===(n=n.form)||void 0===n?void 0:n.validateFields();case 3:if(W.model){e.next=5;break}return e.abrupt("return");case 5:return a=void 0,a={chunk_size:16384,chunk_results:!0},"preview"===W.preview&&(a={preview:!0}),"preview_faster"===W.preview&&(a={preview_faster:!0}),r=I()(I()({},M().omitBy(W,(function(e,n){return!e||["width","height","seed"].includes(n)}))),{},{seed:W.random_seed?(0,O.Hq)():W.seed,stream:!0,stream_options:I()({},a),prompt:ae}),S(I()(I()({},W),{},{seed:r.seed})),null===(t=_.current)||void 0===t||null===(t=t.form)||void 0===t||t.setFieldValue("seed",r.seed),(0,N.gn)(U.Z["/playground/text-to-image"],!0),e.next=12,le(r);case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(0);case 16:return e.prev=16,(0,N.gn)(U.Z["/playground/text-to-image"],!1),e.finish(16);case 20:case"end":return e.stop()}var a}),e,null,[[0,14,16,20]])})));return function(){return e.apply(this,arguments)}}(),me=(0,R.useCallback)((function(){d(!1)}),[]);return(0,Q.jsxs)("div",{className:"ground-left-wrapper",children:[(0,Q.jsxs)("div",{className:"ground-left",children:[(0,Q.jsx)("div",{className:"message-list-wrap",ref:g,style:{paddingBottom:16},children:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsxs)("div",{className:"content",style:{height:"100%"},children:[(0,Q.jsx)(P.Z,{style:{padding:0,height:"100%",justifyContent:"center",flexDirection:"column",flexWrap:"unset",alignItems:"center"},autoBgColor:!1,editable:!1,dataList:te,responseable:!0,gutter:[8,16],autoSize:!0}),!te.length&&(0,Q.jsxs)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:[(0,Q.jsx)("span",{children:(0,Q.jsx)(L.Z,{className:"font-size-32 text-secondary"})}),(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.params.empty.tips"})})]})]})})}),ne&&(0,Q.jsx)("div",{style:{height:40},children:(0,Q.jsx)(z.Z,{type:"danger",message:null==ne?void 0:ne.errorMessage})}),(0,Q.jsx)("div",{className:"ground-left-footer",children:(0,Q.jsx)(X.Z,{ref:w,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),actions:["clear"],defaultSize:{minRows:5,maxRows:5},title:(0,Q.jsx)("span",{className:"font-600",children:r.formatMessage({id:"playground.image.prompt"})}),loading:ee,disabled:!W.model,isEmpty:!te.length,handleSubmit:fe,handleAbortFetch:oe,onInputChange:function(e){ie(e.target.value)},shouldResetMessage:!1,clearAll:se,tools:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.prompt.random"}),children:(0,Q.jsx)(y.ZP,{onClick:ce,size:"middle",type:"text",icon:(0,Q.jsx)(c.Z,{type:"icon-random"})})})})})})]}),(0,Q.jsx)("div",{className:j()("params-wrapper",{collapsed:h}),ref:x,children:(0,Q.jsx)("div",{className:"box",children:(0,Q.jsx)(J.Z,{ref:_,watchFields:Y,formFields:D,parametersTitle:(0,Q.jsxs)("div",{className:"flex-between flex-center",children:[(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,Q.jsx)(y.ZP,{size:"small",type:"text",icon:(0,Q.jsx)(T.Z,{}),onClick:b,children:B?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:C,paramsConfig:F,initialValues:H,modelList:t})})}),(0,Q.jsx)(q.Z,{open:u,viewCodeContent:de,onCancel:me,title:r.formatMessage({id:"playground.viewcode"})})]})})),ne=ee,te=t(46818),re=t(53649),ae=t.n(re),ie=t(54876),se=t(7672),oe=t.n(se),le=t(1128),ce="rgba(0, 0, 255, 0.3)";function ue(e){var n=e.overlayCanvasRef,t=e.canvasRef,r=e.offscreenCanvasRef,a=e.cursorRef,i=e.lineWidth,s=e.translatePos,o=e.autoScale,c=e.baseScale,u=e.isLoadingMaskRef,d=(0,R.useState)(1),f=l()(d,2),m=f[0],h=f[1],p=function(e){var a=e.deltaY>0?-.1:.1,i=n.current.getBoundingClientRect(),l=e.clientX-i.left,c=e.clientY-i.top;n.current.style.transform="scale(".concat(o.current,")"),t.current.style.transform="scale(".concat(o.current,")"),r.current.style.transform="scale(".concat(o.current,")"),function(e){if(!(o.current<=.5||o.current>=8)){var a=n.current.getBoundingClientRect(),i=e.clientX-a.left,s=e.clientY-a.top,l=i/a.width,c=s/a.height;n.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%"),t.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%"),r.current.style.transformOrigin="".concat(100*l,"% ").concat(100*c,"%")}}(e),function(e,n,t){var r=M().round(o.current+e,2);if(!(r<.5||r>8)){var a=o.current,i=s.current,l=(n-i.x)/a,c=(t-i.y)/a;o.current=r;var u=n-l*r,d=t-c*r;s.current={x:u,y:d}}}(a,l,c)};return{handleOnWheel:function(e){var n;u.current||(p(e),a.current.style.width="".concat(i*o.current,"px"),a.current.style.height="".concat(i*o.current,"px"),n=e,a.current.style.top="".concat(n.clientY-i/2*o.current,"px"),a.current.style.left="".concat(n.clientX-i/2*o.current,"px"),h(o.current))},setActiveScale:h,activeScale:m,autoScale:o,baseScale:c}}var de,fe=t(76574),me=t(27366),he=t(19729),pe=t(51076),ge=t(32362),ve=t(17098),xe=t(96247),ye=t(83603),we=function(e){var n=e.disabled,t=e.loading,r=e.lineWidth,a=e.uploadButton,i=e.invertMask,s=e.handleBrushSizeChange,o=e.undo,l=e.onClear,u=e.handleFitView,f=e.handleUpdateImageList,m=e.handleUpdateMaskList,h=(0,v.useIntl)();return(0,Q.jsxs)("div",{className:"tools",children:[(0,Q.jsx)(E.Z,{placement:"bottomLeft",arrow:!1,overlayInnerStyle:{background:"var(--color-white-1)",display:"flex",alignItems:"center",justifyContent:"flex-start",width:160},title:(0,Q.jsxs)("div",{className:"flex-column",style:{width:"100%"},children:[(0,Q.jsx)("span",{className:"text-secondary",children:h.formatMessage({id:"playground.image.brushSize"})}),(0,Q.jsx)(xe.Z,{disabled:n,style:{marginBlock:"4px 6px",marginLeft:0,flex:1},vertical:!1,defaultValue:r,min:10,max:100,onChange:s})]}),children:(0,Q.jsx)(y.ZP,{size:"middle",type:"text",children:(0,Q.jsx)(me.Z,{className:"font-size-14"})})}),(0,Q.jsx)(E.Z,{title:(0,Q.jsxs)("span",{children:["[",d.d4.UNDO.textKeybinding,"]",(0,Q.jsx)("span",{className:"m-l-5",children:h.formatMessage({id:"common.button.undo"})})]}),children:(0,Q.jsx)(y.ZP,{onClick:o,size:"middle",type:"text",disabled:n,children:(0,Q.jsx)(he.Z,{className:"font-size-14"})})}),(0,Q.jsx)(E.Z,{title:h.formatMessage({id:"common.button.clear"}),children:(0,Q.jsx)(y.ZP,{onClick:l,size:"middle",type:"text",disabled:n,children:(0,Q.jsx)(pe.Z,{className:"font-size-14"})})}),a,(0,Q.jsx)(fe.Z,{disabled:t||i,handleUpdateImgList:f,size:"middle",accept:"image/*"}),(0,Q.jsx)(fe.Z,{title:h.formatMessage({id:"playground.image.mask.upload"}),icon:(0,Q.jsx)(c.Z,{type:"icon-mosaic-2"}),disabled:t||i,handleUpdateImgList:m,size:"middle",accept:"image/*"}),(0,Q.jsx)(E.Z,{title:h.formatMessage({id:"playground.image.fitview"}),children:(0,Q.jsx)(y.ZP,{onClick:u,size:"middle",type:"text",disabled:t,children:(0,Q.jsx)(ge.Z,{className:"font-size-14"})})})]})},ke=function(e){var n=(0,v.useIntl)(),t=e.disabled,r=e.isOriginal,a=e.invertMask,i=e.handleOnChangeMask,s=e.downloadMask,o=e.download;return(0,Q.jsxs)("div",{className:"tools",children:[r&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(E.Z,{title:(0,Q.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:n.formatMessage({id:"playground.image.negativeMask.tips"})}),children:(0,Q.jsx)(ye.Z,{onChange:i,className:"flex-center",checked:a,disabled:t,children:(0,Q.jsx)("span",{className:"font-size-12",children:n.formatMessage({id:"playground.image.negativeMask"})})})}),(0,Q.jsx)(E.Z,{title:n.formatMessage({id:"playground.image.saveMask"}),children:(0,Q.jsx)(y.ZP,{onClick:s,size:"middle",type:"text",children:(0,Q.jsx)(c.Z,{className:"font-size-14",type:"icon-save2"})})})]}),!r&&(0,Q.jsx)(E.Z,{title:n.formatMessage({id:"playground.image.download"}),children:(0,Q.jsx)(y.ZP,{onClick:o,size:"middle",type:"text",children:(0,Q.jsx)(ve.Z,{className:"font-size-14"})})})]})},Ce=le.ZP.div(de||(de=ae()(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  width: ",";\n  z-index: 100;\n"])),(function(e){return"".concat(e.width,"px")||0})),je=function(e){var n=e.width,t=e.height;return(0,Q.jsx)(Ce,{width:n,height:t,children:(0,Q.jsx)(ie.Z,{spinning:!0})})},be=(0,R.forwardRef)((function(e,n){var r=e.loading,i=e.imageSrc,o=e.disabled,c=e.imageStatus,u=e.onSave,d=e.onScaleImageSize,f=e.handleUpdateImageList,m=e.handleUpdateMaskList,h=(e.uploadButton,e.maskUpload),p=(0,R.useRef)(null),g=(0,R.useRef)(null),v=(0,R.useRef)(null),x=(0,R.useState)(60),y=l()(x,2),w=y[0],k=y[1],C=(0,R.useRef)({x:0,y:0}),b=(0,R.useRef)(!1),S=(0,R.useState)(!1),Z=l()(S,2),_=Z[0],I=Z[1],N=(0,R.useRef)(null),z=(0,R.useState)({width:0,height:0,loading:!1}),U=l()(z,2),P=U[0],O=(U[1],function(e){var n=e.isDisabled,t=e.invertMask,r=e.maskUpload,a=e.lineWidth,i=e.translatePos,s=e.onSave,o=(0,R.useRef)(!1),l=(0,R.useRef)(null),c=(0,R.useRef)(null),u=(0,R.useRef)(null),d=(0,R.useRef)([]),f=(0,R.useRef)([]),m=(0,R.useRef)(!1),h=(0,R.useRef)(null),p=(0,R.useRef)(1),g=(0,R.useRef)(1),v=(0,R.useRef)({x:0,y:0}),x=(0,R.useRef)([]),y=(0,R.useRef)(!1),w=(0,R.useMemo)((function(){return n||t||!(null==r||!r.length)}),[n,t,r]),k=(0,R.useCallback)((function(e){for(var n=0;n<e.length;n+=4)e[n+3]>0&&(e[n]=255,e[n+1]=255,e[n+2]=255,e[n+3]=255)}),[]),C=(0,R.useCallback)((function(){return l.current.toDataURL("image/png")}),[]),j=(0,R.useCallback)((function(){if(0===f.current.length&&0===x.current.length)return null;var e=c.current,n=document.createElement("canvas");n.width=e.width,n.height=e.height;var t=n.getContext("2d"),r=e.getContext("2d").getImageData(0,0,e.width,e.height),a=r.data;return k(a),t.putImageData(r,0,0),t.globalCompositeOperation="destination-over",t.fillStyle="black",t.fillRect(0,0,n.width,n.height),n.toDataURL("image/png")}),[]),b=function(){var e=j(),n=C();s({mask:e,img:n})},S=(0,R.useCallback)((function(){u.current||(u.current=document.createElement("canvas"))}),[]),Z=(0,R.useCallback)((function(){var e,n,t;S();var r=null===(e=l.current)||void 0===e?void 0:e.getContext("2d"),a=null===(n=c.current)||void 0===n?void 0:n.getContext("2d"),s=null===(t=u.current)||void 0===t?void 0:t.getContext("2d");if(r&&a){r.resetTransform(),a.resetTransform(),s.resetTransform();var o=p.current,d=i.current,f=d.x,m=d.y;r.setTransform(o,0,0,o,f,m),a.setTransform(o,0,0,o,f,m),s.setTransform(o,0,0,o,f,m)}}),[]),_=function(e,n){var t=p.current,r=i.current;return{x:(e-r.x)/t,y:(n-r.y)/t}},I=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)||a)/p.current},N=(0,R.useCallback)((function(e,n,t){var r=t.lineWidth,a=t.color,i=t.compositeOperation;e.lineWidth=I(r),e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=i;var s=_(n.x,n.y),o=s.x,l=s.y;e.lineTo(o,l),"source-over"===i&&(e.strokeStyle=a),e.stroke()}),[I]),z=(0,R.useCallback)((function(e,n,t){var r=t.color,a=t.compositeOperation;e.lineCap="round",e.lineJoin="round",e.globalCompositeOperation=a,e.save(),e.beginPath(),n.forEach((function(n,t){var r=_(n.x,n.y),a=r.x,i=r.y;e.lineWidth=I(n.lineWidth),0===t?e.moveTo(a,i):e.lineTo(a,i)})),"source-over"===a&&(e.strokeStyle=r),e.stroke(),e.restore()}),[I,_]),U=function(e){if(!w&&m.current&&o.current){var n=e.nativeEvent,t=n.offsetX,r=n.offsetY;d.current.push({x:t,y:r,lineWidth:a});var i=c.current.getContext("2d");i.save(),N(i,{x:t,y:r,lineWidth:a},{lineWidth:a,color:ce,compositeOperation:"destination-out"}),N(i,{x:t,y:r,lineWidth:a},{lineWidth:a,color:ce,compositeOperation:"source-over"}),i.restore()}},P=(0,R.useCallback)((function(){var e,n=c.current.getContext("2d"),t=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");t.resetTransform(),n.resetTransform(),n.clearRect(0,0,c.current.width,c.current.height),t.clearRect(0,0,c.current.width,c.current.height)}),[]),O=(0,R.useCallback)((function(){var e,n=l.current,t=l.current.getContext("2d"),r=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");t.resetTransform(),t.clearRect(0,0,n.width,n.height),r.resetTransform(),r.clearRect(0,0,n.width,n.height)}),[]),L=(0,R.useCallback)((function(){var e,n=l.current,t=c.current,r=u.current,s=n.getContext("2d"),o=t.getContext("2d"),d=null===(e=u.current)||void 0===e?void 0:e.getContext("2d");p.current=1,g.current=1,i.current={x:0,y:0},v.current={x:0,y:0},n.style.transform="scale(1)",t.style.transform="scale(1)",r.style.transform="scale(1)",h.current.style.width="".concat(a,"px"),h.current.style.height="".concat(a,"px"),s.resetTransform(),o.resetTransform(),d.resetTransform()}),[]);return{canvasRef:l,overlayCanvasRef:c,offscreenCanvasRef:u,cursorRef:h,strokesRef:f,currentStroke:d,isDrawing:m,mouseDownState:o,autoScale:p,baseScale:g,maskStorkeRef:x,isLoadingMaskRef:y,creatOffscreenCanvas:S,setMaskStrokes:function(e){x.current=e},fitView:function(){L(),p.current=g.current,i.current={x:0,y:0},Z(),c.current.style.transform="scale(".concat(p.current,")"),l.current.style.transform="scale(".concat(p.current,")"),u.current.style.transform="scale(".concat(p.current,")")},setStrokes:function(e){f.current=e},resetCanvas:L,draw:U,getTransformLineWidth:I,getTransformedPoint:_,drawStroke:z,startDrawing:function(e){if(!w){m.current=!0,d.current=[];var n=e.nativeEvent,t=n.offsetX,r=n.offsetY;d.current.push({x:t,y:r,lineWidth:a});var i=c.current.getContext("2d");Z();var s=_(t,r),o=s.x,l=s.y;i.beginPath(),i.moveTo(o,l),U(e)}},endDrawing:function(e){w||m.current&&(m.current=!1,f.current.push(M().cloneDeep(d.current)),d.current=[],b())},handleMouseMove:function(e){w||(c.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},handleMouseLeave:function(){w||(m.current=!1,c.current.style.cursor="default",h.current.style.display="none")},handleMouseEnter:function(e){w?c.current.style.cursor="default":(c.current.style.cursor="none",h.current.style.display="block",h.current.style.top="".concat(e.clientY-a/2*p.current,"px"),h.current.style.left="".concat(e.clientX-a/2*p.current,"px"))},saveImage:b,generateMask:j,generateImage:C,setTransform:Z,clearOverlayCanvas:P,clearCanvas:O}}({lineWidth:w,translatePos:C,isDisabled:o,invertMask:_,maskUpload:h,onSave:u})),L=O.canvasRef,T=O.overlayCanvasRef,E=O.offscreenCanvasRef,A=O.cursorRef,Y=O.strokesRef,D=O.currentStroke,F=O.mouseDownState,H=O.autoScale,W=O.baseScale,B=O.maskStorkeRef,K=O.isLoadingMaskRef,G=O.setMaskStrokes,V=O.draw,$=(O.drawStroke,O.startDrawing),J=O.endDrawing,X=O.handleMouseMove,q=O.handleMouseLeave,ee=O.handleMouseEnter,ne=O.saveImage,te=O.resetCanvas,re=O.creatOffscreenCanvas,ae=O.generateMask,ie=(O.getTransformLineWidth,O.getTransformedPoint,O.setStrokes),se=O.setTransform,le=O.clearOverlayCanvas,de=O.clearCanvas,fe=O.fitView,me=ue({overlayCanvasRef:T,canvasRef:L,offscreenCanvasRef:E,cursorRef:A,lineWidth:w,translatePos:C,autoScale:H,baseScale:W,isLoadingMaskRef:K}),he=me.handleOnWheel,pe=me.setActiveScale,ge=me.activeScale,ve=(0,R.useMemo)((function(){return o||_||!(null==h||!h.length)}),[o,_,h]),xe=(0,R.useCallback)((function(){var e=L.current,n=T.current,t=E.current;n.width=e.width,n.height=e.height,t.width=e.width,t.height=e.height}),[]),ye=(0,R.useCallback)((function(){var e=ae(),n=document.createElement("a");n.download="mask_".concat(oe()().format("YYYYMMDDHHmmss"),".png"),n.href=e||"",n.click()}),[ae]),Ce=(0,R.useCallback)((function(){le(),ie([]),G([]),ne(),D.current=[]}),[]),be=function(e,n){try{var r,a;if(!(e.length||null!=n&&n.length))return;K.current=!0;var i=new OffscreenCanvas(T.current.width,T.current.height);g.current||(g.current=new Worker(new URL(t.p+t.u(5956),t.b),{type:void 0})),g.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(T.current.getContext("2d").putImageData(e.data.imageData,0,0),K.current=!1)},null===(r=g.current)||void 0===r||r.postMessage({canvas:i,type:"init"},[i]),null===(a=g.current)||void 0===a||a.postMessage({type:"draw",maskStrokes:e,strokes:n||[]})}catch(e){}},Me=function(){var e=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length||B.current.length){e.next=3;break}return le(),e.abrupt("return");case 3:be(B.current,n);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Re=(0,R.useCallback)((function(){if(0!==Y.current.length||0!==B.current.length){var e=Y.current.length,n=Y.current.slice(0,-1);ie(n),!n.length&&0===e&&B.current.length&&G([]),clearTimeout(N.current),N.current=setTimeout((function(){Me(n)}),100)}else le()}),[]),Se=(0,R.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.current&&L.current){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){var n=new Image;n.src=i,n.onload=function(){var t=L.current,r=t.getContext("2d"),a=v.current;W.current=Math.min(a.offsetWidth/n.width,a.offsetHeight/n.height,1),t.width=n.width,t.height=n.height,H.current=1,re(),xe(),de(),r.drawImage(n,0,0,t.width,t.height),e()}})));case 3:case"end":return e.stop()}}),e)}))),[i]),Ze=function(e){var n=T.current.getContext("2d");if(n)if(e){var r,a,i=T.current.width,s=T.current.height;le();var o=new OffscreenCanvas(T.current.width,T.current.height);p.current||(p.current=new Worker(new URL(t.p+t.u(2331),t.b),{type:void 0})),p.current.onmessage=function(e){"done"===e.data.type&&e.data.imageData&&(T.current.getContext("2d").putImageData(e.data.imageData,0,0),K.current=!1)},null===(r=p.current)||void 0===r||r.postMessage({canvas:o,type:"init"},[o]);var l=n.getImageData(0,0,i,s);null===(a=p.current)||void 0===a||a.postMessage({type:"draw",width:l.width,height:l.height,strokes:Y.current,maskStrokes:B.current})}else Me(Y.current)},_e=function(){A.current.style.width="".concat(w*H.current,"px"),A.current.style.height="".concat(w*H.current,"px")},Ie=(0,R.useCallback)(s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Se();case 2:null==d||d({width:L.current.width,height:L.current.height}),c.isResetNeeded?(Ce(),te()):(Y.current.length||B.current.length)&&c.isOriginal&&!_?(Me(Y.current),ne()):(Y.current.length||B.current.length)&&c.isOriginal&&_&&(Ze(!0),ne()),_e();case 6:case"end":return e.stop()}}),e)}))),[Se,c.isOriginal,c.isResetNeeded,_]);(0,R.useEffect)((function(){Ie()}),[Ie]),(0,R.useEffect)((function(){var e=function(e){(e.ctrlKey||e.metaKey)&&"z"===e.key&&Re()},n=function(e){F.current=!0},t=function(e){F.current=!1};return window.addEventListener("keydown",e),window.addEventListener("mousedown",n),window.addEventListener("mouseup",t),function(){clearTimeout(N.current),window.removeEventListener("keydown",e),window.removeEventListener("mousedown",n),window.removeEventListener("mouseup",t)}}),[]);var Ne=function(){I(!1),Me(Y.current),ne()};return(0,R.useImperativeHandle)(n,(function(){return{clearMask:Ne,loadMaskPixs:(e=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G(n),ie([]),se(),le(),be(n);case 5:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})};var e})),(0,R.useEffect)((function(){return p.current=new Worker(new URL(t.p+t.u(4602),t.b),{type:void 0}),g.current=new Worker(new URL(t.p+t.u(8437),t.b),{type:void 0}),function(){var e,n;null===(e=p.current)||void 0===e||e.terminate(),null===(n=g.current)||void 0===n||n.terminate()}}),[]),(0,R.useEffect)((function(){null!=h&&h.length&&le()}),[h]),(0,R.useEffect)((function(){ve&&A.current&&(A.current.style.display="none")}),[ve]),(0,Q.jsxs)("div",{className:"editor-wrapper",children:[(0,Q.jsxs)("div",{className:"flex-between",children:[(0,Q.jsx)(we,{handleBrushSizeChange:function(e){k(e),A.current.style.width="".concat(e,"px"),A.current.style.height="".concat(e,"px")},undo:Re,onClear:Ce,handleFitView:function(){fe(),pe(H.current),_e(),Me(Y.current)},handleUpdateImageList:f,handleUpdateMaskList:m,disabled:ve,lineWidth:w,invertMask:_,loading:r}),(0,Q.jsx)(ke,{handleOnChangeMask:function(e){b.current=e.target.checked,Ze(e.target.checked),I(e.target.checked),ne()},invertMask:_,downloadMask:ye,download:function(){var e,n;c.isOriginal?(e=L.current,(n=document.createElement("a")).download="image_".concat(oe()().format("YYYYMMDDHHmmss"),".png"),n.href=e.toDataURL("image/png"),n.click(),n.remove()):function(){if(i){var e=new Image;e.src=i,e.onload=function(){var n=document.createElement("canvas");n.width=c.width,n.height=c.height,n.getContext("2d").drawImage(e,0,0,n.width,n.height);var t=n.toDataURL("image/png"),r="".concat(n.width,"x").concat(n.height,"_").concat(oe()().format("YYYYMMDDHHmmss"),".png"),a=document.createElement("a");a.href=t,a.download=r,document.body.appendChild(a),a.click(),a.remove()}}}()},isOriginal:c.isOriginal,disabled:o||!(null==h||!h.length),maskUpload:h})]}),(0,Q.jsxs)("div",{className:"editor-content",ref:v,style:{position:"relative",width:"100%",height:"100%",flex:1},children:[P.loading&&(0,Q.jsx)(je,{width:P.width,height:P.height}),(0,Q.jsx)("canvas",{ref:L,style:{position:"absolute",zIndex:1}}),(0,Q.jsx)("canvas",{ref:T,className:j()("overlay-canvas",{"overlay-canvas--disabled":ve}),style:{position:"absolute",zIndex:10,cursor:"none"},onMouseDown:function(e){K.current||(F.current=!0,$(e))},onMouseUp:function(e){K.current||(F.current=!1,J(e))},onMouseEnter:ee,onWheel:he,onMouseMove:function(e){K.current||(X(e),V(e))},onMouseLeave:function(e){K.current||(J(e),q())}}),(0,Q.jsx)("div",{ref:A,style:{display:"none",position:"fixed",width:w*ge,height:w*ge,backgroundColor:"rgba(0, 0, 255, 0.3)",borderRadius:"50%",pointerEvents:"none",cursor:"none",zIndex:5}})]})]})})),Me=R.memo(be);function Re(e,n){var t=document.createElement("canvas");return t.width=e,t.height=n,{canvas:t,ctx:t.getContext("2d")}}function Se(e,n,t,r){var a=4*(t*r+n);return 255===e[a]&&255===e[a+1]&&255===e[a+2]}function Ze(e,n,t,r,a,i,s){for(var o=[[r,a]],c=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,-1],[1,-1],[-1,1]],u=function(){var r=o.pop(),a=l()(r,2),u=a[0],d=a[1];if(u<0||d<0||u>=n||d>=t||i[d][u]||!Se(e,u,d,n))return 1;i[d][u]=!0,s.push({x:u,y:d}),c.forEach((function(e){var n=l()(e,2),t=n[0],r=n[1];return o.push([u+t,d+r])}))};o.length;)u()}function _e(e){for(var n=e.data,t=e.width,r=e.height,a=Array.from({length:r},(function(){return new Array(t).fill(!1)})),i=[],s=0;s<r;s++)for(var o=0;o<t;o++)if(Se(n,o,s,t)&&!a[s][o]){var l=[];Ze(n,t,r,o,s,a,l),i.push(l)}return i}function Ie(e){return new Promise((function(n,t){var r=new Image;r.src=e,r.onload=function(){return n(r)},r.onerror=function(){return t(new Error("Image loading failed"))}}))}function Ne(e){return ze.apply(this,arguments)}function ze(){return(ze=s()(a()().mark((function e(n){var t,r,i,s,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(n);case 2:return t=e.sent,r=Re(t.width,t.height),r.canvas,(i=r.ctx).drawImage(t,0,0),s=i.getImageData(0,0,t.width,t.height),o=_e(s),URL.revokeObjectURL(t.src),e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ue=t(76571),Pe=(0,R.forwardRef)((function(e,n){var t=e.modelList,r=(0,v.useIntl)(),i=(0,R.useState)(!1),o=l()(i,2),u=o[0],d=o[1],f=(0,R.useState)(!1),m=l()(f,2),h=m[0],p=m[1],g=(0,R.useRef)(null),x=(0,R.useRef)(null),w=(0,R.useRef)(null),k=(0,R.useState)(""),C=l()(k,2),b=C[0],S=C[1],_=(0,R.useState)(null),P=l()(_,2),L=P[0],Y=P[1],D=(0,R.useState)([]),F=l()(D,2),W=F[0],B=F[1],G=(0,R.useState)([]),ee=l()(G,2),ne=ee[0],re=ee[1],ae=(0,R.useState)({isOriginal:!1,isResetNeeded:!1,width:512,height:512}),ie=l()(ae,2),se=ie[0],oe=ie[1],le=(0,R.useRef)(!1),ce=(0,R.useState)(0),ue=l()(ce,2),de=ue[0],me=ue[1],he=(0,R.useRef)(null),pe=(0,A.M)(e,{type:"edit"}),ge=pe.handleOnValuesChange,ve=pe.handleToggleParamsStyle,xe=pe.setParams,ye=pe.updateCacheFormData,we=pe.setInitialValues,ke=pe.updateParamsConfig,Ce=pe.setParamsConfig,je=pe.form,be=pe.modelMeta,Re=pe.watchFields,Se=pe.formFields,Ze=pe.paramsConfig,_e=pe.initialValues,Ie=pe.parameters,ze=pe.isOpenaiCompatible,Pe=K({scroller:g,paramsRef:x,chunkFields:["stream_options_chunk_result"],API:Z.d9}),Oe=Pe.loading,Le=Pe.tokenResult,Te=Pe.imageList,Ee=Pe.currentPrompt,Ae=Pe.setImageList,Ye=Pe.setCurrentPrompt,De=Pe.handleStopConversation,Fe=Pe.submitMessage;(0,R.useImperativeHandle)(n,(function(){return{viewCode:function(){d(!0)},setCollapse:function(){p(!h)},collapse:h}}));var He=(0,R.useMemo)((function(){return"custom"===Ie.size?I()(I()({},M().omit(Ie,["width","height","preview","random_seed"])),{},{image:null,mask:null,size:Ie.width&&Ie.height?"".concat(Ie.width,"x").concat(Ie.height):""}):I()({image:null,mask:null},M().omit(Ie,["width","height","random_seed","preview"]))}),[Ie]),We=(0,R.useMemo)((function(){return ze?$({api:Z.d9,edit:!0,isFormdata:!0,parameters:I()(I()({},He),{},{prompt:Ee})}):V({api:Z.d9,isFormdata:!0,edit:!0,parameters:I()(I()({},He),{},{prompt:Ee})})}),[He,Ee,Ie.size]),Be=function(){var e=s()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(n=je.current)||void 0===n||null===(n=n.form)||void 0===n?void 0:n.validateFields();case 3:if(Ie.model){e.next=5;break}return e.abrupt("return");case 5:return a=void 0,a={stream_options_chunk_size:16384,stream_options_chunk_result:!0},"preview"===Ie.preview&&(a={stream_options_preview:!0}),"preview_faster"===Ie.preview&&(a={stream_options_preview_faster:!0}),r=I()(I()(I()({},M().omitBy(He,(function(e){return!e}))),{},{seed:Ie.random_seed?(0,O.Hq)():Ie.seed,stream:!0},a),{},{prompt:Ee}),xe(I()(I()({},Ie),{},{seed:r.seed})),null===(t=je.current)||void 0===t||null===(t=t.form)||void 0===t||t.setFieldValue("seed",r.seed),(0,N.gn)(U.Z["/playground/text-to-image"],!0),e.next=11,Fe(I()(I()({},r),{},{image:(0,O.Ll)(M().get(W,"0.dataUrl"),"image"),mask:L?(0,O.Ll)(L,"mask"):null}));case 11:e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.prev=15,(0,N.gn)(U.Z["/playground/text-to-image"],!1),e.finish(15);case 19:case"end":return e.stop()}var a}),e,null,[[0,13,15,19]])})));return function(){return e.apply(this,arguments)}}(),Ke=(0,R.useCallback)((function(e){var n=(0,H.gk)({width:e.rawWidth,height:e.rawHeight}),t=n.width,r=n.height,a=be.max_width,i=be.max_height;a&&(t=Math.max(Math.min(t,a),512)),i&&(r=Math.max(Math.min(r,i),512));var s=ke({size:"custom",isOpenaiCompatible:ze});Ce(s);var o=I()(I()({},Ie),{},{size:"custom",width:t||512,height:r||512});xe(o),ye({size:"custom",width:t||512,height:r||512}),we(o)}),[Ie,be,ze]),Ge=(0,R.useCallback)((function(e){var n=M().get(e,"[0]",{}),t=M().get(n,"dataUrl","");Ke(n),B(e),S(t),me(M().get(e,"[0].uid","")),oe({isOriginal:!0,isResetNeeded:!0,width:M().get(n,"width",512),height:M().get(n,"height",512)}),Ae([])}),[Ke]),Ve=(0,R.useCallback)(function(){var e=s()(a()().mark((function e(n){var t,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=M().get(n,"[0].dataUrl",""),e.next=3,Ne(r);case 3:i=e.sent,null===(t=he.current)||void 0===t||t.loadMaskPixs(i||[]);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[]),$e=(0,R.useCallback)((function(){var e;re([]),Y(null),null===(e=he.current)||void 0===e||e.clearMask()}),[]),Je=(0,R.useCallback)((function(e){var n;oe((function(e){return I()(I()({},e),{},{isResetNeeded:!1})})),Y(e.mask||(null===(n=ne[0])||void 0===n?void 0:n.dataUrl)||null),S(e.img)}),[]),Xe=(0,R.useMemo)((function(){return b?(0,Q.jsx)(Me,{ref:he,imguid:de,imageStatus:se,imageSrc:b,loading:Oe,disabled:Oe||!se.isOriginal,onSave:Je,clearUploadMask:$e,handleUpdateImageList:Ge,handleUpdateMaskList:Ve,maskUpload:ne}):(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(fe.Z,{accept:"image/*",drag:!0,multiple:!1,handleUpdateImgList:Ge,children:(0,Q.jsxs)("div",{className:"flex-column flex-center gap-10 justify-center",style:{width:155,height:155},children:[(0,Q.jsx)(c.Z,{type:"icon-upload_image",className:"font-size-24"}),(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.edit.tips"})})]})})})}),[r,b,Oe,ne,se,Je,Ge]),qe=(0,R.useCallback)((function(e,n){e.progress<100&&!n||(me(e.uid),S(e.dataUrl),oe({isOriginal:n,isResetNeeded:!1,width:e.width,height:e.height}))}),[]);(0,R.useEffect)((function(){if(Te.length>0){var e=Te.find((function(e){return 100===e.progress}));e&&!le.current&&(le.current=!0,qe(e,!1))}}),[Te,qe]);var Qe=(0,R.useMemo)((function(){return W.length?(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(te.Z,I()(I()({},W[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return qe(W[0],!0)},label:(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.origin"})})}))}):null}),[W,r,qe]),en=(0,R.useMemo)((function(){return ne.length?(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)(te.Z,I()(I()({},ne[0]),{},{height:125,maxHeight:125,preview:!1,loading:!1,autoSize:!1,editable:!0,autoBgColor:!1,onDelete:function(){return $e()},label:(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.image.mask"})})}))}):null}),[ne,r]);return(0,Q.jsxs)("div",{className:"ground-left-wrapper",children:[(0,Q.jsxs)("div",{className:"ground-left",children:[(0,Q.jsx)("div",{className:"message-list-wrap",style:{paddingBottom:16},children:(0,Q.jsx)(Q.Fragment,{children:(0,Q.jsx)("div",{className:"content",style:{height:"100%"},children:(0,Q.jsx)("div",{className:"flex-column font-size-14 flex-center gap-20 justify-center hold-wrapper",children:Xe})})})}),(0,Q.jsxs)("div",{className:"ground-left-footer",style:{padding:10},children:[Le&&(0,Q.jsx)("div",{style:{height:40},children:(0,Q.jsx)(z.Z,{type:"danger",message:null==Le?void 0:Le.errorMessage})}),(0,Q.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,Q.jsx)("div",{className:"m-r-10",children:en}),Qe,Te.length>0&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Ue.Z,{type:"vertical",style:{margin:"0 30px",height:80}}),(0,Q.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:10},children:M().map(Te,(function(e,n){return(0,Q.jsx)("div",{style:{height:125,maxHeight:125},children:(0,Q.jsx)(te.Z,I()(I()({},e),{},{height:125,maxHeight:125,preview:e.preview,loading:e.loading,autoSize:!1,editable:!1,autoBgColor:!1,onClick:function(){return qe(e,!1)}}))},e.uid)}))})]})]})]})]}),(0,Q.jsxs)("div",{className:j()("params-wrapper",{collapsed:h}),style:{display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,Q.jsx)("div",{style:{flex:1,overflow:"auto"},ref:x,"data-overlayscrollbars-initialize":!0,children:(0,Q.jsx)("div",{className:"box",children:(0,Q.jsx)(J.Z,{ref:je,watchFields:Re,formFields:Se,parametersTitle:(0,Q.jsxs)("div",{className:"flex-between flex-center",children:[(0,Q.jsx)("span",{children:r.formatMessage({id:"playground.parameters"})}),(0,Q.jsx)(E.Z,{title:r.formatMessage({id:"playground.image.params.custom.tips"}),children:(0,Q.jsx)(y.ZP,{size:"small",type:"text",icon:(0,Q.jsx)(T.Z,{}),onClick:ve,children:ze?r.formatMessage({id:"playground.image.params.custom"}):r.formatMessage({id:"playground.image.params.openai"})})})]}),onValuesChange:ge,paramsConfig:Ze,initialValues:_e,modelList:t})})}),(0,Q.jsx)("div",{style:{width:389},children:(0,Q.jsx)(X.Z,{actions:["clear"],defaultSize:{minRows:5,maxRows:5},ref:w,placeholer:r.formatMessage({id:"playground.input.prompt.holder"}),title:(0,Q.jsx)("span",{className:"font-600",children:r.formatMessage({id:"playground.image.prompt"})}),loading:Oe,disabled:!Ie.model,isEmpty:!Te.length,handleSubmit:Be,handleAbortFetch:De,onInputChange:function(e){Ye(e.target.value)},shouldResetMessage:!1,clearAll:function(){Ye("")}})})]}),(0,Q.jsx)(q.Z,{open:u,viewCodeContent:We,onCancel:function(){d(!1)},title:r.formatMessage({id:"playground.viewcode"})})]})})),Oe=Pe,Le=(t(64232),"generate"),Te="edit",Ee=function(){var e=(0,v.useIntl)(),n=(0,f.Z)().size,t=(0,R.useState)(Le),r=l()(t,2),i=r[0],o=r[1],C=(0,R.useRef)(null),b=(0,R.useRef)(null),_=(0,R.useState)([]),I=l()(_,2),N=I[0],z=I[1],U=(0,R.useMemo)((function(){return[{label:e.formatMessage({id:"playground.image.generate"}),value:Le,icon:(0,Q.jsx)(h.Z,{})},{label:e.formatMessage({id:"playground.image.edit"}),value:Te,icon:(0,Q.jsx)(p.Z,{})}]}),[e]),P=(0,R.useCallback)((function(){var e,n;if(i===Le)null===(e=C.current)||void 0===e||null===(n=e.viewCode)||void 0===n||n.call(e);else if(i===Te){var t,r;null===(t=b.current)||void 0===t||null===(r=t.viewCode)||void 0===r||r.call(t)}}),[i]),O=(0,R.useCallback)((function(){var e,n,t,r;i!==Le?null===(e=b.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e):null===(t=C.current)||void 0===t||null===(r=t.setCollapse)||void 0===r||r.call(t)}),[i]),L=(0,R.useMemo)((function(){return[{key:Le,label:"Generate",children:(0,Q.jsx)(ne,{ref:C,modelList:N})},{key:Te,label:"Edit",children:(0,Q.jsx)(Oe,{modelList:N,ref:b})}]}),[N]);(0,R.useEffect)((function(){var e,t,r;n.width<u.Z.lg&&(null===(e=C.current)||void 0===e||!e.collapse)&&(null===(t=C.current)||void 0===t||null===(r=t.setCollapse)||void 0===r||r.call(t))}),[n.width]),(0,R.useEffect)((function(){var e=function(){var e=s()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={categories:m.Us.image,with_meta:!0},e.next=4,(0,Z.nb)(n);case 4:return t=e.sent,r=M().map(t.data||[],(function(e){return{value:e.id,label:e.id,meta:e.meta}})),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var n=s()(a()().mark((function n(){var t;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e();case 3:t=n.sent,z(t),n.next=9;break;case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(){return n.apply(this,arguments)}}();n()}),[]);var T=(0,R.useMemo)((function(){return(0,Q.jsxs)(x.Z,{children:[(0,Q.jsx)(y.ZP,{size:"middle",onClick:P,icon:(0,Q.jsx)(c.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,Q.jsx)(y.ZP,{size:"middle",onClick:O,icon:(0,Q.jsx)(c.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons")}),[e,P,O]),E=(0,R.useMemo)((function(){return{title:(0,Q.jsxs)("div",{className:"flex items-center",children:[(0,Q.jsx)("span",{className:"font-600",children:e.formatMessage({id:"menu.playground.text2images"})}),(0,Q.jsx)(w.Z,{options:U,size:"middle",className:"m-l-40",onChange:function(e){return o(e)}})]}),style:{paddingInline:"var(--layout-content-header-inlinepadding)"},breadcrumb:{}}}),[U]);return(0,S.y1)(d.ZP.RIGHT.join(","),(function(){var e,n;null===(e=C.current)||void 0===e||null===(n=e.setCollapse)||void 0===n||n.call(e)}),{preventDefault:!0}),(0,Q.jsx)(g._z,{ghost:!0,header:E,extra:T,className:j()("playground-container chat"),children:(0,Q.jsx)("div",{className:"play-ground",children:(0,Q.jsx)("div",{className:"chat",children:(0,Q.jsx)(k.Z,{items:L,activeKey:i})})})})}},39616:function(e,n,t){t.d(n,{G4:function(){return u},GT:function(){return d},Yy:function(){return c}});var r=t(26068),a=t.n(r),i=t(31759),s=t.n(i),o=t(32699),l=t.n(o),c=function(e,n){return n?l().keys(e).reduce((function(n,t){var r=e[t],a="object"===s()(r)?JSON.stringify(r,null,2):"".concat(r);return n+"-F ".concat(t,'="').concat(a,'" \\\n')}),""):"-d '".concat(JSON.stringify(e,null,2),"'")},u=function(e){return l().keys(e).reduce((function(n,t){if(null===e[t]||void 0===e[t])return n;var r="object"===s()(e[t])?JSON.stringify(e[t],null,2):'"'.concat(e[t],'"');return n+"  ".concat(t,"=").concat(r,",\n")}),"")},d=function(e){return JSON.stringify(a()({},e),null,4)}}}]);