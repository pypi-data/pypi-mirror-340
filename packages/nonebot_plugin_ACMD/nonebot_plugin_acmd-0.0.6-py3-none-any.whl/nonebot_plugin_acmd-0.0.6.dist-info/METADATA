Metadata-Version: 2.3
Name: nonebot_plugin_ACMD
Version: 0.0.6
Summary: ä¸€ä¸ªä¸“æ³¨äºè§£å†³è¾“å…¥é—®é¢˜çš„å‘½ä»¤å®ç°ã€‚
License: AGPL-3.0
Author: hlfzsi
Requires-Python: >=3.10,<4.0
Classifier: License :: OSI Approved :: GNU Affero General Public License v3
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Requires-Dist: aiofiles (>=24.1.0,<25.0.0)
Requires-Dist: aiosqlite (>=0.20.0,<0.21.0)
Requires-Dist: httpx (>=0.28.1,<0.29.0)
Requires-Dist: nonebot-adapter-onebot (>=2.4.6,<3.0.0)
Requires-Dist: nonebot2 (>=2.4.1,<3.0.0)
Requires-Dist: pypinyin (>=0.53.0,<0.54.0)
Requires-Dist: rapidfuzz (>=3.11.0,<4.0.0)
Description-Content-Type: text/markdown

<div align="center">
  <a href="https://v2.nonebot.dev/store"><img src="https://github.com/A-kirami/nonebot-plugin-template/blob/resources/nbp_logo.png" width="180" height="180" alt="NoneBotPluginLogo"></a>
  <br>
  <p><img src="https://github.com/A-kirami/nonebot-plugin-template/blob/resources/NoneBotPlugin.svg" width="240" alt="NoneBotPluginText"></p>
</div>

<div align="center">

# nonebot-plugin-ACMD

_âœ¨ å¦ä¸€ä¸ªæ’ä»¶å¼€å‘æ–¹æ¡ˆ âœ¨_

<a href="./LICENSE">
    <img src="https://img.shields.io/pypi/l/nonebot-plugin-ACMD" alt="license">
</a>
<a href="https://pypi.python.org/pypi/nonebot-plugin-ACMD">
    <img src="https://img.shields.io/pypi/v/nonebot-plugin-ACMD.svg" alt="pypi">
</a>
<img src="https://img.shields.io/badge/python-3.10+-blue.svg" alt="python">

</div>

</details>
nonebot-plugin-ACMD æ˜¯ä¸€ä¸ªæ”¯æŒ ç”¨æˆ·è¾“å…¥çº é”™ã€æŒ‡ä»¤çƒ­ä¿®æ”¹ çš„å¦ä¸€ä¸ªæ’ä»¶å¼€å‘æ–¹æ¡ˆã€‚

* [X]  ç”¨æˆ·è¾“å…¥çº é”™ä¸è‡ªåŠ¨è¡¥å…¨
* [ ]  ~~çƒ­é‡è½½ ~~ï¼ˆå°šæ— è®¡åˆ’ï¼‰
* [X]  æŒ‡ä»¤çƒ­ä¿®æ”¹
* [X]  å‘½ä»¤è¡ŒæŒ‡ä»¤ä¸è‡ªåŠ¨è¡¥å…¨
* [X]  ä¾èµ–æ³¨å…¥

## ğŸ’¿ å®‰è£…

<details open>
<summary>ä½¿ç”¨ nb-cli å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œ, è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å³å¯å®‰è£…

```
nb plugin install nonebot-plugin-ACMD
```

</details>

<details>
<summary>ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…</summary>
åœ¨ nonebot2 é¡¹ç›®çš„æ’ä»¶ç›®å½•ä¸‹, æ‰“å¼€å‘½ä»¤è¡Œ, æ ¹æ®ä½ ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨, è¾“å…¥ç›¸åº”çš„å®‰è£…å‘½ä»¤

<details>
<summary>pip</summary>

```
pip install nonebot-plugin-ACMD
```

</details>
<details>
<summary>pdm</summary>

```
pdm add nonebot-plugin-ACMD
```

</details>
<details>
<summary>poetry</summary>

```
poetry add nonebot-plugin-ACMD
```

</details>
<details>
<summary>conda</summary>

```
conda install nonebot-plugin-ACMD
```

</details>

æ‰“å¼€ nonebot2 é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `pyproject.toml` æ–‡ä»¶, åœ¨ `[tool.nonebot]` éƒ¨åˆ†è¿½åŠ å†™å…¥

```
plugins = ["nonebot_plugin_ACMD"]
```

</details>

## âš™ï¸ é…ç½®

åœ¨ nonebot2 é¡¹ç›®çš„ `.env`æ–‡ä»¶ä¸­æ·»åŠ ä¸‹è¡¨ä¸­çš„é…ç½®


|     é…ç½®é¡¹     | å¿…å¡« | é»˜è®¤å€¼ |                  è¯´æ˜                  |
| :-------------: | :--: | :----: | :------------------------------------: |
| similarity_rate |  æ˜¯  |  75.0  | ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œåªæœ‰é«˜äºé˜ˆå€¼çš„è¾“å…¥ä¼šè¢«çº æ­£ |

## ğŸ‰ ä½¿ç”¨

### è‡ªå¸¦æŒ‡ä»¤


|         æŒ‡ä»¤         |  æƒé™  | éœ€è¦@ | èŒƒå›´ |          è¯´æ˜          |
| :------------------: | :----: | :---: | :--: | :--------------------: |
| /help [model] [page] | æ‰€æœ‰äºº |  å¦  | å…¨åŸŸ | è¿”å›ACMDç”Ÿæˆçš„å¸®åŠ©æ–‡æ¡£ |

## ğŸ“– ä»‹ç» / å¼€å‘è¯´æ˜

**å¦‚æœä½ åªæ˜¯ä¸€èˆ¬ç”¨æˆ·è€Œéå¼€å‘è€…ï¼Œåç»­å†…å®¹æ— éœ€é˜…è¯»**

æœ¬æ–‡æ¡£é€‰å–éƒ¨åˆ†ACMDé¡¶å±‚æ‰€å¯¼å…¥çš„æ¨¡å—è¿›è¡Œä»‹ç»ã€‚

### å®é™…æ¡ˆä¾‹

å‚é˜…æœ¬é¡¹ç›®æ ¹ç›®å½•ä¸‹exampleã€‚å¦‚å›¾ä¸ºexampleå®é™…è¿è¡Œæ•ˆæœã€‚å»ºè®®åœ¨é˜…è¯»åé¢çš„æ–‡æ¡£æ—¶ä¸exampleè¿›è¡Œæ¯”å¯¹ã€‚

![1737942838201](images/readme/1737942838201.png)

### ACMD_get_driveræ–¹æ³•

```python
from nonebot_plugin_ACMD import ACMD_get_driver
driver = ACMD_get_driver()
```

> **Warning** : ACMDçš„driverå’Œnonebotçš„driverå®Œå…¨ä¸åŒï¼ŒACMDä»…ä»…æä¾›äº†æ³¨å†Œå¯åŠ¨å‡½æ•°å’Œæ³¨å†Œå›æ”¶å‡½æ•°ä¸¤ä¸ªæ–¹æ³•

ä¸ºä»€ä¹ˆä½¿ç”¨ACMDçš„driverï¼Ÿ

ACMDçš„driverä¸ºACMDçš„ä¾èµ–æ³¨å…¥å’Œçƒ­é‡è½½è®¾è®¡ï¼Œå¦‚æœä½ ä¸éœ€è¦ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½ï¼Œå®Œå…¨ä¸éœ€è¦ä½¿ç”¨ACMDçš„driverã€‚

#### on_startup

è¢«è£…é¥°å‡½æ•°ä¸æ¥å—ä»»ä½•ä¼ å…¥ã€‚è£…é¥°å™¨ä¸æ¥å—ä»»ä½•ä¼ å…¥ã€‚

#### on_shutdown

è¢«è£…é¥°å‡½æ•°ä¸æ¥å—ä»»ä½•ä¼ å…¥ã€‚è£…é¥°å™¨ä¸æ¥å—ä»»ä½•ä¼ å…¥ã€‚

### ~~HotSigner~~

~~è¿™æ˜¯ACMDçš„çƒ­é‡è½½å®ç°æ¨¡å—ã€‚~~

**å·²åºŸå¼ƒ**

```python
from nonebot_plugin_ACMD import HotSigner
HotSigner.add_plugin()
```

~~ä¸éœ€è¦ä¼ å…¥ã€‚ACMDå°†è‡ªåŠ¨åˆ†æã€‚éœ€è¦æ³¨æ„ï¼ŒACMDçš„çƒ­é‡è½½å…·æœ‰ä¼ æŸ“æ€§ã€‚å¦‚æœä½ çš„ä¾èµ–é“¾ä¸­æœ‰ä»»ä½•ä¸€ä¸ªæ’ä»¶å¯ç”¨äº†çƒ­é‡è½½ï¼Œä½ çš„æ’ä»¶ä¹Ÿå¿…é¡»æ”¯æŒçƒ­é‡è½½ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸å¯é¢„æ–™çš„åæœã€‚~~

### BasicHandler

è¿™æ˜¯æ•´ä¸ªACMDå¤„ç†è¿‡ç¨‹çš„æ ¸å¿ƒå¯¹è±¡ã€‚

```python
from nonebot_plugin_ACMD import BasicHandler
```

æ‰€æœ‰çš„å¤„ç†å™¨éƒ½åº”å½“ç»§æ‰¿è‡ªBasicHandlerã€‚

å®ƒçš„å®ç°å¦‚ä¸‹ï¼š

```python
class BasicHandler(ABC, metaclass=SingletonABCMeta):
    """å¤„ç†å™¨åŸºç±»

    - å¿…é¡»å®ç°å¼‚æ­¥æ–¹æ³• handle

    - å±æ€§:
        - block (bool): æ˜¯å¦é˜»æ–­ä¼ æ’­,é»˜è®¤ä¸ºTrue
        - handler_id (int): å¤„ç†å™¨ID,ç”±HandlerManagerè‡ªåŠ¨åˆ†é…
        - unique (str): å¤„ç†å™¨å”¯ä¸€æ ‡è¯†ç¬¦,å¯ç”¨äºæµ‹è¯•è¾¨è¯†,é»˜è®¤ä¸ºNone

    - å¯ä½¿ç”¨çš„æ–¹æ³•:
        - is_PrivateMessageEvent åˆ¤æ–­å½“å‰æ¶ˆæ¯äº‹ä»¶æ˜¯å¦ä¸ºç§èŠæ¶ˆæ¯
        - get_self_id è·å–å½“å‰å¤„ç†å™¨å®ä¾‹çš„å¤„ç†ID
        - get_handler_by_id é€šè¿‡å¤„ç†IDè·å–å¤„ç†å™¨å®ä¾‹
        - get_handler_id é€šè¿‡å¤„ç†å™¨å®ä¾‹è·å–å¤„ç†ID


    - æ¨èé‡å†™æ–¹æ³• (æŒ‰æ‰§è¡Œé¡ºåºæ’åˆ—) :
        - should_handle å¼‚æ­¥  è¯¥å¤„ç†å™¨æ˜¯å¦åº”å½“æ‰§è¡Œ , å¿…é¡»è¿”å›bool
        - should_block å¼‚æ­¥  è¯¥å¤„ç†å™¨æ˜¯å¦é˜»æ–­ä¼ æ’­ , å¿…é¡»è¿”å›bool
    """
    __slots__ = ('block', '_handler_id', 'unique', 'parameters', '__weakref__')

    def __init__(self, block: bool = True, unique: str = None, **kwargs):
        self.block = block
        self._handler_id: int = HandlerManager.get_id(self)
        self.unique = unique
        self.parameters = HandlerContext.analyse_parameters(self)

    @abstractmethod
    async def handle(self, bot: Bot = None, event: Union[GroupMessageEvent, PrivateMessageEvent] = None, msg: UserInput = None, qq: PIN = None, groupid: GroupID = None, image: ImageInput = None) -> None:
        """
        ä¼ å…¥å‚æ•°è¯¦è§Atypes
        """
        pass

    @staticmethod
    def is_PrivateMessageEvent(event: Union[GroupMessageEvent, PrivateMessageEvent]):
        return event.message_type == 'private'

    async def should_handle(self) -> bool:
        return True

    async def should_block(self) -> bool:
        return self.block

    def get_self_id(self) -> int:
        return self.handler_id

    @staticmethod
    def get_handler_by_id(handler_id: int) -> Optional['BasicHandler']:
        return HandlerManager.get_handler(handler_id)

    @staticmethod
    def get_handler_id(handler: 'BasicHandler') -> int:
        return HandlerManager.get_id(handler)

    @property
    def handler_id(self) -> int:
        return self._handler_id

    def remove(self):
        HandlerManager.remove_handler(self)
        with SingletonABCMeta._lock:
            if type(self) in SingletonABCMeta._instances and SingletonABCMeta._instances[type(self)] is self:
                del SingletonABCMeta._instances[type(self)]

    def __str__(self):
        if self.unique:
            return f'{self.unique}'
        else:
            return f'{self.__class__.__name__}'
```

æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼ŒBasicHandleré‡‡å–äº†å•ä¾‹æ¨¡å¼ï¼Œå³ä¸€ä¸ªç±»åªèƒ½äº§ç”Ÿä¸€ä¸ªå®ä¾‹ã€‚

å¯¹äºBasicHandlerï¼ŒACMDé¢„å…ˆå®šä¹‰äº†ä¸€äº›å¤„ç†å™¨åŸºç±»ã€‚

```python
from nonebot_plugin_ACMD.already_handler import MessageHandler, GroupMessageHandler, PrivateMessageHandler
```

å®ƒä»¬åˆ†åˆ«æ˜¯ï¼šæ²¡æœ‰è¿‡æ»¤çš„Handlerï¼ˆBasicHandleræ¢çš®ï¼‰ï¼Œåªå¤„ç†ç¾¤èŠæ¶ˆæ¯ï¼Œåªå¤„ç†ç§èŠæ¶ˆæ¯ã€‚

å¯¹äºä¸€äº›éœ€è¦çµæ´»æ€§è€Œä¸è¿‡å¤šéœ€è¦æ‹“å±•æ€§çš„é¡¹ç›®ï¼ŒACMDæä¾›äº†è£…é¥°å™¨æ–¹æ³•å°†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°è½¬æ¢ä¸ºBasicHandlerå®ä¾‹ã€‚

```python
from nonebot_plugin_ACMD import func_to_Handler
```

è¿™é‡Œç‰¹åˆ«ä»‹ç»`message_handler`è£…é¥°å™¨ã€‚

è¿™ä¸ªè£…é¥°å™¨å…è®¸ä½ æ··å…¥ä»»æ„ä¸€ä¸ªè‡ªè¡Œå®šä¹‰çš„Handlerï¼Œè¿™å…è®¸åœ¨ä¿æŒçµæ´»æ€§çš„åŸºç¡€ä¸Šä¸æŸå¤±å¤ªå¤šæ‹“å±•æ€§ã€‚

æ­¤å¤–ï¼Œæ‰€æœ‰è£…é¥°å™¨éƒ½æ¥å—`block` `unique`å‚æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸åœ¨BasicHandlerä¸­çš„ä½œç”¨ç›¸åŒã€‚

ä¸BasicHandlerç±»ä¼¼ï¼ŒACMDä¹Ÿé¢„å…ˆå®šä¹‰äº†ä¸€äº›å…·æœ‰è¿‡æ»¤ä½œç”¨çš„è£…é¥°å™¨ã€‚

### command

è¿™é‡Œæ˜¯è”ç³»å¤„ç†å™¨ä¸æ´¾å‘çš„æ¡¥æ¢ã€‚

```python
from nonebot_plugin_ACMD import CommandFactory, Command
```

#### Command

`Command`æ˜¯ACMDçš„å‘½ä»¤å¯¹è±¡ï¼Œå®ƒå…è®¸ä½ åœ¨è¿è¡Œæ—¶ä¿®æ”¹æŒ‡ä»¤ã€‚

é€šå¸¸ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæŒ‡ä»¤ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª`Command`å¯¹è±¡ã€‚åˆ›å»ºæŒ‡ä»¤çš„æ–¹æ³•å°†åœ¨ç¨åæåŠã€‚

è¿è¡Œæ—¶ä¿®æ”¹æŒ‡ä»¤çš„æ¨èåšæ³•æ˜¯ä½¿ç”¨`updata`æ–¹æ³•ã€‚

#### CommandFactory

åˆ›å»ºæŒ‡ä»¤ã€‚

ä¸åºŸè¯ï¼Œè´´ä»£ç ã€‚

```python
class CommandFactory:
    """
    å·¥å‚ç±»,åŒ…å«æ‰€æœ‰åˆ›å»ºå‘½ä»¤æ‰€éœ€è¦çš„æ–¹æ³•

    P.S è¯¥ç±»è®¾è®¡å¹¶ä¸ç¬¦åˆå·¥å‚ç±»è§„èŒƒ
    """
    @staticmethod
    def create_command(commands: Optional[List[str]] = None, handler_list: Union[str, int, BasicHandler, List[Union[str, int, BasicHandler]]] = None, owner: Optional[str] = None, description: Optional[str] = '', full_match: bool = False) -> Optional[Command]:
        """åˆ›å»ºå‘½ä»¤å¯¹è±¡ã€‚

        Args:
            commands (List[str]): å‘½ä»¤åˆ—è¡¨ã€‚ä¸ä¼ å…¥æˆ–ä¼ å…¥`None`ä»£è¡¨æ— éœ€å‘½ä»¤ï¼Œæ€»æ˜¯è§¦å‘ã€‚
            handler_list (str, int, BasicHandler, List[str, int, BasicHandler]): å¤„ç†å™¨å•ä¾‹æˆ–åˆ—è¡¨
            owner (str): æ‰€æœ‰è€…, ç”¨äºæ ‡è¯†æŒ‡ä»¤æ‰€å±æ’ä»¶
            description (str, optional): æè¿°. Defaults to ''.
            full_match (bool, optional): æ˜¯å¦å®Œå…¨åŒ¹é…. Defaults to False.

        Returns:
            Command: å‘½ä»¤å¯¹è±¡
        """
        if handler_list is None:
            raise RuntimeError("æ²¡æœ‰å¤„ç†å™¨ä¼ å…¥")

        if not isinstance(handler_list, list):
            handler_list = [handler_list]

        caller_frame = inspect.stack()[1]
        script_folder_path = os.path.abspath(
            os.path.dirname(caller_frame.filename))

        if commands is None:
            for handler in handler_list:
                HandlerManager.set_Unconditional_handler(handler)
            return None

        if owner is None:
            raise RuntimeError(f"å‘½ä»¤ {commands} æ²¡æœ‰æŒ‡å®šæ‹¥æœ‰è€…")

        return Command(commands, description, owner, full_match, handler_list, script_folder_path=script_folder_path)

    @staticmethod
    def create_help_command(owner: str, help_text: str = '', function: Callable = None) -> None:
        """æ¥ç®¡å¸®åŠ©å‘½ä»¤ã€‚

        Args:
            owner (str): è¢«æ¥ç®¡æ’ä»¶å¯¹è±¡
            help_text (str): å¸®åŠ©æ–‡æœ¬
            function (Callable, optional): å¸®åŠ©å‘½ä»¤å¤„ç†å‡½æ•°. Defaults to None.å¯è¿”å›å­—ç¬¦ä¸²,ä¹Ÿå¯è¿”å›None

            é€šå¸¸æƒ…å†µä¸‹,help_textä¸functioné€‰æ‹©ä¸€ä¸ªä¼ å…¥å³å¯,functionä¼˜å…ˆçº§æ›´é«˜.
        """
        HelpTakeOverManager.takeover_help(owner, help_text, function)


    @staticmethod
    def parameter_injection(field: str, field_type: type):
        """
        è£…é¥°å™¨ç”¨äºè®¾ç½®ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å¯ä»¥è¢«è§£æå¹¶ç”±handlerè°ƒç”¨ã€‚

        å‚æ•°:
            field (str): æ–°å­—æ®µçš„åç§°ã€‚
            field_type (type): æ–°å­—æ®µçš„ç±»å‹ã€‚
        """
        def decorator(func):
            # æ£€æŸ¥funcæ˜¯å¦ä¸ºåç¨‹å‡½æ•°
            if not inspect.iscoroutinefunction(func):
                raise RuntimeError("è¢«è£…é¥°å‡½æ•°å¿…é¡»æ˜¯å¼‚æ­¥çš„")

            HandlerContext.insert_field(field, field_type, func)

            async def wrapper(*args, **kwargs):
                result = await func(*args, **kwargs)
                return result

            return wrapper

        return decorator
```

å¤§ä½“ä¸Šï¼Œåªéœ€è¦é˜…è¯»æ–¹æ³•çš„æ–‡æ¡£å­—ç¬¦ä¸²å³å¯ã€‚

ç‰¹åˆ«åœ°ï¼Œå¦‚æœ`create_command`æ–¹æ³•çš„`commands`å‚æ•°ä¼ å…¥ä¸ºNoneï¼Œè¯¥å¤„ç†å™¨ä¼šè¢«ä½œä¸ºä¸€ä¸ªæ— æ¡ä»¶å¤„ç†å™¨ï¼Œå³åªè¦æœ‰æ¶ˆæ¯åˆ™å¿…å®šå“åº”ã€‚

### Atypes

ACMDçš„ç±»å‹æç¤ºæ¨¡å—ã€‚

ä¾èµ–æ³¨å…¥åŸºäºAtypeså®ç°ã€‚

```python
import nonebot_plugin_ACMD.Atypes
```

é€šå¸¸ï¼Œä½ éœ€è¦ä½¿ç”¨Atypesçš„è‹¥å¹²ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š`UserInput` `GroupID` `ImageInput` `Record` `PIN` ã€‚

å…·ä½“è¯·é˜…è¯»Atypeså„ç±»å‹çš„æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå®ƒä»¬éå¸¸è¯¦ç»†ã€‚

ç‰¹åˆ«åœ°ï¼Œ`ImageInput`ç±»æä¾›äº† å•/æ‰¹é‡ å›¾ç‰‡ä¸‹è½½æ–¹æ³•ã€‚

